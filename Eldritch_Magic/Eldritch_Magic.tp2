BACKUP "Eldritch_Magic/backup"
AUTHOR ~Eric.McLaughlin@Alumni.StonyBrook.edu~

VERSION v1.5
README ~Eldritch_Magic/README.txt~

ALWAYS
INCLUDE ~Eldritch_Magic/lib/fl#add_kit_ee.tpa~
INCLUDE ~Eldritch_Magic/lib/thieving_to_50.tpa~
END

AUTO_TRA ~Eldritch_Magic/Languages/%s~

LANGUAGE
  ~English~
  ~english~
  ~Eldritch_Magic/Languages/English/setup.tra~

// "EM" prefix reserved by Abdel_Adrian (https://forums.beamdog.com/profile/Abdel_Adrian) as of June 23rd, 2015 (http://www.blackwyrmlair.net/prefixes/)

BEGIN Abyssal_Warrior DESIGNATED 0
GROUP @100
REQUIRE_PREDICATE GAME_IS ~bgee bg2ee iwdee~ @25

ACTION_IF GAME_IS ~bgee~ BEGIN
COPY_EXISTING ~racetext.2da~ ~override~
SET_2DA_ENTRY	8	2	5	RESOLVE_STR_REF(@15) // tiefling
SET_2DA_ENTRY 	8	3	5	RESOLVE_STR_REF(@16) // tiefling race description
SET_2DA_ENTRY	8	4	5	RESOLVE_STR_REF(@17) // Tiefling
SET_2DA_ENTRY 	8	5	5	RESOLVE_STR_REF(@18) // tiefling bio
END

ACTION_IF GAME_IS ~bg2ee~ BEGIN
COPY_EXISTING ~racetext.2da~ ~override~
SET_2DA_ENTRY	8	2	5	RESOLVE_STR_REF(@19) // vampire
SET_2DA_ENTRY 	8	3	5	RESOLVE_STR_REF(@20)
SET_2DA_ENTRY	8	4	5	RESOLVE_STR_REF(@21) // Vampire
SET_2DA_ENTRY 	8	5	5	RESOLVE_STR_REF(@18)
SET_2DA_ENTRY	9	2	5	RESOLVE_STR_REF(@15) // tiefling
SET_2DA_ENTRY 	9	3	5	RESOLVE_STR_REF(@16)
SET_2DA_ENTRY	9	4	5	RESOLVE_STR_REF(@17) // Tiefling
SET_2DA_ENTRY 	9	5	5	RESOLVE_STR_REF(@18)
END

// ACTION_IF GAME_IS ~iwdee~ BEGIN
// COPY_EXISTING ~racetext.2da~ ~override~
// SET_2DA_ENTRY	8	2	5	RESOLVE_STR_REF(@19) // vampire
// SET_2DA_ENTRY 	8	3	5	RESOLVE_STR_REF(@16)
// SET_2DA_ENTRY	8	4	5	RESOLVE_STR_REF(@20) // Vampire
// SET_2DA_ENTRY 	8	5	5	RESOLVE_STR_REF(@18)
// SET_2DA_ENTRY	9	2	5	RESOLVE_STR_REF(@15) // tiefling
// SET_2DA_ENTRY 	9	3	5	RESOLVE_STR_REF(@16)
// SET_2DA_ENTRY	9	4	5	RESOLVE_STR_REF(@17) // Tiefling
// SET_2DA_ENTRY 	9	5	5	RESOLVE_STR_REF(@18)
// END

ACTION_IF FILE_EXISTS_IN_GAME SODRACE.2da BEGIN
COPY_EXISTING ~SODRACE.2da~ ~override~
SET_2DA_ENTRY	8	2	5	RESOLVE_STR_REF(@15) // tiefling
SET_2DA_ENTRY 	8	3	5	RESOLVE_STR_REF(@16) // tiefling race description
SET_2DA_ENTRY	8	4	5	RESOLVE_STR_REF(@17) // Tiefling
SET_2DA_ENTRY 	8	5	5	RESOLVE_STR_REF(@18) // tiefling bio
END

ADD_KIT ~ABYSSAL~ /* this is the "internal" name of your kit, like BERSERKER or LATHANDER */
  ~ABYSSAL                1           1           1           1           1           1           1           1~ /* this line is appened to CLASWEAP.2DA */
  ~ABYSSAL 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 2 2 2 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ /* this string is appened column-wise to WEAPPROF.2DA, starting with the third line*/
  ~ABYSSAL                15      7       6       8       3       8~ /* this line is appened to ABCLASRQ.2DA */
  ~ABYSSAL               -1      -1       1       1      -1       0~ /* this line is appened to ABCLSMOD.2DA */
  ~ABYSSAL                17      0       0       0       0       0~ /* this line is appened to ABDCDSRQ.2DA */
  ~ABYSSAL                15      0       0       0       0       0~ /* this line is appened to ABDCSCRQ.2DA */
  ~ABYSSAL                0       0       0       0       0       0       0       1       1~ /* this line is appened to ALIGNMNT.2DA */
  ~ABYSSAL                0       1       1       1       0       0~ /* this line goes to DUALCLAS.2DA */
  ~Eldritch_Magic/2DA/EMCLABAB.2da~ /* this is the name of your abilities 2DA file, in the style of clabrn02.2da */
  ~K_F_H    K_F_D   K_F_G   K_F_E   K_F_HE   K_F_HL   K_F_HO~ /* These are the 2da files listed in KITTABLE.2DA that you want your kit to be a part of. List as many as you like. */
  ~0x00000001    2~ /* This is the "unusable" value you want for your kit and also the class value. These would normally appear at the end of KITLIST.2DA */
  ~Fi0~ /* This is the High Level Ability Abbreviation (see LUABBR.2DA) Normal values are Fi0, Pa0, etc. */
  ~CHAN09 * HELM07 BAG20 RING06 RING31 * BOOT01 AMUL19 BRAC16 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 HAMM07 SW1H27 STAF08~ // Fighter ToB starting weapons
  SAY ~abyssal warrior~
  SAY ~Abyssal Warrior~
  SAY @0

COPY ~Eldritch_Magic/Spells/EMTIEF.spl~   ~override~
     SAY 0x8  @17
     SAY 0x50 @17
COPY ~Eldritch_Magic/Spells/EMDEFEAR.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMTHAC0.spl~   ~override~
COPY ~Eldritch_Magic/Effects/EMABTH0.eff~   ~override~
COPY ~Eldritch_Magic/Spells/EMCACO.spl~   ~override~
     SAY 0x8  @215
     SAY 0x50 @216
COPY ~Eldritch_Magic/Spells/EMFIEND.spl~   ~override~
     SAY 0x8  @217
     SAY 0x50 @218

ACTION_IF GAME_IS ~bgee~ THEN BEGIN
COPY ~Eldritch_Magic/2DA/EMCDAB.2da~   ~override~
COPY ~Eldritch_Magic/Spells/EMCDAB.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMCDAX.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMCDBS.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMCDCL.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMCDDA.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMCDFL.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMCDHA.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMCDKA.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMCDLS.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMCDMA.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMCDMS.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMCDNJ.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMCDSC.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMCDSP.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMCDSS.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMCDTH.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMCDWH.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMCDWZ.spl~   ~override~ 
END

ACTION_IF GAME_IS ~bg2ee~ BEGIN
COPY ~Eldritch_Magic/ITM/EMOBYRIT.itm~ ~override~ // Obyrithian Executioner
  SAY NAME1 ~~
  SAY NAME2 @138
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @139
COPY_EXISTING ~WMART2.sto~ ~override~
 ADD_STORE_ITEM ~EMOBYRIT~ LAST #0 #0 #0 ~IDENTIFIED~ #1
END

LAF fl#add_kit_ee
   INT_VAR
     biography = ~-1~
     briefdesc = 31252 // Normal briefdesc for fighters
     fallen = 0
     fallen_notice = ~-1~
   STR_VAR
     kit_name = ABYSSAL
     clswpbon = ~1 0 2~
     numwslot = ~4~
     clascolr = ~182 182 136 184 142~ // Blackguard colors
     clasiskl = ~0 0 0 0 0 0 0~
     clasthac = ~1~
     thiefscl = ~0 0 0 0 0 0 0 0~
     hpclass  = ~HPWAR~
     clsrcreq = ~0 1 0 0 0 0 0~

END

// Remove XP Cap
COPY  ~Eldritch_Magic/2DA/XPCAP.2DA~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTARE.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTBP.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/SODSTRTA.2DA~   ~override~

ACTION_CLEAR_ARRAY  cd_extend_tables
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN
  lvlmodwm => 0 // wild mage level modulation for wild surges
  monkfist => 0 // monk fist progression
  mxsplbrd => 0 // bard spell table
  mxspldd  => 0 // dragon disciple spell table
  mxspldru => 0 // druid spell table
  mxsplpal => 0 // paladin spell table
  mxsplprs => 0 // priest spell table
  mxsplran => 0 // ranger spell table
  mxsplsrc => 0 // sorcerer spell table
  mxsplwiz => 0 // mage spell table
  raisdead => 0 // raise dead temple prices
  splsrckn => 0 // sorcerer spell table
END

// extend hp tables for ee games
ACTION_IF FILE_EXISTS_IN_GAME hpclass.2da THEN BEGIN

  // add hp tables to list of tables to extend
  COPY_EXISTING ~hpclass.2da~ ~override~
    COUNT_2DA_ROWS ~2~ "rows"
    FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
      SET "exists" = 0
      READ_2DA_ENTRY "%index%" 1 2 "table"
      DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN "%table%" => 0 END
    END

END

// easy replacements for 2das with levels as rows
ACTION_PHP_EACH cd_extend_tables AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~^40\([ %TAB%].*\)~
          ~40\1
41\1
42\1
43\1
44\1
45\1
46\1
47\1
48\1
49\1
50\1~
      END
      UNLESS ~^50[ %TAB%]~
      BUT_ONLY_IF_IT_CHANGES
  END

END

// extend level-based abilities to 50; 2das with a zero column
ACTION_FOR_EACH file IN backstab crippstr layhands savemonk saveprs saverog savewar savewiz sneakatt thac0 xpbonus BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
       REPLACE_TEXTUALLY ~^\(.+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+\)\([ %TAB%]+[0-9]+\)~
        ~\1\2\2\2\2\2\2\2\2\2\2\2~
       REPLACE_TEXTUALLY ~\([ %TAB%]+\)40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40~
        ~\140\141\142\143\144\145\146\147\148\149\150~  
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY_IF_IT_CHANGES
      
  END

END

// extend level-based abilities to 50; wspatck
COPY_EXISTING ~wspatck.2da~ ~override~ // warrior bonus attacks for proficiencies and levels
  // everything else, extend from 41 to 50
  REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40~
    ~\1\240\241\242\243\244\245\246\247\248\249\250~
  REPLACE_TEXTUALLY ~^\([0-5]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+\)\([ %TAB%]+-?[0-9]+\)~
    ~\1\2\2\2\2\2\2\2\2\2\2\2~
  UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
  BUT_ONLY_IF_IT_CHANGES

ACTION_CLEAR_ARRAY  cd_extend_clabs
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN // start with class tables
  clabba01 => 0 // generic bard abilities
  clabdr01 => 0 // generic druid abilities
  clabfi01 => 0 // generic fighter abilities
  clabmo01 => 0 // generic monk abilities
  clabpa01 => 0 // generic paladin abilities
  clabpa05 => 0 // fallen paladin abilities
  clabpr01 => 0 // generic priest abilities
  clabrn01 => 0 // generic ranger abilities
  clabrn05 => 0 // fallen ranger abilities
  clabth01 => 0 // generic thief abilities
END

// add kit tables dynamically by reading kitlist
COPY_EXISTING ~kitlist.2da~ ~override~
  COUNT_2DA_ROWS ~9~ "rows"
  FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
    SET "exists" = 0
    READ_2DA_ENTRY "%index%" 5 9 "clab"
    DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN "%clab%" => 0 END
  END
  BUT_ONLY_IF_IT_CHANGES

// extend clab abilities to 50
ACTION_PHP_EACH cd_extend_clabs AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~[%WNL%%MNL%]+~ ~%LNL%~
        REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40[ %TAB%]*~
          ~\1\240\241\242\243\244\245\246\247\248\249\250~
        REPLACE_TEXTUALLY ~^\(ABILITY[0-9A-Z]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+\)\([ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%%LNL%]+\)[ %TAB%]*$~
          ~\1\2\2~
      END
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY

  END

END

// for EE
ACTION_FOR_EACH file IN startare startbp BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[0-9]+~ ~\1-1~
      BUT_ONLY

  END

END

 PRINT ~Thank you for installing: "Abyssal Warrior Kit"~

BEGIN Bladesinger DESIGNATED 1
GROUP @100
REQUIRE_PREDICATE GAME_IS ~bgee bg2ee iwdee~ @25

ADD_KIT ~BLADE_SINGER~ /* this is the "internal" name of your kit, like BERSERKER or LATHANDER */
  ~BLADE_SINGER                1           1           1           1           1           1           1           0~ /* this line is appened to CLASWEAP.2DA */
  ~BLADE_SINGER 5 5 1 0 5 5 5 1 5 5 5 5 0 5 5 5 5 5 0 0 5 5 0 1 1 1 1 1 0 0 5 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ /* this string is appened column-wise to WEAPPROF.2DA, starting with the third line*/
  ~BLADE_SINGER                13      15      13      15      3       8~ /* this line is appened to ABCLASRQ.2DA */
  ~BLADE_SINGER                0       0       0       0       0       0~ /* this line is appened to ABCLSMOD.2DA */
  ~BLADE_SINGER                17      17      17      17      0       0~ /* this line is appened to ABDCDSRQ.2DA */
  ~BLADE_SINGER                15      15      15      15      0       0~ /* this line is appened to ABDCSCRQ.2DA */
  ~BLADE_SINGER                1       0       0       1       0       0       1       0       0~ /* this line is appened to ALIGNMNT.2DA */
  ~BLADE_SINGER                0       0       0       0       0       0~ /* this line goes to DUALCLAS.2DA */
  ~Eldritch_Magic/2DA/emclabfm.2da~ /* this is the name of your abilities 2DA file, in the style of clabrn02.2da */
  ~K_B_H    K_B_D   K_B_G   K_B_E   K_B_HE   K_B_HL   K_B_HO~ /* These are the 2da files listed in KITTABLE.2DA that you want your kit to be a part of. List as many as you like. */
  ~0x00200000    5~ /* This is the "unusable" value you want for your kit and also the class value. These would normally appear at the end of KITLIST.2DA */
  ~EM0~ /* This is the High Level Ability Abbreviation (see LUABBR.2DA) Normal values are Fi0, Pa0, etc. */
  ~CHAN16 * EMPSION BAG29 RING46 * CLCK06 BOOT01 AMUL21 BRAC16 BELT10 AROW11,40 AROW11,40 AROW11,40 POTN52,5 POTN04,2 POTN14,5 * * SW1H73~ // Modified F/M ToB starting weapons
  SAY ~bladesinger~
  SAY ~Bladesinger~
  SAY @1

// Bard GETS_PROF_APR
COPY_EXISTING ~clswpbon.2da~ ~override~
  COUNT_2DA_ROWS 4 rows
  FOR (row = 0 ; row < rows ; ++row) BEGIN
    READ_2DA_ENTRY row 0 4 entry
    PATCH_IF ("%entry%" STRING_COMPARE_CASE "BARD"      = 0) BEGIN
      FOR (col = 1; col < 2 ; ++col) BEGIN
        SET_2DA_ENTRY row col 4 1
      END
    END
  END
  PRETTY_PRINT_2DA
  BUT_ONLY

// Enables elven bards
COPY_EXISTING ~clsrcreq.2da~ ~override~
  COUNT_2DA_ROWS 8 rows
  FOR (row = 0 ; row < rows ; ++row) BEGIN
    READ_2DA_ENTRY row 0 8 entry
    PATCH_IF ("%entry%" STRING_COMPARE_CASE "BARD"      = 0) BEGIN
      FOR (col = 2; col < 3 ; ++col) BEGIN
        SET_2DA_ENTRY row col 8 1
      END
    END
  END
  PRETTY_PRINT_2DA
  BUT_ONLY

// Bard -> Fighter PROFS, FIRST_LEVEL & RATE
COPY_EXISTING ~profs.2da~ ~override~
  COUNT_2DA_ROWS 3 rows
  FOR (row = 0 ; row < rows ; ++row) BEGIN
    READ_2DA_ENTRY row 0 3 entry
    PATCH_IF ("%entry%" STRING_COMPARE_CASE "BARD"      = 0) BEGIN
      FOR (col = 1; col < 2 ; ++col) BEGIN
        SET_2DA_ENTRY row col 3 4
      END
      FOR (col = 2; col < 3 ; ++col) BEGIN
        SET_2DA_ENTRY row col 3 3
      END
    END
  END
  PRETTY_PRINT_2DA
  BUT_ONLY

// Bard -> Fighter PROFSMAX, FIRST_LEVEL & OTHER_LEVELS
COPY_EXISTING ~profsmax.2da~ ~override~
  COUNT_2DA_ROWS 3 rows
  FOR (row = 0 ; row < rows ; ++row) BEGIN
    READ_2DA_ENTRY row 0 3 entry
    PATCH_IF ("%entry%" STRING_COMPARE_CASE "BARD"      = 0) BEGIN
      FOR (col = 1; col < 2 ; ++col) BEGIN
        SET_2DA_ENTRY row col 3 2
      END
      FOR (col = 2; col < 3 ; ++col) BEGIN
        SET_2DA_ENTRY row col 3 5
      END
    END
  END
  PRETTY_PRINT_2DA
  BUT_ONLY

// Includes Bladesinger's High-Level Abilities
ACTION_IF (NOT FILE_EXISTS_IN_GAME ~LUEM0.2da~) BEGIN
  COPY ~Eldritch_Magic/2DA/LUEM0.2da~ ~override~
END

// Changes bard's spell progression to wizard's, sets Bladesinger's thac0 to that of F/M.
COPY  ~Eldritch_Magic/2DA/mxsplbrd.2da~   ~override~
COPY  ~Eldritch_Magic/2DA/thac0.2da~   ~override~

// Adds Bladesinger's custom CLAB spells.
COPY  ~Eldritch_Magic/Spells/emac1.spl~   ~override~
COPY  ~Eldritch_Magic/Spells/emsee.spl~   ~override~
COPY  ~Eldritch_Magic/Spells/emblsr.spl~   ~override~

// Bladesinger's HLA at level 14
COPY_EXISTING ~lunumab.2da~ ~override~
  COUNT_2DA_ROWS 3 rows
  FOR (row = 0 ; row < rows ; ++row) BEGIN
    READ_2DA_ENTRY row 0 3 entry
    PATCH_IF ("%entry%" STRING_COMPARE_CASE "BARD"      = 0) BEGIN
      FOR (col = 1; col < 2 ; ++col) BEGIN
        SET_2DA_ENTRY row col 3 14
      END
    END
  END
APPEND lunumab.2da ~BLADE_SINGER            14              1         99             1~
  
// SWS Grand Mastery
COPY_EXISTING ~stylbonu.2da~ ~override~
  APPEND stylbonu.2da ~SINGLEWEAPON-3   0                0                0                0                -2               0                -1               1~
  APPEND stylbonu.2da ~SINGLEWEAPON-4   0                0                0                0                -2               0                -2               1~
  APPEND stylbonu.2da ~SINGLEWEAPON-5   0                0                -1               0                -2               0                -2               1~


// Bladesongs
COPY  ~Eldritch_Magic/Spells/embs1.spl~   ~override~
      SAY 0x8 @124
      SAY 0x50 @125
COPY  ~Eldritch_Magic/Spells/embs1g.spl~   ~override~
      SAY 0x8 @126
      SAY 0x50 @127
COPY  ~Eldritch_Magic/Spells/embs2.spl~   ~override~
      SAY 0x8 @132
      SAY 0x50 @133
COPY  ~Eldritch_Magic/Spells/embs2g.spl~   ~override~
      SAY 0x8 @134
      SAY 0x50 @135
COPY  ~Eldritch_Magic/Spells/embs3.spl~   ~override~
      SAY 0x8 @128
      SAY 0x50 @129
COPY  ~Eldritch_Magic/Spells/embs3g.spl~   ~override~
      SAY 0x8 @130
      SAY 0x50 @131
COPY  ~Eldritch_Magic/Spells/embsong.spl~   ~override~

ACTION_IF GAME_IS ~bgee~
  THEN BEGIN
  STRING_SET 25046  @15000
COPY ~Eldritch_Magic/ITM/BGEE/clck09.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/clck10.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/clck11.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/clck12.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/clck13.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/clck14.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/clck15.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/clck18.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/clck19.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/helm01.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/helm02.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/helm03.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/helm04.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/helm05.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/helm06.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/helm07.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/helm08.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/helm09.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/helm10.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/helm11.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/helm12.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/helm13.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/helm14.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/helm15.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/potn03.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/potn04.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/potn05.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/potn06.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/potn07.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/potn09.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/potn11.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/potn12.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BGEE/ring08.itm~ ~override~ //
END

ACTION_IF GAME_IS ~bg2ee~
  THEN BEGIN
  STRING_SET 34174 @15000
COPY ~Eldritch_Magic/ITM/BG2EE/clck09.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/clck10.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/clck11.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/clck12.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/clck13.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/clck14.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/clck15.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/clck18.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/clck19.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm01.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm02.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm03.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm04.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm05.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm06.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm07.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm08.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm09.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm10.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm11.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm12.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm13.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm14.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm15.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm16.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm17.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm21.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm22.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm28.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm29.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm30.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm31.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm32.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/helm33.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/potn03.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/potn04.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/potn05.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/potn06.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/potn07.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/potn09.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/potn11.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/potn12.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/ring08.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/ring40.itm~ ~override~ //
COPY ~Eldritch_Magic/ITM/BG2EE/WA2ROBE.itm~ ~override~ //
END

ACTION_IF GAME_IS ~iwdee~
  THEN BEGIN
  STRING_SET 37732 @15000
END

LAF fl#add_kit_ee
   INT_VAR
     biography = ~-1~
     briefdesc = 102499 // Normal briefdesc for fighter/mages
     fallen = 0
     fallen_notice = ~-1~
   STR_VAR
     kit_name = BLADE_SINGER
     clswpbon = ~1 0 3~
     numwslot = ~2~
     clascolr = ~57 58 122 1 43~ // F/M colors
     clasiskl = ~0 0 0 0 0 0 0~
     clasthac = ~0~
     thiefscl = ~0 0 0 0 0 0 0 0~
     hpclass  = ~HPFM~
     clsrcreq = ~0 1 0 0 0 0 0~

END

// Bard-only xp/level change
COPY  ~Eldritch_Magic/2DA/XPLEVEL.2DA~   ~override~
// Remove XP Cap
COPY  ~Eldritch_Magic/2DA/XPCAP.2DA~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTARE.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTBP.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/SODSTRTA.2DA~   ~override~

ACTION_CLEAR_ARRAY  cd_extend_tables
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN
  lvlmodwm => 0 // wild mage level modulation for wild surges
  monkfist => 0 // monk fist progression
  mxsplbrd => 0 // bard spell table
  mxspldd  => 0 // dragon disciple spell table
  mxspldru => 0 // druid spell table
  mxsplpal => 0 // paladin spell table
  mxsplprs => 0 // priest spell table
  mxsplran => 0 // ranger spell table
  mxsplsrc => 0 // sorcerer spell table
  mxsplwiz => 0 // mage spell table
  raisdead => 0 // raise dead temple prices
  splsrckn => 0 // sorcerer spell table
END

// extend hp tables for ee games
ACTION_IF FILE_EXISTS_IN_GAME hpclass.2da THEN BEGIN

  // add hp tables to list of tables to extend
  COPY_EXISTING ~hpclass.2da~ ~override~
    COUNT_2DA_ROWS ~2~ "rows"
    FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
      SET "exists" = 0
      READ_2DA_ENTRY "%index%" 1 2 "table"
      DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN "%table%" => 0 END
    END

END

// easy replacements for 2das with levels as rows
ACTION_PHP_EACH cd_extend_tables AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~^40\([ %TAB%].*\)~
          ~40\1
41\1
42\1
43\1
44\1
45\1
46\1
47\1
48\1
49\1
50\1~
      END
      UNLESS ~^50[ %TAB%]~
      BUT_ONLY_IF_IT_CHANGES
  END

END

// extend level-based abilities to 50; 2das with a zero column
ACTION_FOR_EACH file IN backstab crippstr layhands savemonk saveprs saverog savewar savewiz sneakatt thac0 xpbonus BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
       REPLACE_TEXTUALLY ~^\(.+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+\)\([ %TAB%]+[0-9]+\)~
        ~\1\2\2\2\2\2\2\2\2\2\2\2~
       REPLACE_TEXTUALLY ~\([ %TAB%]+\)40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40~
        ~\140\141\142\143\144\145\146\147\148\149\150~  
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY_IF_IT_CHANGES
      
  END

END

// extend level-based abilities to 50; wspatck
COPY_EXISTING ~wspatck.2da~ ~override~ // warrior bonus attacks for proficiencies and levels
  // everything else, extend from 41 to 50
  REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40~
    ~\1\240\241\242\243\244\245\246\247\248\249\250~
  REPLACE_TEXTUALLY ~^\([0-5]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+\)\([ %TAB%]+-?[0-9]+\)~
    ~\1\2\2\2\2\2\2\2\2\2\2\2~
  UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
  BUT_ONLY_IF_IT_CHANGES

ACTION_CLEAR_ARRAY  cd_extend_clabs
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN // start with class tables
  clabba01 => 0 // generic bard abilities
  clabdr01 => 0 // generic druid abilities
  clabfi01 => 0 // generic fighter abilities
  clabmo01 => 0 // generic monk abilities
  clabpa01 => 0 // generic paladin abilities
  clabpa05 => 0 // fallen paladin abilities
  clabpr01 => 0 // generic priest abilities
  clabrn01 => 0 // generic ranger abilities
  clabrn05 => 0 // fallen ranger abilities
  clabth01 => 0 // generic thief abilities
END

// add kit tables dynamically by reading kitlist
COPY_EXISTING ~kitlist.2da~ ~override~
  COUNT_2DA_ROWS ~9~ "rows"
  FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
    SET "exists" = 0
    READ_2DA_ENTRY "%index%" 5 9 "clab"
    DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN "%clab%" => 0 END
  END
  BUT_ONLY_IF_IT_CHANGES

// extend clab abilities to 50
ACTION_PHP_EACH cd_extend_clabs AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~[%WNL%%MNL%]+~ ~%LNL%~
        REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40[ %TAB%]*~
          ~\1\240\241\242\243\244\245\246\247\248\249\250~
        REPLACE_TEXTUALLY ~^\(ABILITY[0-9A-Z]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+\)\([ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%%LNL%]+\)[ %TAB%]*$~
          ~\1\2\2~
      END
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY

  END

END

// for EE
ACTION_FOR_EACH file IN startare startbp BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[0-9]+~ ~\1-1~
      BUT_ONLY

  END

END

 PRINT ~Thank you for installing: "Bladesinger Kit"~

//BEGIN Collector DESIGNATED 2
//GROUP @100
//REQUIRE_PREDICATE GAME_IS ~bgee bg2ee iwdee~ @25

ADD_KIT ~COLLECT~ /* this is the "internal" name of your kit, like BERSERKER or LATHANDER */
  ~COLLECT                1           1           1           1           1           1           1           1~ /* this line is appened to CLASWEAP.2DA */
  ~COLLECT 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 2 2 2 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ /* this string is appened column-wise to WEAPPROF.2DA, starting with the third line*/
  ~COLLECT                9       9       6       9       3       8~ /* this line is appened to ABCLASRQ.2DA */
  ~COLLECT                0       0       0       0       0       0~ /* this line is appened to ABCLSMOD.2DA */
  ~COLLECT                17      17      0       17      0       0~ /* this line is appened to ABDCDSRQ.2DA */
  ~COLLECT                15      15      0       15      0       0~ /* this line is appened to ABDCSCRQ.2DA */
  ~COLLECT                0       0       0       0       0       0       0       1       1~ /* this line is appened to ALIGNMNT.2DA */
  ~COLLECT                0       0       0       0       0       0~ /* this line goes to DUALCLAS.2DA */
  ~Eldritch_Magic/2DA/EMCLABEK.2da~ /* this is the name of your abilities 2DA file, in the style of clabrn02.2da */
  ~~ /* These are the 2da files listed in KITTABLE.2DA that you want your kit to be a part of. List as many as you like. */
  ~0x00000001    4~ /* This is the "unusable" value you want for your kit and also the class value. These would normally appear at the end of KITLIST.2DA */
  ~Fi0~ /* This is the High Level Ability Abbreviation (see LUABBR.2DA) Normal values are Fi0, Pa0, etc. */
  ~CHAN09 * HELM07 BAG20 RING06 RING31 * BOOT01 AMUL19 BRAC16 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 HAMM07 SW1H27 STAF08~ // Fighter ToB starting weapons
  SAY ~collector~
  SAY ~Collector~
  SAY @2

COPY ~Eldritch_Magic/ITM/EMCOLLEC.itm~   ~override~ // Manual of Artifact Collecting
  SAY NAME1 ~~
  SAY NAME2 @298
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @2

ACTION_IF GAME_IS ~bgee~
 THEN BEGIN
COPY_EXISTING ~INN2616.sto~ ~override~
 ADD_STORE_ITEM ~EMCOLLEC~ LAST #1 #0 #0 ~IDENTIFIED~ #1
END
ACTION_IF GAME_IS ~bg2ee~
 THEN BEGIN
COPY_EXISTING ~RIBALD.sto~ ~override~
 ADD_STORE_ITEM ~EMCOLLEC~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~RIBALD2.sto~ ~override~
 ADD_STORE_ITEM ~EMCOLLEC~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~RIBALD3.sto~ ~override~
 ADD_STORE_ITEM ~EMCOLLEC~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~25SPELL.sto~ ~override~
 ADD_STORE_ITEM ~EMCOLLEC~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~25SPELL2.sto~ ~override~
 ADD_STORE_ITEM ~EMCOLLEC~ LAST #1 #0 #0 ~IDENTIFIED~ #1
END
ACTION_IF GAME_IS ~iwdee~
 THEN BEGIN
COPY_EXISTING ~EHPOMAB.sto~ ~override~
 ADD_STORE_ITEM ~EMCOLLEC~ LAST #1 #0 #0 ~IDENTIFIED~ #1
END

LAF fl#add_kit_ee
  INT_VAR
    biography = ~-1~
    briefdesc = 102499 // Normal briefdesc for fighter/mages
    fallen = 0
    fallen_notice = ~-1~
  STR_VAR
    kit_name = COLLECT
    clswpbon = ~1 0 2~
    numwslot = ~2~
    clascolr = ~30 91 93 23 93~ // Fighter colors
    clasiskl = ~0 0 0 0 0 0 0~
    clasthac = ~0~
    thiefscl = ~0 0 0 0 0 0 0 0~
    hpclass  = ~HPWAR~
    clsrcreq = ~0 0 0 0 0 0 0~

END

// Remove XP Cap
COPY  ~Eldritch_Magic/2DA/XPCAP.2DA~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTARE.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTBP.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/SODSTRTA.2DA~   ~override~

ACTION_CLEAR_ARRAY  cd_extend_tables
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN
  lvlmodwm => 0 // wild mage level modulation for wild surges
  monkfist => 0 // monk fist progression
  mxsplbrd => 0 // bard spell table
  mxspldd  => 0 // dragon disciple spell table
  mxspldru => 0 // druid spell table
  mxsplpal => 0 // paladin spell table
  mxsplprs => 0 // priest spell table
  mxsplran => 0 // ranger spell table
  mxsplsrc => 0 // sorcerer spell table
  mxsplwiz => 0 // mage spell table
  raisdead => 0 // raise dead temple prices
  splsrckn => 0 // sorcerer spell table
END

// extend hp tables for ee games
ACTION_IF FILE_EXISTS_IN_GAME hpclass.2da THEN BEGIN

  // add hp tables to list of tables to extend
  COPY_EXISTING ~hpclass.2da~ ~override~
    COUNT_2DA_ROWS ~2~ "rows"
    FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
      SET "exists" = 0
      READ_2DA_ENTRY "%index%" 1 2 "table"
      DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN "%table%" => 0 END
    END

END

// easy replacements for 2das with levels as rows
ACTION_PHP_EACH cd_extend_tables AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~^40\([ %TAB%].*\)~
          ~40\1
41\1
42\1
43\1
44\1
45\1
46\1
47\1
48\1
49\1
50\1~
      END
      UNLESS ~^50[ %TAB%]~
      BUT_ONLY_IF_IT_CHANGES
  END

END

// extend level-based abilities to 50; 2das with a zero column
ACTION_FOR_EACH file IN backstab crippstr layhands savemonk saveprs saverog savewar savewiz sneakatt thac0 xpbonus BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
       REPLACE_TEXTUALLY ~^\(.+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+\)\([ %TAB%]+[0-9]+\)~
        ~\1\2\2\2\2\2\2\2\2\2\2\2~
       REPLACE_TEXTUALLY ~\([ %TAB%]+\)40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40~
        ~\140\141\142\143\144\145\146\147\148\149\150~  
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY_IF_IT_CHANGES
      
  END

END

// extend level-based abilities to 50; wspatck
COPY_EXISTING ~wspatck.2da~ ~override~ // warrior bonus attacks for proficiencies and levels
  // everything else, extend from 41 to 50
  REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40~
    ~\1\240\241\242\243\244\245\246\247\248\249\250~
  REPLACE_TEXTUALLY ~^\([0-5]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+\)\([ %TAB%]+-?[0-9]+\)~
    ~\1\2\2\2\2\2\2\2\2\2\2\2~
  UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
  BUT_ONLY_IF_IT_CHANGES

ACTION_CLEAR_ARRAY  cd_extend_clabs
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN // start with class tables
  clabba01 => 0 // generic bard abilities
  clabdr01 => 0 // generic druid abilities
  clabfi01 => 0 // generic fighter abilities
  clabmo01 => 0 // generic monk abilities
  clabpa01 => 0 // generic paladin abilities
  clabpa05 => 0 // fallen paladin abilities
  clabpr01 => 0 // generic priest abilities
  clabrn01 => 0 // generic ranger abilities
  clabrn05 => 0 // fallen ranger abilities
  clabth01 => 0 // generic thief abilities
END

// add kit tables dynamically by reading kitlist
COPY_EXISTING ~kitlist.2da~ ~override~
  COUNT_2DA_ROWS ~9~ "rows"
  FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
    SET "exists" = 0
    READ_2DA_ENTRY "%index%" 5 9 "clab"
    DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN "%clab%" => 0 END
  END
  BUT_ONLY_IF_IT_CHANGES

// extend clab abilities to 50
ACTION_PHP_EACH cd_extend_clabs AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~[%WNL%%MNL%]+~ ~%LNL%~
        REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40[ %TAB%]*~
          ~\1\240\241\242\243\244\245\246\247\248\249\250~
        REPLACE_TEXTUALLY ~^\(ABILITY[0-9A-Z]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+\)\([ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%%LNL%]+\)[ %TAB%]*$~
          ~\1\2\2~
      END
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY

  END

END

// for EE
ACTION_FOR_EACH file IN startare startbp BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[0-9]+~ ~\1-1~
      BUT_ONLY

  END

END

// PRINT ~Thank you for installing: "Collector Kit"~

BEGIN Eldritch_Knight DESIGNATED 3
GROUP @100
REQUIRE_PREDICATE GAME_IS ~bgee bg2ee iwdee~ @25

ADD_KIT ~ELDRITCH~ /* this is the "internal" name of your kit, like BERSERKER or LATHANDER */
  ~ELDRITCH                1           1           1           1           1           1           1           1~ /* this line is appened to CLASWEAP.2DA */
  ~ELDRITCH 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 2 2 2 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ /* this string is appened column-wise to WEAPPROF.2DA, starting with the third line*/
  ~ELDRITCH                9       7       6       9       3       8~ /* this line is appened to ABCLASRQ.2DA */
  ~ELDRITCH                0       0       0       0       0       0~ /* this line is appened to ABCLSMOD.2DA */
  ~ELDRITCH                17      0       0       17      0       0~ /* this line is appened to ABDCDSRQ.2DA */
  ~ELDRITCH                15      0       0       15      0       0~ /* this line is appened to ABDCSCRQ.2DA */
  ~ELDRITCH                1       1       1       1       1       1       1       1       1~ /* this line is appened to ALIGNMNT.2DA */
  ~ELDRITCH                0       0       0       0       0       0~ /* this line goes to DUALCLAS.2DA */
  ~Eldritch_Magic/2DA/EMCLABEK.2da~ /* this is the name of your abilities 2DA file, in the style of clabrn02.2da */
  ~~ /* These are the 2da files listed in KITTABLE.2DA that you want your kit to be a part of. List as many as you like. */
  ~0x00000001    2~ /* This is the "unusable" value you want for your kit and also the class value. These would normally appear at the end of KITLIST.2DA */
  ~Fi0~ /* This is the High Level Ability Abbreviation (see LUABBR.2DA) Normal values are Fi0, Pa0, etc. */
  ~CHAN09 * HELM07 BAG20 RING06 RING31 * BOOT01 AMUL19 BRAC16 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 HAMM07 SW1H27 STAF08~ // Fighter ToB starting weapons
  SAY ~eldritch knight~
  SAY ~Eldritch Knight~
  SAY @3

COPY ~Eldritch_Magic/ITM/EMEK.itm~   ~override~ // Tome of Eldritch Secrets
  SAY NAME1 ~~
  SAY NAME2 @288
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @3
COMPILE ~Eldritch_Magic/BAF/EMEK.baf~   ~override~
COPY ~Eldritch_Magic/Creatures/EMEK.cre~   ~override~
COPY ~Eldritch_Magic/Spells/EMWW2.spl~   ~override~

ACTION_IF GAME_IS ~bgee~
 THEN BEGIN
COPY ~Eldritch_Magic/2DA/EMCLABEK.2da~   ~override~
COPY_EXISTING ~INN2616.sto~              ~override~
 ADD_STORE_ITEM ~EMEK~ LAST #1 #0 #0 ~IDENTIFIED~ #1
END
ACTION_IF GAME_IS ~bg2ee~
 THEN BEGIN
COPY ~Eldritch_Magic/2DA/BG2EE/EMCLABEK.2da~   ~override~
COPY_EXISTING ~RIBALD.sto~ ~override~
 ADD_STORE_ITEM ~EMEK~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~RIBALD2.sto~ ~override~
 ADD_STORE_ITEM ~EMEK~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~RIBALD3.sto~ ~override~
 ADD_STORE_ITEM ~EMEK~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~25SPELL.sto~ ~override~
 ADD_STORE_ITEM ~EMEK~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~25SPELL2.sto~ ~override~
 ADD_STORE_ITEM ~EMEK~ LAST #1 #0 #0 ~IDENTIFIED~ #1
END
ACTION_IF GAME_IS ~iwdee~
 THEN BEGIN
COPY_EXISTING ~EHPOMAB.sto~ ~override~
 ADD_STORE_ITEM ~EMEK~ LAST #1 #0 #0 ~IDENTIFIED~ #1
END

COPY ~Eldritch_Magic/Spells/EMGBLADE.spl~   ~override~
  SAY 0x8 @289
  SAY 0x50 @290
COPY ~Eldritch_Magic/Spells/EMGFB.spl~   ~override~ // Green-Flame Blade
  SAY 0x8 @289
  SAY 0x50 @290
COPY ~Eldritch_Magic/ITM/EMGFB1.itm~   ~override~
  SAY NAME1 @289
  SAY NAME2 @289
  SAY UNIDENTIFIED_DESC @290
  SAY DESC @290
COPY ~Eldritch_Magic/ITM/EMGFB2.itm~   ~override~
  SAY NAME1 @289
  SAY NAME2 @289
  SAY UNIDENTIFIED_DESC @290
  SAY DESC @290
COPY ~Eldritch_Magic/ITM/EMGFB3.itm~   ~override~
  SAY NAME1 @289
  SAY NAME2 @289
  SAY UNIDENTIFIED_DESC @290
  SAY DESC @290
COPY ~Eldritch_Magic/ITM/EMGFB4.itm~   ~override~
  SAY NAME1 @289
  SAY NAME2 @289
  SAY UNIDENTIFIED_DESC @290
  SAY DESC @290
COPY ~Eldritch_Magic/ITM/EMGFB5.itm~   ~override~
  SAY NAME1 @289
  SAY NAME2 @289
  SAY UNIDENTIFIED_DESC @290
  SAY DESC @290
COPY ~Eldritch_Magic/ITM/EMGFB6.itm~   ~override~
  SAY NAME1 @289
  SAY NAME2 @289
  SAY UNIDENTIFIED_DESC @290
  SAY DESC @290

COPY ~Eldritch_Magic/Spells/EMBBLADE.spl~   ~override~
  SAY 0x8 @291
  SAY 0x50 @292
COPY ~Eldritch_Magic/Spells/EMBOOM.spl~   ~override~  // Booming Blade
  SAY 0x8 @291
  SAY 0x50 @292
COPY ~Eldritch_Magic/ITM/EMBB1.itm~   ~override~
  SAY NAME1 @291
  SAY NAME2 @291
  SAY UNIDENTIFIED_DESC @292
  SAY DESC @292
COPY ~Eldritch_Magic/ITM/EMBB2.itm~   ~override~
  SAY NAME1 @291
  SAY NAME2 @291
  SAY UNIDENTIFIED_DESC @292
  SAY DESC @292
COPY ~Eldritch_Magic/ITM/EMBB3.itm~   ~override~
  SAY NAME1 @291
  SAY NAME2 @291
  SAY UNIDENTIFIED_DESC @292
  SAY DESC @292
COPY ~Eldritch_Magic/ITM/EMBB4.itm~   ~override~
  SAY NAME1 @291
  SAY NAME2 @291
  SAY UNIDENTIFIED_DESC @292
  SAY DESC @292
COPY ~Eldritch_Magic/ITM/EMBB5.itm~   ~override~
  SAY NAME1 @291
  SAY NAME2 @291
  SAY UNIDENTIFIED_DESC @292
  SAY DESC @292
COPY ~Eldritch_Magic/ITM/EMBB6.itm~   ~override~
  SAY NAME1 @291
  SAY NAME2 @291
  SAY UNIDENTIFIED_DESC @292
  SAY DESC @292

LAF fl#add_kit_ee
  INT_VAR
    biography = ~-1~
    briefdesc = 102499 // Normal briefdesc for fighter/mages
    fallen = 0
    fallen_notice = ~-1~
  STR_VAR
    kit_name = ELDRITCH
    clswpbon = ~1 0 2~
    numwslot = ~2~
    clascolr = ~30 91 93 23 93~ // Fighter colors
    clasiskl = ~0 0 0 0 0 0 0~
    clasthac = ~0~
    thiefscl = ~0 0 0 0 0 0 0 0~
    hpclass  = ~HPWAR~
    clsrcreq = ~0 1 1 0 0 0 0~

END

// Remove XP Cap
COPY  ~Eldritch_Magic/2DA/XPCAP.2DA~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTARE.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTBP.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/SODSTRTA.2DA~   ~override~

ACTION_CLEAR_ARRAY  cd_extend_tables
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN
  lvlmodwm => 0 // wild mage level modulation for wild surges
  monkfist => 0 // monk fist progression
  mxsplbrd => 0 // bard spell table
  mxspldd  => 0 // dragon disciple spell table
  mxspldru => 0 // druid spell table
  mxsplpal => 0 // paladin spell table
  mxsplprs => 0 // priest spell table
  mxsplran => 0 // ranger spell table
  mxsplsrc => 0 // sorcerer spell table
  mxsplwiz => 0 // mage spell table
  raisdead => 0 // raise dead temple prices
  splsrckn => 0 // sorcerer spell table
END

// extend hp tables for ee games
ACTION_IF FILE_EXISTS_IN_GAME hpclass.2da THEN BEGIN

  // add hp tables to list of tables to extend
  COPY_EXISTING ~hpclass.2da~ ~override~
    COUNT_2DA_ROWS ~2~ "rows"
    FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
      SET "exists" = 0
      READ_2DA_ENTRY "%index%" 1 2 "table"
      DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN "%table%" => 0 END
    END

END

// easy replacements for 2das with levels as rows
ACTION_PHP_EACH cd_extend_tables AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~^40\([ %TAB%].*\)~
          ~40\1
41\1
42\1
43\1
44\1
45\1
46\1
47\1
48\1
49\1
50\1~
      END
      UNLESS ~^50[ %TAB%]~
      BUT_ONLY_IF_IT_CHANGES
  END

END

// extend level-based abilities to 50; 2das with a zero column
ACTION_FOR_EACH file IN backstab crippstr layhands savemonk saveprs saverog savewar savewiz sneakatt thac0 xpbonus BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
       REPLACE_TEXTUALLY ~^\(.+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+\)\([ %TAB%]+[0-9]+\)~
        ~\1\2\2\2\2\2\2\2\2\2\2\2~
       REPLACE_TEXTUALLY ~\([ %TAB%]+\)40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40~
        ~\140\141\142\143\144\145\146\147\148\149\150~  
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY_IF_IT_CHANGES
      
  END

END

// extend level-based abilities to 50; wspatck
COPY_EXISTING ~wspatck.2da~ ~override~ // warrior bonus attacks for proficiencies and levels
  // everything else, extend from 41 to 50
  REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40~
    ~\1\240\241\242\243\244\245\246\247\248\249\250~
  REPLACE_TEXTUALLY ~^\([0-5]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+\)\([ %TAB%]+-?[0-9]+\)~
    ~\1\2\2\2\2\2\2\2\2\2\2\2~
  UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
  BUT_ONLY_IF_IT_CHANGES

ACTION_CLEAR_ARRAY  cd_extend_clabs
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN // start with class tables
  clabba01 => 0 // generic bard abilities
  clabdr01 => 0 // generic druid abilities
  clabfi01 => 0 // generic fighter abilities
  clabmo01 => 0 // generic monk abilities
  clabpa01 => 0 // generic paladin abilities
  clabpa05 => 0 // fallen paladin abilities
  clabpr01 => 0 // generic priest abilities
  clabrn01 => 0 // generic ranger abilities
  clabrn05 => 0 // fallen ranger abilities
  clabth01 => 0 // generic thief abilities
END

// add kit tables dynamically by reading kitlist
COPY_EXISTING ~kitlist.2da~ ~override~
  COUNT_2DA_ROWS ~9~ "rows"
  FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
    SET "exists" = 0
    READ_2DA_ENTRY "%index%" 5 9 "clab"
    DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN "%clab%" => 0 END
  END
  BUT_ONLY_IF_IT_CHANGES

// extend clab abilities to 50
ACTION_PHP_EACH cd_extend_clabs AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~[%WNL%%MNL%]+~ ~%LNL%~
        REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40[ %TAB%]*~
          ~\1\240\241\242\243\244\245\246\247\248\249\250~
        REPLACE_TEXTUALLY ~^\(ABILITY[0-9A-Z]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+\)\([ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%%LNL%]+\)[ %TAB%]*$~
          ~\1\2\2~
      END
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY

  END

END

// for EE
ACTION_FOR_EACH file IN startare startbp BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[0-9]+~ ~\1-1~
      BUT_ONLY

  END

END

PRINT ~Thank you for installing: "Eldritch Knight Kit"~

//BEGIN Elven_Minstrel DESIGNATED 4
//GROUP @100
//REQUIRE_PREDICATE GAME_IS ~bgee bg2ee iwdee~ @25

ADD_KIT ~MINSTREL~ /* this is the "internal" name of your kit, like BERSERKER or LATHANDER */
  ~MINSTREL                1           1           1           1           1           1           1           1~ /* this line is appened to CLASWEAP.2DA */
  ~MINSTREL 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ /* this string is appened column-wise to WEAPPROF.2DA, starting with the third line*/
  ~MINSTREL                9       9       6       9       3       9~ /* this line is appened to ABCLASRQ.2DA */
  ~MINSTREL                0       0       0       0       0       0~ /* this line is appened to ABCLSMOD.2DA */
  ~MINSTREL                0       17      0       17      0       17~ /* this line is appened to ABDCDSRQ.2DA */
  ~MINSTREL                0       15      0       15      0       15~ /* this line is appened to ABDCSCRQ.2DA */
  ~MINSTREL                0       0       0       0       0       0       0       1       1~ /* this line is appened to ALIGNMNT.2DA */
  ~MINSTREL                0       0       0       0       0       0~ /* this line goes to DUALCLAS.2DA */
  ~Eldritch_Magic/2DA/EMCLABEK.2da~ /* this is the name of your abilities 2DA file, in the style of clabrn02.2da */
  ~~ /* These are the 2da files listed in KITTABLE.2DA that you want your kit to be a part of. List as many as you like. */
  ~0x00200000    5~ /* This is the "unusable" value you want for your kit and also the class value. These would normally appear at the end of KITLIST.2DA */
  ~Ba0~ /* This is the High Level Ability Abbreviation (see LUABBR.2DA) Normal values are Fi0, Pa0, etc. */
  ~CHAN09 * HELM07 BAG20 RING06 RING31 * BOOT01 AMUL19 BRAC16 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 HAMM07 SW1H27 STAF08~ // Fighter ToB starting weapons
  SAY ~elven minstrel~
  SAY ~Elven Minstrel~
  SAY @4

LAF fl#add_kit_ee
  INT_VAR
    biography = ~-1~
    briefdesc = 102499 // Normal briefdesc for fighter/mages
    fallen = 0
    fallen_notice = ~-1~
  STR_VAR
    kit_name = MINSTREL
    clswpbon = ~1 0 2~
    numwslot = ~2~
    clascolr = ~30 91 93 23 93~ // Fighter colors
    clasiskl = ~0 0 0 0 0 0 0~
    clasthac = ~0~
    thiefscl = ~0 0 0 0 0 0 0 0~
    hpclass  = ~HPWAR~
    clsrcreq = ~0 0 0 0 0 0 0~

END

// Remove XP Cap
COPY  ~Eldritch_Magic/2DA/XPCAP.2DA~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTARE.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTBP.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/SODSTRTA.2DA~   ~override~

ACTION_CLEAR_ARRAY  cd_extend_tables
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN
  lvlmodwm => 0 // wild mage level modulation for wild surges
  monkfist => 0 // monk fist progression
  mxsplbrd => 0 // bard spell table
  mxspldd  => 0 // dragon disciple spell table
  mxspldru => 0 // druid spell table
  mxsplpal => 0 // paladin spell table
  mxsplprs => 0 // priest spell table
  mxsplran => 0 // ranger spell table
  mxsplsrc => 0 // sorcerer spell table
  mxsplwiz => 0 // mage spell table
  raisdead => 0 // raise dead temple prices
  splsrckn => 0 // sorcerer spell table
END

// extend hp tables for ee games
ACTION_IF FILE_EXISTS_IN_GAME hpclass.2da THEN BEGIN

  // add hp tables to list of tables to extend
  COPY_EXISTING ~hpclass.2da~ ~override~
    COUNT_2DA_ROWS ~2~ "rows"
    FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
      SET "exists" = 0
      READ_2DA_ENTRY "%index%" 1 2 "table"
      DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN "%table%" => 0 END
    END

END

// easy replacements for 2das with levels as rows
ACTION_PHP_EACH cd_extend_tables AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~^40\([ %TAB%].*\)~
          ~40\1
41\1
42\1
43\1
44\1
45\1
46\1
47\1
48\1
49\1
50\1~
      END
      UNLESS ~^50[ %TAB%]~
      BUT_ONLY_IF_IT_CHANGES
  END

END

// extend level-based abilities to 50; 2das with a zero column
ACTION_FOR_EACH file IN backstab crippstr layhands savemonk saveprs saverog savewar savewiz sneakatt thac0 xpbonus BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
       REPLACE_TEXTUALLY ~^\(.+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+\)\([ %TAB%]+[0-9]+\)~
        ~\1\2\2\2\2\2\2\2\2\2\2\2~
       REPLACE_TEXTUALLY ~\([ %TAB%]+\)40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40~
        ~\140\141\142\143\144\145\146\147\148\149\150~  
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY_IF_IT_CHANGES
      
  END

END

// extend level-based abilities to 50; wspatck
COPY_EXISTING ~wspatck.2da~ ~override~ // warrior bonus attacks for proficiencies and levels
  // everything else, extend from 41 to 50
  REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40~
    ~\1\240\241\242\243\244\245\246\247\248\249\250~
  REPLACE_TEXTUALLY ~^\([0-5]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+\)\([ %TAB%]+-?[0-9]+\)~
    ~\1\2\2\2\2\2\2\2\2\2\2\2~
  UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
  BUT_ONLY_IF_IT_CHANGES

ACTION_CLEAR_ARRAY  cd_extend_clabs
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN // start with class tables
  clabba01 => 0 // generic bard abilities
  clabdr01 => 0 // generic druid abilities
  clabfi01 => 0 // generic fighter abilities
  clabmo01 => 0 // generic monk abilities
  clabpa01 => 0 // generic paladin abilities
  clabpa05 => 0 // fallen paladin abilities
  clabpr01 => 0 // generic priest abilities
  clabrn01 => 0 // generic ranger abilities
  clabrn05 => 0 // fallen ranger abilities
  clabth01 => 0 // generic thief abilities
END

// add kit tables dynamically by reading kitlist
COPY_EXISTING ~kitlist.2da~ ~override~
  COUNT_2DA_ROWS ~9~ "rows"
  FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
    SET "exists" = 0
    READ_2DA_ENTRY "%index%" 5 9 "clab"
    DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN "%clab%" => 0 END
  END
  BUT_ONLY_IF_IT_CHANGES

// extend clab abilities to 50
ACTION_PHP_EACH cd_extend_clabs AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~[%WNL%%MNL%]+~ ~%LNL%~
        REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40[ %TAB%]*~
          ~\1\240\241\242\243\244\245\246\247\248\249\250~
        REPLACE_TEXTUALLY ~^\(ABILITY[0-9A-Z]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+\)\([ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%%LNL%]+\)[ %TAB%]*$~
          ~\1\2\2~
      END
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY

  END

END

// for EE
ACTION_FOR_EACH file IN startare startbp BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[0-9]+~ ~\1-1~
      BUT_ONLY

  END

END

// PRINT ~Thank you for installing: "Elven Minstrel Kit"~

BEGIN Herbalist DESIGNATED 5
GROUP @100
REQUIRE_PREDICATE GAME_IS ~bgee bg2ee iwdee~ @25

ADD_KIT ~HERB~ /* this is the "internal" name of your kit, like BERSERKER or LATHANDER */
  ~HERB                0           0           1           1           0           1           0           0~ /* this line is appened to CLASWEAP.2DA */
  ~HERB 0 0 0 0 1 1 0 1 0 0 0 0 0 0 0 0 1 1 0 0 1 1 1 0 0 0 0 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ /* this string is appened column-wise to WEAPPROF.2DA, starting with the third line*/
  ~HERB                9       7       6       8       9       8~ /* this line is appened to ABCLASRQ.2DA */
  ~HERB                0       0       0       0       0       0~ /* this line is appened to ABCLSMOD.2DA */
  ~HERB                0       0       0       0       17      0~ /* this line is appened to ABDCDSRQ.2DA */
  ~HERB                0       0       0       0       15      0~ /* this line is appened to ABDCSCRQ.2DA */
  ~HERB                1       1       0       1       1       0       1       1       0~ /* this line is appened to ALIGNMNT.2DA */
  ~HERB                0       0       0       0       0       0~ /* this line goes to DUALCLAS.2DA */
  ~Eldritch_Magic/2DA/EMCLABHE.2da~ /* this is the name of your abilities 2DA file, in the style of clabrn02.2da */
  ~K_C_H    K_C_D   K_C_G   K_C_E   K_C_HE   K_C_HL   K_C_HO~ /* These are the 2da files listed in KITTABLE.2DA that you want your kit to be a part of. List as many as you like. */
  ~0x01000000    3~ /* This is the "unusable" value you want for your kit and also the class value. These would normally appear at the end of KITLIST.2DA */
  ~Cl0~ /* This is the High Level Ability Abbreviation (see LUABBR.2DA) Normal values are Fi0, Pa0, etc. */
  ~CHAN09 * HELM07 BAG26 RING06 RING31 * BOOT01 AMUL20 BRAC10 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 HAMM07 SW1H27 STAF08~ // Cleric ToB starting weapons
  SAY ~herbalist~
  SAY ~Herbalist~
  SAY @5

COPY ~Eldritch_Magic/Spells/EMBERRY.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMHERB.spl~   ~override~

LAF fl#add_kit_ee
   INT_VAR
     biography = ~-1~
     briefdesc = 31255 // Normal briefdesc for clerics
     fallen = 0
     fallen_notice = ~-1~
   STR_VAR
     kit_name = HERB
     clswpbon = ~0 0 3~
     numwslot = ~2~
     clascolr = ~30 37 86 1 110~ // Druid colors
     clasiskl = ~0 0 0 0 0 0 0~
     clasthac = ~0~
     thiefscl = ~0 0 0 0 0 0 0 0~
     hpclass  = ~HPPRS~
     clsrcreq = ~0 1 1 0 0 0 0~

END

// Remove XP Cap
COPY  ~Eldritch_Magic/2DA/XPCAP.2DA~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTARE.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTBP.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/SODSTRTA.2DA~   ~override~

ACTION_CLEAR_ARRAY  cd_extend_tables
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN
  lvlmodwm => 0 // wild mage level modulation for wild surges
  monkfist => 0 // monk fist progression
  mxsplbrd => 0 // bard spell table
  mxspldd  => 0 // dragon disciple spell table
  mxspldru => 0 // druid spell table
  mxsplpal => 0 // paladin spell table
  mxsplprs => 0 // priest spell table
  mxsplran => 0 // ranger spell table
  mxsplsrc => 0 // sorcerer spell table
  mxsplwiz => 0 // mage spell table
  raisdead => 0 // raise dead temple prices
  splsrckn => 0 // sorcerer spell table
END

// extend hp tables for ee games
ACTION_IF FILE_EXISTS_IN_GAME hpclass.2da THEN BEGIN

  // add hp tables to list of tables to extend
  COPY_EXISTING ~hpclass.2da~ ~override~
    COUNT_2DA_ROWS ~2~ "rows"
    FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
      SET "exists" = 0
      READ_2DA_ENTRY "%index%" 1 2 "table"
      DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN "%table%" => 0 END
    END

END

// easy replacements for 2das with levels as rows
ACTION_PHP_EACH cd_extend_tables AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~^40\([ %TAB%].*\)~
          ~40\1
41\1
42\1
43\1
44\1
45\1
46\1
47\1
48\1
49\1
50\1~
      END
      UNLESS ~^50[ %TAB%]~
      BUT_ONLY_IF_IT_CHANGES
  END

END

// extend level-based abilities to 50; 2das with a zero column
ACTION_FOR_EACH file IN backstab crippstr layhands savemonk saveprs saverog savewar savewiz sneakatt thac0 xpbonus BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
       REPLACE_TEXTUALLY ~^\(.+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+\)\([ %TAB%]+[0-9]+\)~
        ~\1\2\2\2\2\2\2\2\2\2\2\2~
       REPLACE_TEXTUALLY ~\([ %TAB%]+\)40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40~
        ~\140\141\142\143\144\145\146\147\148\149\150~  
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY_IF_IT_CHANGES
      
  END

END

// extend level-based abilities to 50; wspatck
COPY_EXISTING ~wspatck.2da~ ~override~ // warrior bonus attacks for proficiencies and levels
  // everything else, extend from 41 to 50
  REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40~
    ~\1\240\241\242\243\244\245\246\247\248\249\250~
  REPLACE_TEXTUALLY ~^\([0-5]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+\)\([ %TAB%]+-?[0-9]+\)~
    ~\1\2\2\2\2\2\2\2\2\2\2\2~
  UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
  BUT_ONLY_IF_IT_CHANGES

ACTION_CLEAR_ARRAY  cd_extend_clabs
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN // start with class tables
  clabba01 => 0 // generic bard abilities
  clabdr01 => 0 // generic druid abilities
  clabfi01 => 0 // generic fighter abilities
  clabmo01 => 0 // generic monk abilities
  clabpa01 => 0 // generic paladin abilities
  clabpa05 => 0 // fallen paladin abilities
  clabpr01 => 0 // generic priest abilities
  clabrn01 => 0 // generic ranger abilities
  clabrn05 => 0 // fallen ranger abilities
  clabth01 => 0 // generic thief abilities
END

// add kit tables dynamically by reading kitlist
COPY_EXISTING ~kitlist.2da~ ~override~
  COUNT_2DA_ROWS ~9~ "rows"
  FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
    SET "exists" = 0
    READ_2DA_ENTRY "%index%" 5 9 "clab"
    DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN "%clab%" => 0 END
  END
  BUT_ONLY_IF_IT_CHANGES

// extend clab abilities to 50
ACTION_PHP_EACH cd_extend_clabs AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~[%WNL%%MNL%]+~ ~%LNL%~
        REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40[ %TAB%]*~
          ~\1\240\241\242\243\244\245\246\247\248\249\250~
        REPLACE_TEXTUALLY ~^\(ABILITY[0-9A-Z]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+\)\([ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%%LNL%]+\)[ %TAB%]*$~
          ~\1\2\2~
      END
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY

  END

END

// for EE
ACTION_FOR_EACH file IN startare startbp BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[0-9]+~ ~\1-1~
      BUT_ONLY

  END

END

 PRINT ~Thank you for installing: "Herbalist Kit"~

//BEGIN Huntsman DESIGNATED 6
//GROUP @100
//REQUIRE_PREDICATE GAME_IS ~bgee bg2ee iwdee~ @25

ADD_KIT ~HUNTSMAN~ /* this is the "internal" name of your kit, like BERSERKER or LATHANDER */
  ~HUNTSMAN                1           1           1           1           1           1           1           1~ /* this line is appened to CLASWEAP.2DA */
  ~HUNTSMAN 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 2 2 2 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ /* this string is appened column-wise to WEAPPROF.2DA, starting with the third line*/
  ~HUNTSMAN                9       9       6       8       3       8~ /* this line is appened to ABCLASRQ.2DA */
  ~HUNTSMAN                0       0       0       0       0       0~ /* this line is appened to ABCLSMOD.2DA */
  ~HUNTSMAN                17      17      0       0       0       0~ /* this line is appened to ABDCDSRQ.2DA */
  ~HUNTSMAN                15      15      0       0       0       0~ /* this line is appened to ABDCSCRQ.2DA */
  ~HUNTSMAN                0       0       0       0       0       0       0       1       1~ /* this line is appened to ALIGNMNT.2DA */
  ~HUNTSMAN                0       0       0       0       0       0~ /* this line goes to DUALCLAS.2DA */
  ~Eldritch_Magic/2DA/EMCLABEK.2da~ /* this is the name of your abilities 2DA file, in the style of clabrn02.2da */
  ~~ /* These are the 2da files listed in KITTABLE.2DA that you want your kit to be a part of. List as many as you like. */
  ~0x00000001    4~ /* This is the "unusable" value you want for your kit and also the class value. These would normally appear at the end of KITLIST.2DA */
  ~Fi0~ /* This is the High Level Ability Abbreviation (see LUABBR.2DA) Normal values are Fi0, Pa0, etc. */
  ~CHAN09 * HELM07 BAG20 RING06 RING31 * BOOT01 AMUL19 BRAC16 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 HAMM07 SW1H27 STAF08~ // Fighter ToB starting weapons
  SAY ~huntsman~
  SAY ~Huntsman~
  SAY @6

COPY ~Eldritch_Magic/ITM/EMHUNT.itm~   ~override~ // Sylvan Hunting Techniques
  SAY NAME1 ~~
  SAY NAME2 @299
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @6
  
ACTION_IF GAME_IS ~bgee~
 THEN BEGIN
COPY_EXISTING ~INN2616.sto~ ~override~
 ADD_STORE_ITEM ~EMHUNT~ LAST #1 #0 #0 ~IDENTIFIED~ #1
END
ACTION_IF GAME_IS ~bg2ee~
 THEN BEGIN
COPY_EXISTING ~RIBALD.sto~ ~override~
 ADD_STORE_ITEM ~EMHUNT~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~RIBALD2.sto~ ~override~
 ADD_STORE_ITEM ~EMHUNT~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~RIBALD3.sto~ ~override~
 ADD_STORE_ITEM ~EMHUNT~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~25SPELL.sto~ ~override~
 ADD_STORE_ITEM ~EMHUNT~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~25SPELL2.sto~ ~override~
 ADD_STORE_ITEM ~EMHUNT~ LAST #1 #0 #0 ~IDENTIFIED~ #1
END
ACTION_IF GAME_IS ~iwdee~
 THEN BEGIN
COPY_EXISTING ~EHPOMAB.sto~ ~override~
 ADD_STORE_ITEM ~EMHUNT~ LAST #1 #0 #0 ~IDENTIFIED~ #1
END

LAF fl#add_kit_ee
  INT_VAR
    biography = ~-1~
    briefdesc = 102499 // Normal briefdesc for fighter/mages
    fallen = 0
    fallen_notice = ~-1~
  STR_VAR
    kit_name = HUNTSMAN
    clswpbon = ~1 0 2~
    numwslot = ~2~
    clascolr = ~30 91 93 23 93~ // Fighter colors
    clasiskl = ~0 0 0 0 0 0 0~
    clasthac = ~0~
    thiefscl = ~0 0 0 0 0 0 0 0~
    hpclass  = ~HPWAR~
    clsrcreq = ~0 0 0 0 0 0 0~

END

// Remove XP Cap
COPY  ~Eldritch_Magic/2DA/XPCAP.2DA~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTARE.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTBP.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/SODSTRTA.2DA~   ~override~

ACTION_CLEAR_ARRAY  cd_extend_tables
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN
  lvlmodwm => 0 // wild mage level modulation for wild surges
  monkfist => 0 // monk fist progression
  mxsplbrd => 0 // bard spell table
  mxspldd  => 0 // dragon disciple spell table
  mxspldru => 0 // druid spell table
  mxsplpal => 0 // paladin spell table
  mxsplprs => 0 // priest spell table
  mxsplran => 0 // ranger spell table
  mxsplsrc => 0 // sorcerer spell table
  mxsplwiz => 0 // mage spell table
  raisdead => 0 // raise dead temple prices
  splsrckn => 0 // sorcerer spell table
END

// extend hp tables for ee games
ACTION_IF FILE_EXISTS_IN_GAME hpclass.2da THEN BEGIN

  // add hp tables to list of tables to extend
  COPY_EXISTING ~hpclass.2da~ ~override~
    COUNT_2DA_ROWS ~2~ "rows"
    FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
      SET "exists" = 0
      READ_2DA_ENTRY "%index%" 1 2 "table"
      DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN "%table%" => 0 END
    END

END

// easy replacements for 2das with levels as rows
ACTION_PHP_EACH cd_extend_tables AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~^40\([ %TAB%].*\)~
          ~40\1
41\1
42\1
43\1
44\1
45\1
46\1
47\1
48\1
49\1
50\1~
      END
      UNLESS ~^50[ %TAB%]~
      BUT_ONLY_IF_IT_CHANGES
  END

END

// extend level-based abilities to 50; 2das with a zero column
ACTION_FOR_EACH file IN backstab crippstr layhands savemonk saveprs saverog savewar savewiz sneakatt thac0 xpbonus BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
       REPLACE_TEXTUALLY ~^\(.+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+\)\([ %TAB%]+[0-9]+\)~
        ~\1\2\2\2\2\2\2\2\2\2\2\2~
       REPLACE_TEXTUALLY ~\([ %TAB%]+\)40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40~
        ~\140\141\142\143\144\145\146\147\148\149\150~  
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY_IF_IT_CHANGES
      
  END

END

// extend level-based abilities to 50; wspatck
COPY_EXISTING ~wspatck.2da~ ~override~ // warrior bonus attacks for proficiencies and levels
  // everything else, extend from 41 to 50
  REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40~
    ~\1\240\241\242\243\244\245\246\247\248\249\250~
  REPLACE_TEXTUALLY ~^\([0-5]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+\)\([ %TAB%]+-?[0-9]+\)~
    ~\1\2\2\2\2\2\2\2\2\2\2\2~
  UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
  BUT_ONLY_IF_IT_CHANGES

ACTION_CLEAR_ARRAY  cd_extend_clabs
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN // start with class tables
  clabba01 => 0 // generic bard abilities
  clabdr01 => 0 // generic druid abilities
  clabfi01 => 0 // generic fighter abilities
  clabmo01 => 0 // generic monk abilities
  clabpa01 => 0 // generic paladin abilities
  clabpa05 => 0 // fallen paladin abilities
  clabpr01 => 0 // generic priest abilities
  clabrn01 => 0 // generic ranger abilities
  clabrn05 => 0 // fallen ranger abilities
  clabth01 => 0 // generic thief abilities
END

// add kit tables dynamically by reading kitlist
COPY_EXISTING ~kitlist.2da~ ~override~
  COUNT_2DA_ROWS ~9~ "rows"
  FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
    SET "exists" = 0
    READ_2DA_ENTRY "%index%" 5 9 "clab"
    DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN "%clab%" => 0 END
  END
  BUT_ONLY_IF_IT_CHANGES

// extend clab abilities to 50
ACTION_PHP_EACH cd_extend_clabs AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~[%WNL%%MNL%]+~ ~%LNL%~
        REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40[ %TAB%]*~
          ~\1\240\241\242\243\244\245\246\247\248\249\250~
        REPLACE_TEXTUALLY ~^\(ABILITY[0-9A-Z]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+\)\([ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%%LNL%]+\)[ %TAB%]*$~
          ~\1\2\2~
      END
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY

  END

END

// for EE
ACTION_FOR_EACH file IN startare startbp BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[0-9]+~ ~\1-1~
      BUT_ONLY

  END

END

// PRINT ~Thank you for installing: "Huntsman Kit"~

//BEGIN Infiltrator DESIGNATED 7
//GROUP @100
//REQUIRE_PREDICATE GAME_IS ~bgee bg2ee iwdee~ @25

ADD_KIT ~ELFSPY~ /* this is the "internal" name of your kit, like BERSERKER or LATHANDER */
  ~ELFSPY                1           1           1           1           1           1           1           1~ /* this line is appened to CLASWEAP.2DA */
  ~ELFSPY 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 2 2 2 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ /* this string is appened column-wise to WEAPPROF.2DA, starting with the third line*/
  ~ELFSPY                9       9       6       9       3       8~ /* this line is appened to ABCLASRQ.2DA */
  ~ELFSPY                0       0       0       0       0       0~ /* this line is appened to ABCLSMOD.2DA */
  ~ELFSPY                17      17      0       17      0       0~ /* this line is appened to ABDCDSRQ.2DA */
  ~ELFSPY                15      15      0       15      0       0~ /* this line is appened to ABDCSCRQ.2DA */
  ~ELFSPY                0       0       0       0       0       0       0       1       1~ /* this line is appened to ALIGNMNT.2DA */
  ~ELFSPY                0       0       0       0       0       0~ /* this line goes to DUALCLAS.2DA */
  ~Eldritch_Magic/2DA/EMCLABEK.2da~ /* this is the name of your abilities 2DA file, in the style of clabrn02.2da */
  ~~ /* These are the 2da files listed in KITTABLE.2DA that you want your kit to be a part of. List as many as you like. */
  ~0x00000001    4~ /* This is the "unusable" value you want for your kit and also the class value. These would normally appear at the end of KITLIST.2DA */
  ~Fi0~ /* This is the High Level Ability Abbreviation (see LUABBR.2DA) Normal values are Fi0, Pa0, etc. */
  ~CHAN09 * HELM07 BAG20 RING06 RING31 * BOOT01 AMUL19 BRAC16 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 HAMM07 SW1H27 STAF08~ // Fighter ToB starting weapons
  SAY ~infiltrator~
  SAY ~Infiltrator~
  SAY @7

COPY ~Eldritch_Magic/ITM/EMSPY.itm~   ~override~ // Infiltrator's Manuscripts
  SAY NAME1 ~~
  SAY NAME2 @300
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @7
  
ACTION_IF GAME_IS ~bgee~
 THEN BEGIN
COPY_EXISTING ~INN2616.sto~ ~override~
 ADD_STORE_ITEM ~EMSPY~ LAST #1 #0 #0 ~IDENTIFIED~ #1
END
ACTION_IF GAME_IS ~bg2ee~
 THEN BEGIN
COPY_EXISTING ~RIBALD.sto~ ~override~
 ADD_STORE_ITEM ~EMSPY~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~RIBALD2.sto~ ~override~
 ADD_STORE_ITEM ~EMSPY~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~RIBALD3.sto~ ~override~
 ADD_STORE_ITEM ~EMSPY~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~25SPELL.sto~ ~override~
 ADD_STORE_ITEM ~EMSPY~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~25SPELL2.sto~ ~override~
 ADD_STORE_ITEM ~EMSPY~ LAST #1 #0 #0 ~IDENTIFIED~ #1
END
ACTION_IF GAME_IS ~iwdee~
 THEN BEGIN
COPY_EXISTING ~EHPOMAB.sto~ ~override~
 ADD_STORE_ITEM ~EMSPY~ LAST #1 #0 #0 ~IDENTIFIED~ #1
END

LAF fl#add_kit_ee
  INT_VAR
    biography = ~-1~
    briefdesc = 102499 // Normal briefdesc for fighter/mages
    fallen = 0
    fallen_notice = ~-1~
  STR_VAR
    kit_name = ELFSPY
    clswpbon = ~1 0 2~
    numwslot = ~2~
    clascolr = ~30 91 93 23 93~ // Fighter colors
    clasiskl = ~0 0 0 0 0 0 0~
    clasthac = ~0~
    thiefscl = ~0 0 0 0 0 0 0 0~
    hpclass  = ~HPWAR~
    clsrcreq = ~0 0 0 0 0 0 0~

END

// Remove XP Cap
COPY  ~Eldritch_Magic/2DA/XPCAP.2DA~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTARE.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTBP.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/SODSTRTA.2DA~   ~override~

ACTION_CLEAR_ARRAY  cd_extend_tables
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN
  lvlmodwm => 0 // wild mage level modulation for wild surges
  monkfist => 0 // monk fist progression
  mxsplbrd => 0 // bard spell table
  mxspldd  => 0 // dragon disciple spell table
  mxspldru => 0 // druid spell table
  mxsplpal => 0 // paladin spell table
  mxsplprs => 0 // priest spell table
  mxsplran => 0 // ranger spell table
  mxsplsrc => 0 // sorcerer spell table
  mxsplwiz => 0 // mage spell table
  raisdead => 0 // raise dead temple prices
  splsrckn => 0 // sorcerer spell table
END

// extend hp tables for ee games
ACTION_IF FILE_EXISTS_IN_GAME hpclass.2da THEN BEGIN

  // add hp tables to list of tables to extend
  COPY_EXISTING ~hpclass.2da~ ~override~
    COUNT_2DA_ROWS ~2~ "rows"
    FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
      SET "exists" = 0
      READ_2DA_ENTRY "%index%" 1 2 "table"
      DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN "%table%" => 0 END
    END

END

// easy replacements for 2das with levels as rows
ACTION_PHP_EACH cd_extend_tables AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~^40\([ %TAB%].*\)~
          ~40\1
41\1
42\1
43\1
44\1
45\1
46\1
47\1
48\1
49\1
50\1~
      END
      UNLESS ~^50[ %TAB%]~
      BUT_ONLY_IF_IT_CHANGES
  END

END

// extend level-based abilities to 50; 2das with a zero column
ACTION_FOR_EACH file IN backstab crippstr layhands savemonk saveprs saverog savewar savewiz sneakatt thac0 xpbonus BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
       REPLACE_TEXTUALLY ~^\(.+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+\)\([ %TAB%]+[0-9]+\)~
        ~\1\2\2\2\2\2\2\2\2\2\2\2~
       REPLACE_TEXTUALLY ~\([ %TAB%]+\)40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40~
        ~\140\141\142\143\144\145\146\147\148\149\150~  
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY_IF_IT_CHANGES
      
  END

END

// extend level-based abilities to 50; wspatck
COPY_EXISTING ~wspatck.2da~ ~override~ // warrior bonus attacks for proficiencies and levels
  // everything else, extend from 41 to 50
  REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40~
    ~\1\240\241\242\243\244\245\246\247\248\249\250~
  REPLACE_TEXTUALLY ~^\([0-5]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+\)\([ %TAB%]+-?[0-9]+\)~
    ~\1\2\2\2\2\2\2\2\2\2\2\2~
  UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
  BUT_ONLY_IF_IT_CHANGES

ACTION_CLEAR_ARRAY  cd_extend_clabs
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN // start with class tables
  clabba01 => 0 // generic bard abilities
  clabdr01 => 0 // generic druid abilities
  clabfi01 => 0 // generic fighter abilities
  clabmo01 => 0 // generic monk abilities
  clabpa01 => 0 // generic paladin abilities
  clabpa05 => 0 // fallen paladin abilities
  clabpr01 => 0 // generic priest abilities
  clabrn01 => 0 // generic ranger abilities
  clabrn05 => 0 // fallen ranger abilities
  clabth01 => 0 // generic thief abilities
END

// add kit tables dynamically by reading kitlist
COPY_EXISTING ~kitlist.2da~ ~override~
  COUNT_2DA_ROWS ~9~ "rows"
  FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
    SET "exists" = 0
    READ_2DA_ENTRY "%index%" 5 9 "clab"
    DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN "%clab%" => 0 END
  END
  BUT_ONLY_IF_IT_CHANGES

// extend clab abilities to 50
ACTION_PHP_EACH cd_extend_clabs AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~[%WNL%%MNL%]+~ ~%LNL%~
        REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40[ %TAB%]*~
          ~\1\240\241\242\243\244\245\246\247\248\249\250~
        REPLACE_TEXTUALLY ~^\(ABILITY[0-9A-Z]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+\)\([ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%%LNL%]+\)[ %TAB%]*$~
          ~\1\2\2~
      END
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY

  END

END

// for EE
ACTION_FOR_EACH file IN startare startbp BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[0-9]+~ ~\1-1~
      BUT_ONLY

  END

END

// PRINT ~Thank you for installing: "Infiltrator Kit"~

BEGIN Priest_of_Mystra DESIGNATED 8
GROUP @100
REQUIRE_PREDICATE GAME_IS ~bgee bg2ee iwdee~ @25

ADD_KIT ~MAGE_PRIEST~ /* this is the "internal" name of your kit, like BERSERKER or LATHANDER */
  ~MAGE_PRIEST                0           0           1           1           0           1           0           0~ /* this line is appened to CLASWEAP.2DA */
  ~MAGE_PRIEST 0 0 0 0 1 1 0 1 0 0 0 0 0 0 0 0 1 1 0 0 1 1 1 0 0 0 0 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ /* this string is appened column-wise to WEAPPROF.2DA, starting with the third line*/
  ~MAGE_PRIEST                9       7       6       9       9       8~ /* this line is appened to ABCLASRQ.2DA */
  ~MAGE_PRIEST                0       0       0       0       0       0~ /* this line is appened to ABCLSMOD.2DA */
  ~MAGE_PRIEST                0       0       0       17      17      0~ /* this line is appened to ABDCDSRQ.2DA */
  ~MAGE_PRIEST                0       0       0       15      15      0~ /* this line is appened to ABDCSCRQ.2DA */
  ~MAGE_PRIEST                1       1       0       1       1       0       1       1       0~ /* this line is appened to ALIGNMNT.2DA */
  ~MAGE_PRIEST                0       0       0       0       0       0~ /* this line goes to DUALCLAS.2DA */
  ~Eldritch_Magic/2DA/EMCLABMP.2da~ /* this is the name of your abilities 2DA file, in the style of clabrn02.2da */
  ~~ /* These are the 2da files listed in KITTABLE.2DA that you want your kit to be a part of. List as many as you like. */
  ~0x01000000    3~ /* This is the "unusable" value you want for your kit and also the class value. These would normally appear at the end of KITLIST.2DA */
  ~Cl0~ /* This is the High Level Ability Abbreviation (see LUABBR.2DA) Normal values are Fi0, Pa0, etc. */
  ~CHAN09 * HELM07 BAG26 RING06 RING31 * BOOT01 AMUL20 BRAC10 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 HAMM07 SW1H27 STAF08~
  SAY ~mage-priest of mystra~
  SAY ~Mage-Priest of Mystra~
  SAY @8

COPY ~Eldritch_Magic/Spells/EMSIFIRE.spl~   ~override~
  SAY 0x8 @294
  SAY 0x50 @295
COPY ~Eldritch_Magic/BAF/EMMP.baf~   ~override~
COPY ~Eldritch_Magic/ITM/EMMP.itm~   ~override~ // Wizard-Clerics of Mystra
  SAY NAME1 ~~
  SAY NAME2 @293
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @8

ACTION_IF GAME_IS ~bgee~
 THEN BEGIN
COPY_EXISTING ~INN2616.sto~ ~override~
 ADD_STORE_ITEM ~EMMP~ LAST #1 #0 #0 ~IDENTIFIED~ #1
END
ACTION_IF GAME_IS ~bg2ee~
 THEN BEGIN
COPY_EXISTING ~RIBALD.sto~ ~override~
 ADD_STORE_ITEM ~EMMP~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~RIBALD2.sto~ ~override~
 ADD_STORE_ITEM ~EMMP~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~RIBALD3.sto~ ~override~
 ADD_STORE_ITEM ~EMMP~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~25SPELL.sto~ ~override~
 ADD_STORE_ITEM ~EMMP~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~25SPELL2.sto~ ~override~
 ADD_STORE_ITEM ~EMMP~ LAST #1 #0 #0 ~IDENTIFIED~ #1
END
ACTION_IF GAME_IS ~iwdee~
 THEN BEGIN
COPY_EXISTING ~EHPOMAB.sto~ ~override~
 ADD_STORE_ITEM ~EMMP~ LAST #1 #0 #0 ~IDENTIFIED~ #1
END

LAF fl#add_kit_ee
   INT_VAR
     biography = ~-1~
     briefdesc = 31255 // Normal briefdesc for clerics
     fallen = 0
     fallen_notice = ~-1~
   STR_VAR
     kit_name = MAGE_PRIEST
     clswpbon = ~0 0 3~
     numwslot = ~2~
     clascolr = ~25 28 57 2 24~ // Cleric colors
     clasiskl = ~0 0 0 0 0 0 0~
     clasthac = ~0~
     thiefscl = ~0 0 0 0 0 0 0 0~
     hpclass  = ~HPPRS~
     clsrcreq = ~0 0 1 0 0 0 0~

END

// Remove XP Cap
COPY  ~Eldritch_Magic/2DA/XPCAP.2DA~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTARE.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTBP.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/SODSTRTA.2DA~   ~override~

ACTION_CLEAR_ARRAY  cd_extend_tables
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN
  lvlmodwm => 0 // wild mage level modulation for wild surges
  monkfist => 0 // monk fist progression
  mxsplbrd => 0 // bard spell table
  mxspldd  => 0 // dragon disciple spell table
  mxspldru => 0 // druid spell table
  mxsplpal => 0 // paladin spell table
  mxsplprs => 0 // priest spell table
  mxsplran => 0 // ranger spell table
  mxsplsrc => 0 // sorcerer spell table
  mxsplwiz => 0 // mage spell table
  raisdead => 0 // raise dead temple prices
  splsrckn => 0 // sorcerer spell table
END

// extend hp tables for ee games
ACTION_IF FILE_EXISTS_IN_GAME hpclass.2da THEN BEGIN

  // add hp tables to list of tables to extend
  COPY_EXISTING ~hpclass.2da~ ~override~
    COUNT_2DA_ROWS ~2~ "rows"
    FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
      SET "exists" = 0
      READ_2DA_ENTRY "%index%" 1 2 "table"
      DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN "%table%" => 0 END
    END

END

// easy replacements for 2das with levels as rows
ACTION_PHP_EACH cd_extend_tables AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~^40\([ %TAB%].*\)~
          ~40\1
41\1
42\1
43\1
44\1
45\1
46\1
47\1
48\1
49\1
50\1~
      END
      UNLESS ~^50[ %TAB%]~
      BUT_ONLY_IF_IT_CHANGES
  END

END

// extend level-based abilities to 50; 2das with a zero column
ACTION_FOR_EACH file IN backstab crippstr layhands savemonk saveprs saverog savewar savewiz sneakatt thac0 xpbonus BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
       REPLACE_TEXTUALLY ~^\(.+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+\)\([ %TAB%]+[0-9]+\)~
        ~\1\2\2\2\2\2\2\2\2\2\2\2~
       REPLACE_TEXTUALLY ~\([ %TAB%]+\)40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40~
        ~\140\141\142\143\144\145\146\147\148\149\150~  
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY_IF_IT_CHANGES
      
  END

END

// extend level-based abilities to 50; wspatck
COPY_EXISTING ~wspatck.2da~ ~override~ // warrior bonus attacks for proficiencies and levels
  // everything else, extend from 41 to 50
  REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40~
    ~\1\240\241\242\243\244\245\246\247\248\249\250~
  REPLACE_TEXTUALLY ~^\([0-5]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+\)\([ %TAB%]+-?[0-9]+\)~
    ~\1\2\2\2\2\2\2\2\2\2\2\2~
  UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
  BUT_ONLY_IF_IT_CHANGES

ACTION_CLEAR_ARRAY  cd_extend_clabs
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN // start with class tables
  clabba01 => 0 // generic bard abilities
  clabdr01 => 0 // generic druid abilities
  clabfi01 => 0 // generic fighter abilities
  clabmo01 => 0 // generic monk abilities
  clabpa01 => 0 // generic paladin abilities
  clabpa05 => 0 // fallen paladin abilities
  clabpr01 => 0 // generic priest abilities
  clabrn01 => 0 // generic ranger abilities
  clabrn05 => 0 // fallen ranger abilities
  clabth01 => 0 // generic thief abilities
END

// add kit tables dynamically by reading kitlist
COPY_EXISTING ~kitlist.2da~ ~override~
  COUNT_2DA_ROWS ~9~ "rows"
  FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
    SET "exists" = 0
    READ_2DA_ENTRY "%index%" 5 9 "clab"
    DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN "%clab%" => 0 END
  END
  BUT_ONLY_IF_IT_CHANGES

// extend clab abilities to 50
ACTION_PHP_EACH cd_extend_clabs AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~[%WNL%%MNL%]+~ ~%LNL%~
        REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40[ %TAB%]*~
          ~\1\240\241\242\243\244\245\246\247\248\249\250~
        REPLACE_TEXTUALLY ~^\(ABILITY[0-9A-Z]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+\)\([ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%%LNL%]+\)[ %TAB%]*$~
          ~\1\2\2~
      END
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY

  END

END

// for EE
ACTION_FOR_EACH file IN startare startbp BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[0-9]+~ ~\1-1~
      BUT_ONLY

  END

END

 PRINT ~Thank you for installing: "Priest of Mystra Kit"~

BEGIN Priestess_of_Lolth DESIGNATED 9
GROUP @100
REQUIRE_PREDICATE GAME_IS ~bgee bg2ee iwdee~ @25

ADD_KIT ~PRIEST_LOLTH~ /* this is the "internal" name of your kit, like BERSERKER or LATHANDER */
  ~PRIEST_LOLTH                0           0           1           1           0           1           0           0~ /* this line is appened to CLASWEAP.2DA */
  ~PRIEST_LOLTH 0 0 0 0 1 1 0 1 0 0 0 0 0 0 0 0 1 1 0 0 1 1 1 0 0 0 0 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ /* this string is appened column-wise to WEAPPROF.2DA, starting with the third line*/
  ~PRIEST_LOLTH                9       7       6       8       9       8~ /* this line is appened to ABCLASRQ.2DA */
  ~PRIEST_LOLTH                0       1       0       1       0      -2~ /* this line is appened to ABCLSMOD.2DA */
  ~PRIEST_LOLTH                0       0       0       0       17      0~ /* this line is appened to ABDCDSRQ.2DA */
  ~PRIEST_LOLTH                0       0       0       0       15      0~ /* this line is appened to ABDCSCRQ.2DA */
  ~PRIEST_LOLTH                0       0       0       0       0       0       0       0       1~ /* this line is appened to ALIGNMNT.2DA */
  ~PRIEST_LOLTH                0       0       0       0       0       0~ /* this line goes to DUALCLAS.2DA */
  ~Eldritch_Magic/2DA/EMCLABLL.2da~ /* this is the name of your abilities 2DA file, in the style of clabrn02.2da */
  ~K_C_H    K_C_D   K_C_G   K_C_E   K_C_HE   K_C_HL   K_C_HO~ /* These are the 2da files listed in KITTABLE.2DA that you want your kit to be a part of. List as many as you like. */
  ~0x01000000    3~ /* This is the "unusable" value you want for your kit and also the class value. These would normally appear at the end of KITLIST.2DA */
  ~Cl0~ /* This is the High Level Ability Abbreviation (see LUABBR.2DA) Normal values are Fi0, Pa0, etc. */
  ~CHAN09 * HELM07 BAG26 RING06 RING31 * BOOT01 AMUL20 BRAC10 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 HAMM07 SW1H27 STAF08~
  SAY ~priestess of lolth~
  SAY ~Priestess of Lolth~
  SAY @9

COPY ~Eldritch_Magic/Spells/EMCDSYM.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMLOLTH.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMMRES.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMVENOM.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMWEB.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMSPCLL1.spl~   ~override~
     SAY 0x8 @251
     SAY 0x50 @252
COPY ~Eldritch_Magic/Spells/EMSPCLL2.spl~   ~override~
     SAY 0x8 @253
     SAY 0x50 @254
COPY ~Eldritch_Magic/ITM/EMLOLTH.itm~ ~override~ // Holy Symbol of Lolth
  SAY NAME1 ~~
  SAY NAME2 @136
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @137

LAF fl#add_kit_ee
   INT_VAR
     biography = ~-1~
     briefdesc = 31255 // Normal briefdesc for clerics
     fallen = 0
     fallen_notice = ~-1~
   STR_VAR
     kit_name = PRIEST_LOLTH
     clswpbon = ~0 0 3~
     numwslot = ~2~
     clascolr = ~25 83 66 28 23~ // Priest of Talos colors
     clasiskl = ~0 0 0 0 0 0 0~
     clasthac = ~0~
     thiefscl = ~0 0 0 0 0 0 0 0~
     hpclass  = ~HPPRS~
     clsrcreq = ~0 1 0 0 0 0 0~

END

// Remove XP Cap
COPY  ~Eldritch_Magic/2DA/XPCAP.2DA~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTARE.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTBP.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/SODSTRTA.2DA~   ~override~

ACTION_CLEAR_ARRAY  cd_extend_tables
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN
  lvlmodwm => 0 // wild mage level modulation for wild surges
  monkfist => 0 // monk fist progression
  mxsplbrd => 0 // bard spell table
  mxspldd  => 0 // dragon disciple spell table
  mxspldru => 0 // druid spell table
  mxsplpal => 0 // paladin spell table
  mxsplprs => 0 // priest spell table
  mxsplran => 0 // ranger spell table
  mxsplsrc => 0 // sorcerer spell table
  mxsplwiz => 0 // mage spell table
  raisdead => 0 // raise dead temple prices
  splsrckn => 0 // sorcerer spell table
END

// extend hp tables for ee games
ACTION_IF FILE_EXISTS_IN_GAME hpclass.2da THEN BEGIN

  // add hp tables to list of tables to extend
  COPY_EXISTING ~hpclass.2da~ ~override~
    COUNT_2DA_ROWS ~2~ "rows"
    FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
      SET "exists" = 0
      READ_2DA_ENTRY "%index%" 1 2 "table"
      DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN "%table%" => 0 END
    END

END

// easy replacements for 2das with levels as rows
ACTION_PHP_EACH cd_extend_tables AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~^40\([ %TAB%].*\)~
          ~40\1
41\1
42\1
43\1
44\1
45\1
46\1
47\1
48\1
49\1
50\1~
      END
      UNLESS ~^50[ %TAB%]~
      BUT_ONLY_IF_IT_CHANGES
  END

END

// extend level-based abilities to 50; 2das with a zero column
ACTION_FOR_EACH file IN backstab crippstr layhands savemonk saveprs saverog savewar savewiz sneakatt thac0 xpbonus BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
       REPLACE_TEXTUALLY ~^\(.+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+\)\([ %TAB%]+[0-9]+\)~
        ~\1\2\2\2\2\2\2\2\2\2\2\2~
       REPLACE_TEXTUALLY ~\([ %TAB%]+\)40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40~
        ~\140\141\142\143\144\145\146\147\148\149\150~  
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY_IF_IT_CHANGES
      
  END

END

// extend level-based abilities to 50; wspatck
COPY_EXISTING ~wspatck.2da~ ~override~ // warrior bonus attacks for proficiencies and levels
  // everything else, extend from 41 to 50
  REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40~
    ~\1\240\241\242\243\244\245\246\247\248\249\250~
  REPLACE_TEXTUALLY ~^\([0-5]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+\)\([ %TAB%]+-?[0-9]+\)~
    ~\1\2\2\2\2\2\2\2\2\2\2\2~
  UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
  BUT_ONLY_IF_IT_CHANGES

ACTION_CLEAR_ARRAY  cd_extend_clabs
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN // start with class tables
  clabba01 => 0 // generic bard abilities
  clabdr01 => 0 // generic druid abilities
  clabfi01 => 0 // generic fighter abilities
  clabmo01 => 0 // generic monk abilities
  clabpa01 => 0 // generic paladin abilities
  clabpa05 => 0 // fallen paladin abilities
  clabpr01 => 0 // generic priest abilities
  clabrn01 => 0 // generic ranger abilities
  clabrn05 => 0 // fallen ranger abilities
  clabth01 => 0 // generic thief abilities
END

// add kit tables dynamically by reading kitlist
COPY_EXISTING ~kitlist.2da~ ~override~
  COUNT_2DA_ROWS ~9~ "rows"
  FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
    SET "exists" = 0
    READ_2DA_ENTRY "%index%" 5 9 "clab"
    DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN "%clab%" => 0 END
  END
  BUT_ONLY_IF_IT_CHANGES

// extend clab abilities to 50
ACTION_PHP_EACH cd_extend_clabs AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~[%WNL%%MNL%]+~ ~%LNL%~
        REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40[ %TAB%]*~
          ~\1\240\241\242\243\244\245\246\247\248\249\250~
        REPLACE_TEXTUALLY ~^\(ABILITY[0-9A-Z]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+\)\([ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%%LNL%]+\)[ %TAB%]*$~
          ~\1\2\2~
      END
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY

  END

END

// for EE
ACTION_FOR_EACH file IN startare startbp BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[0-9]+~ ~\1-1~
      BUT_ONLY

  END

END

 PRINT ~Thank you for installing: "Priestess of Lolth Kit"~

//BEGIN Spellfilcher DESIGNATED 10
//GROUP @100
//REQUIRE_PREDICATE GAME_IS ~bgee bg2ee iwdee~ @25

ADD_KIT ~SPELL_FILCHER~ /* this is the "internal" name of your kit, like BERSERKER or LATHANDER */
  ~SPELL_FILCHER                1           1           1           1           1           1           1           1~ /* this line is appened to CLASWEAP.2DA */
  ~SPELL_FILCHER 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ /* this string is appened column-wise to WEAPPROF.2DA, starting with the third line*/
  ~SPELL_FILCHER                9       9       6       9       3       8~ /* this line is appened to ABCLASRQ.2DA */
  ~SPELL_FILCHER                0       0       0       0       0       0~ /* this line is appened to ABCLSMOD.2DA */
  ~SPELL_FILCHER                0       17      0       17      0       0~ /* this line is appened to ABDCDSRQ.2DA */
  ~SPELL_FILCHER                0       15      0       15      0       0~ /* this line is appened to ABDCSCRQ.2DA */
  ~SPELL_FILCHER                0       1       1       0       1       1       0       0       0~ /* this line is appened to ALIGNMNT.2DA */
  ~SPELL_FILCHER                0       0       0       0       0       0~ /* this line goes to DUALCLAS.2DA */
  ~Eldritch_Magic/2DA/EMCLABEK.2da~ /* this is the name of your abilities 2DA file, in the style of clabrn02.2da */
  ~~ /* These are the 2da files listed in KITTABLE.2DA that you want your kit to be a part of. List as many as you like. */
  ~0x00000001    4~ /* This is the "unusable" value you want for your kit and also the class value. These would normally appear at the end of KITLIST.2DA */
  ~Fi0~ /* This is the High Level Ability Abbreviation (see LUABBR.2DA) Normal values are Fi0, Pa0, etc. */
  ~CHAN09 * HELM07 BAG20 RING06 RING31 * BOOT01 AMUL19 BRAC16 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 HAMM07 SW1H27 STAF08~ // Fighter ToB starting weapons
  SAY ~spellfilcher~
  SAY ~Spellfilcher~
  SAY @10

COPY ~Eldritch_Magic/ITM/EMFILCH.itm~   ~override~ // Spellfilcher's License
  SAY NAME1 ~~
  SAY NAME2 @301
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @10
  
ACTION_IF GAME_IS ~bgee~
 THEN BEGIN
COPY_EXISTING ~INN2616.sto~ ~override~
 ADD_STORE_ITEM ~EMFILCH~ LAST #1 #0 #0 ~IDENTIFIED~ #1
END
ACTION_IF GAME_IS ~bg2ee~
 THEN BEGIN
COPY_EXISTING ~RIBALD.sto~ ~override~
 ADD_STORE_ITEM ~EMFILCH~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~RIBALD2.sto~ ~override~
 ADD_STORE_ITEM ~EMFILCH~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~RIBALD3.sto~ ~override~
 ADD_STORE_ITEM ~EMFILCH~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~25SPELL.sto~ ~override~
 ADD_STORE_ITEM ~EMFILCH~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~25SPELL2.sto~ ~override~
 ADD_STORE_ITEM ~EMFILCH~ LAST #1 #0 #0 ~IDENTIFIED~ #1
END
ACTION_IF GAME_IS ~iwdee~
 THEN BEGIN
COPY_EXISTING ~EHPOMAB.sto~ ~override~
 ADD_STORE_ITEM ~EMFILCH~ LAST #1 #0 #0 ~IDENTIFIED~ #1
END

LAF fl#add_kit_ee
  INT_VAR
    biography = ~-1~
    briefdesc = 102499 // Normal briefdesc for fighter/mages
    fallen = 0
    fallen_notice = ~-1~
  STR_VAR
    kit_name = SPELL_FILCHER
    clswpbon = ~1 0 2~
    numwslot = ~2~
    clascolr = ~30 91 93 23 93~ // Fighter colors
    clasiskl = ~0 0 0 0 0 0 0~
    clasthac = ~0~
    thiefscl = ~0 0 0 0 0 0 0 0~
    hpclass  = ~HPWAR~
    clsrcreq = ~0 0 0 0 0 0 0~

END

// Remove XP Cap
COPY  ~Eldritch_Magic/2DA/XPCAP.2DA~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTARE.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTBP.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/SODSTRTA.2DA~   ~override~

ACTION_CLEAR_ARRAY  cd_extend_tables
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN
  lvlmodwm => 0 // wild mage level modulation for wild surges
  monkfist => 0 // monk fist progression
  mxsplbrd => 0 // bard spell table
  mxspldd  => 0 // dragon disciple spell table
  mxspldru => 0 // druid spell table
  mxsplpal => 0 // paladin spell table
  mxsplprs => 0 // priest spell table
  mxsplran => 0 // ranger spell table
  mxsplsrc => 0 // sorcerer spell table
  mxsplwiz => 0 // mage spell table
  raisdead => 0 // raise dead temple prices
  splsrckn => 0 // sorcerer spell table
END

// extend hp tables for ee games
ACTION_IF FILE_EXISTS_IN_GAME hpclass.2da THEN BEGIN

  // add hp tables to list of tables to extend
  COPY_EXISTING ~hpclass.2da~ ~override~
    COUNT_2DA_ROWS ~2~ "rows"
    FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
      SET "exists" = 0
      READ_2DA_ENTRY "%index%" 1 2 "table"
      DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN "%table%" => 0 END
    END

END

// easy replacements for 2das with levels as rows
ACTION_PHP_EACH cd_extend_tables AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~^40\([ %TAB%].*\)~
          ~40\1
41\1
42\1
43\1
44\1
45\1
46\1
47\1
48\1
49\1
50\1~
      END
      UNLESS ~^50[ %TAB%]~
      BUT_ONLY_IF_IT_CHANGES
  END

END

// extend level-based abilities to 50; 2das with a zero column
ACTION_FOR_EACH file IN backstab crippstr layhands savemonk saveprs saverog savewar savewiz sneakatt thac0 xpbonus BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
       REPLACE_TEXTUALLY ~^\(.+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+\)\([ %TAB%]+[0-9]+\)~
        ~\1\2\2\2\2\2\2\2\2\2\2\2~
       REPLACE_TEXTUALLY ~\([ %TAB%]+\)40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40~
        ~\140\141\142\143\144\145\146\147\148\149\150~  
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY_IF_IT_CHANGES
      
  END

END

// extend level-based abilities to 50; wspatck
COPY_EXISTING ~wspatck.2da~ ~override~ // warrior bonus attacks for proficiencies and levels
  // everything else, extend from 41 to 50
  REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40~
    ~\1\240\241\242\243\244\245\246\247\248\249\250~
  REPLACE_TEXTUALLY ~^\([0-5]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+\)\([ %TAB%]+-?[0-9]+\)~
    ~\1\2\2\2\2\2\2\2\2\2\2\2~
  UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
  BUT_ONLY_IF_IT_CHANGES

ACTION_CLEAR_ARRAY  cd_extend_clabs
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN // start with class tables
  clabba01 => 0 // generic bard abilities
  clabdr01 => 0 // generic druid abilities
  clabfi01 => 0 // generic fighter abilities
  clabmo01 => 0 // generic monk abilities
  clabpa01 => 0 // generic paladin abilities
  clabpa05 => 0 // fallen paladin abilities
  clabpr01 => 0 // generic priest abilities
  clabrn01 => 0 // generic ranger abilities
  clabrn05 => 0 // fallen ranger abilities
  clabth01 => 0 // generic thief abilities
END

// add kit tables dynamically by reading kitlist
COPY_EXISTING ~kitlist.2da~ ~override~
  COUNT_2DA_ROWS ~9~ "rows"
  FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
    SET "exists" = 0
    READ_2DA_ENTRY "%index%" 5 9 "clab"
    DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN "%clab%" => 0 END
  END
  BUT_ONLY_IF_IT_CHANGES

// extend clab abilities to 50
ACTION_PHP_EACH cd_extend_clabs AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~[%WNL%%MNL%]+~ ~%LNL%~
        REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40[ %TAB%]*~
          ~\1\240\241\242\243\244\245\246\247\248\249\250~
        REPLACE_TEXTUALLY ~^\(ABILITY[0-9A-Z]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+\)\([ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%%LNL%]+\)[ %TAB%]*$~
          ~\1\2\2~
      END
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY

  END

END

// for EE
ACTION_FOR_EACH file IN startare startbp BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[0-9]+~ ~\1-1~
      BUT_ONLY

  END

END

// PRINT ~Thank you for installing: "Spellfilcher Kit"~

BEGIN Undead_Hunter_for_Elves DESIGNATED 11
GROUP @100
REQUIRE_PREDICATE GAME_IS ~bgee bg2ee iwdee~ @25

// Enables elven paladins
COPY_EXISTING ~clsrcreq.2da~ ~override~
  COUNT_2DA_ROWS 8 rows
  FOR (row = 0 ; row < rows ; ++row) BEGIN
    READ_2DA_ENTRY row 0 8 entry
    PATCH_IF ("%entry%" STRING_COMPARE_CASE "PALADIN"      = 0) BEGIN
      FOR (col = 2; col < 3 ; ++col) BEGIN
        SET_2DA_ENTRY row col 8 1
      END
    END
  END
  PRETTY_PRINT_2DA
  BUT_ONLY

// Enables elven undead hunters
COPY_EXISTING ~clsrcreq.2da~ ~override~
  COUNT_2DA_ROWS 8 rows
  FOR (row = 0 ; row < rows ; ++row) BEGIN
    READ_2DA_ENTRY row 0 8 entry
    PATCH_IF ("%entry%" STRING_COMPARE_CASE "UNDEAD_HUNTER"      = 0) BEGIN
      FOR (col = 2; col < 3 ; ++col) BEGIN
        SET_2DA_ENTRY row col 8 1
      END
    END
  END
  PRETTY_PRINT_2DA
  BUT_ONLY

// Remove XP Cap
COPY  ~Eldritch_Magic/2DA/XPCAP.2DA~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTARE.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTBP.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/SODSTRTA.2DA~   ~override~

ACTION_CLEAR_ARRAY  cd_extend_tables
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN
  lvlmodwm => 0 // wild mage level modulation for wild surges
  monkfist => 0 // monk fist progression
  mxsplbrd => 0 // bard spell table
  mxspldd  => 0 // dragon disciple spell table
  mxspldru => 0 // druid spell table
  mxsplpal => 0 // paladin spell table
  mxsplprs => 0 // priest spell table
  mxsplran => 0 // ranger spell table
  mxsplsrc => 0 // sorcerer spell table
  mxsplwiz => 0 // mage spell table
  raisdead => 0 // raise dead temple prices
  splsrckn => 0 // sorcerer spell table
END

// extend hp tables for ee games
ACTION_IF FILE_EXISTS_IN_GAME hpclass.2da THEN BEGIN

  // add hp tables to list of tables to extend
  COPY_EXISTING ~hpclass.2da~ ~override~
    COUNT_2DA_ROWS ~2~ "rows"
    FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
      SET "exists" = 0
      READ_2DA_ENTRY "%index%" 1 2 "table"
      DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN "%table%" => 0 END
    END

END

// easy replacements for 2das with levels as rows
ACTION_PHP_EACH cd_extend_tables AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~^40\([ %TAB%].*\)~
          ~40\1
41\1
42\1
43\1
44\1
45\1
46\1
47\1
48\1
49\1
50\1~
      END
      UNLESS ~^50[ %TAB%]~
      BUT_ONLY_IF_IT_CHANGES
  END

END

// extend level-based abilities to 50; 2das with a zero column
ACTION_FOR_EACH file IN backstab crippstr layhands savemonk saveprs saverog savewar savewiz sneakatt thac0 xpbonus BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
       REPLACE_TEXTUALLY ~^\(.+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+\)\([ %TAB%]+[0-9]+\)~
        ~\1\2\2\2\2\2\2\2\2\2\2\2~
       REPLACE_TEXTUALLY ~\([ %TAB%]+\)40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40~
        ~\140\141\142\143\144\145\146\147\148\149\150~  
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY_IF_IT_CHANGES
      
  END

END

// extend level-based abilities to 50; wspatck
COPY_EXISTING ~wspatck.2da~ ~override~ // warrior bonus attacks for proficiencies and levels
  // everything else, extend from 41 to 50
  REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40~
    ~\1\240\241\242\243\244\245\246\247\248\249\250~
  REPLACE_TEXTUALLY ~^\([0-5]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+\)\([ %TAB%]+-?[0-9]+\)~
    ~\1\2\2\2\2\2\2\2\2\2\2\2~
  UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
  BUT_ONLY_IF_IT_CHANGES

ACTION_CLEAR_ARRAY  cd_extend_clabs
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN // start with class tables
  clabba01 => 0 // generic bard abilities
  clabdr01 => 0 // generic druid abilities
  clabfi01 => 0 // generic fighter abilities
  clabmo01 => 0 // generic monk abilities
  clabpa01 => 0 // generic paladin abilities
  clabpa05 => 0 // fallen paladin abilities
  clabpr01 => 0 // generic priest abilities
  clabrn01 => 0 // generic ranger abilities
  clabrn05 => 0 // fallen ranger abilities
  clabth01 => 0 // generic thief abilities
END

// add kit tables dynamically by reading kitlist
COPY_EXISTING ~kitlist.2da~ ~override~
  COUNT_2DA_ROWS ~9~ "rows"
  FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
    SET "exists" = 0
    READ_2DA_ENTRY "%index%" 5 9 "clab"
    DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN "%clab%" => 0 END
  END
  BUT_ONLY_IF_IT_CHANGES

// extend clab abilities to 50
ACTION_PHP_EACH cd_extend_clabs AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~[%WNL%%MNL%]+~ ~%LNL%~
        REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40[ %TAB%]*~
          ~\1\240\241\242\243\244\245\246\247\248\249\250~
        REPLACE_TEXTUALLY ~^\(ABILITY[0-9A-Z]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+\)\([ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%%LNL%]+\)[ %TAB%]*$~
          ~\1\2\2~
      END
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY

  END

END

// for EE
ACTION_FOR_EACH file IN startare startbp BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[0-9]+~ ~\1-1~
      BUT_ONLY

  END

END

PRINT ~Thank you for installing: "Undead Hunter for Elves"~

BEGIN War_Wizard DESIGNATED 12
GROUP @100
REQUIRE_PREDICATE GAME_IS ~bgee bg2ee iwdee~ @25

ADD_KIT ~WAR_WIZ~ /* this is the "internal" name of your kit, like BERSERKER or LATHANDER */
  ~WAR_WIZ                1           1           1           1           1           1           1           1~ /* this line is appened to CLASWEAP.2DA */
  ~WAR_WIZ 5 5 1 5 5 5 5 1 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 1 1 1 1 1 2 2 2 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ /* this string is appened column-wise to WEAPPROF.2DA, starting with the third line*/
  ~WAR_WIZ                9       7       6       9       3       8~ /* this line is appened to ABCLASRQ.2DA */
  ~WAR_WIZ                0       0       0       0       0       0~ /* this line is appened to ABCLSMOD.2DA */
  ~WAR_WIZ                17      0       0       17      0       0~ /* this line is appened to ABDCDSRQ.2DA */
  ~WAR_WIZ                15      0       0       15      0       0~ /* this line is appened to ABDCSCRQ.2DA */
  ~WAR_WIZ                1       1       0       1       1       0       1       1       0~ /* this line is appened to ALIGNMNT.2DA */
  ~WAR_WIZ                0       0       0       0       0       0~ /* this line goes to DUALCLAS.2DA */
  ~Eldritch_Magic/2DA/EMCLABWW.2da~ /* this is the name of your abilities 2DA file, in the style of clabrn02.2da */
  ~~ /* These are the 2da files listed in KITTABLE.2DA that you want your kit to be a part of. List as many as you like. */
  ~0x00000001    2~ /* This is the "unusable" value you want for your kit and also the class value. These would normally appear at the end of KITLIST.2DA */
  ~Fi0~ /* This is the High Level Ability Abbreviation (see LUABBR.2DA) Normal values are Fi0, Pa0, etc. */
  ~CHAN09 * HELM07 BAG26 RING06 RING31 * BOOT01 AMUL20 BRAC10 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 HAMM07 SW1H27 STAF08~
  SAY ~war wizard~
  SAY ~War Wizard~
  SAY @12

COPY ~Eldritch_Magic/ITM/EMWARWIZ.itm~   ~override~ // The Elven Arts of War and Wizardry
  SAY NAME1 ~~
  SAY NAME2 @287
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @12

ACTION_IF GAME_IS ~bgee~
 THEN BEGIN
COPY ~Eldritch_Magic/2DA/EMCLABWW.2da~   ~override~
COPY_EXISTING ~INN2616.sto~ ~override~
 ADD_STORE_ITEM ~EMWARWIZ~ LAST #1 #0 #0 ~IDENTIFIED~ #1
END
ACTION_IF GAME_IS ~bg2ee~
 THEN BEGIN
COPY ~Eldritch_Magic/2DA/BG2EE/EMCLABWW.2da~   ~override~
COPY_EXISTING ~RIBALD.sto~ ~override~
 ADD_STORE_ITEM ~EMWARWIZ~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~RIBALD2.sto~ ~override~
 ADD_STORE_ITEM ~EMWARWIZ~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~RIBALD3.sto~ ~override~
 ADD_STORE_ITEM ~EMWARWIZ~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~25SPELL.sto~ ~override~
 ADD_STORE_ITEM ~EMWARWIZ~ LAST #1 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~25SPELL2.sto~ ~override~
 ADD_STORE_ITEM ~EMWARWIZ~ LAST #1 #0 #0 ~IDENTIFIED~ #1
END
ACTION_IF GAME_IS ~iwdee~
 THEN BEGIN
COPY_EXISTING ~EHPOMAB.sto~ ~override~
 ADD_STORE_ITEM ~EMWARWIZ~ LAST #1 #0 #0 ~IDENTIFIED~ #1
END

COPY ~Eldritch_Magic/Spells/EMWW0.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMWW1.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMWW2.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMWW3.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMENWEAP.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMMORDSD.spl~   ~override~
COMPILE ~Eldritch_Magic/BAF/EMWARWIZ.baf~   ~override~
COPY ~Eldritch_Magic/Creatures/EMWARWIZ.cre~   ~override~

LAF fl#add_kit_ee
   INT_VAR
     biography = ~-1~
     briefdesc = 102499 // Normal briefdesc for fighter/mages
     fallen = 0
     fallen_notice = ~-1~
   STR_VAR
     kit_name = WAR_WIZ
     clswpbon = ~1 0 2~
     numwslot = ~2~
     clascolr = ~57 58 122 1 43~ // F/M colors
     clasiskl = ~0 0 0 0 0 0 0~
     clasthac = ~0~
     thiefscl = ~0 0 0 0 0 0 0 0~
     hpclass  = ~HPWAR~
     clsrcreq = ~0 1 0 0 0 0 0~

END

// Remove XP Cap
COPY  ~Eldritch_Magic/2DA/XPCAP.2DA~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTARE.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTBP.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/SODSTRTA.2DA~   ~override~

ACTION_CLEAR_ARRAY  cd_extend_tables
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN
  lvlmodwm => 0 // wild mage level modulation for wild surges
  monkfist => 0 // monk fist progression
  mxsplbrd => 0 // bard spell table
  mxspldd  => 0 // dragon disciple spell table
  mxspldru => 0 // druid spell table
  mxsplpal => 0 // paladin spell table
  mxsplprs => 0 // priest spell table
  mxsplran => 0 // ranger spell table
  mxsplsrc => 0 // sorcerer spell table
  mxsplwiz => 0 // mage spell table
  raisdead => 0 // raise dead temple prices
  splsrckn => 0 // sorcerer spell table
END

// extend hp tables for ee games
ACTION_IF FILE_EXISTS_IN_GAME hpclass.2da THEN BEGIN

  // add hp tables to list of tables to extend
  COPY_EXISTING ~hpclass.2da~ ~override~
    COUNT_2DA_ROWS ~2~ "rows"
    FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
      SET "exists" = 0
      READ_2DA_ENTRY "%index%" 1 2 "table"
      DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN "%table%" => 0 END
    END

END

// easy replacements for 2das with levels as rows
ACTION_PHP_EACH cd_extend_tables AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~^40\([ %TAB%].*\)~
          ~40\1
41\1
42\1
43\1
44\1
45\1
46\1
47\1
48\1
49\1
50\1~
      END
      UNLESS ~^50[ %TAB%]~
      BUT_ONLY_IF_IT_CHANGES
  END

END

// extend level-based abilities to 50; 2das with a zero column
ACTION_FOR_EACH file IN backstab crippstr layhands savemonk saveprs saverog savewar savewiz sneakatt thac0 xpbonus BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
       REPLACE_TEXTUALLY ~^\(.+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+\)\([ %TAB%]+[0-9]+\)~
        ~\1\2\2\2\2\2\2\2\2\2\2\2~
       REPLACE_TEXTUALLY ~\([ %TAB%]+\)40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40~
        ~\140\141\142\143\144\145\146\147\148\149\150~  
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY_IF_IT_CHANGES
      
  END

END

// extend level-based abilities to 50; wspatck
COPY_EXISTING ~wspatck.2da~ ~override~ // warrior bonus attacks for proficiencies and levels
  // everything else, extend from 41 to 50
  REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40~
    ~\1\240\241\242\243\244\245\246\247\248\249\250~
  REPLACE_TEXTUALLY ~^\([0-5]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+\)\([ %TAB%]+-?[0-9]+\)~
    ~\1\2\2\2\2\2\2\2\2\2\2\2~
  UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
  BUT_ONLY_IF_IT_CHANGES

ACTION_CLEAR_ARRAY  cd_extend_clabs
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN // start with class tables
  clabba01 => 0 // generic bard abilities
  clabdr01 => 0 // generic druid abilities
  clabfi01 => 0 // generic fighter abilities
  clabmo01 => 0 // generic monk abilities
  clabpa01 => 0 // generic paladin abilities
  clabpa05 => 0 // fallen paladin abilities
  clabpr01 => 0 // generic priest abilities
  clabrn01 => 0 // generic ranger abilities
  clabrn05 => 0 // fallen ranger abilities
  clabth01 => 0 // generic thief abilities
END

// add kit tables dynamically by reading kitlist
COPY_EXISTING ~kitlist.2da~ ~override~
  COUNT_2DA_ROWS ~9~ "rows"
  FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
    SET "exists" = 0
    READ_2DA_ENTRY "%index%" 5 9 "clab"
    DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN "%clab%" => 0 END
  END
  BUT_ONLY_IF_IT_CHANGES

// extend clab abilities to 50
ACTION_PHP_EACH cd_extend_clabs AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~[%WNL%%MNL%]+~ ~%LNL%~
        REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40[ %TAB%]*~
          ~\1\240\241\242\243\244\245\246\247\248\249\250~
        REPLACE_TEXTUALLY ~^\(ABILITY[0-9A-Z]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+\)\([ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%%LNL%]+\)[ %TAB%]*$~
          ~\1\2\2~
      END
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY

  END

END

// for EE
ACTION_FOR_EACH file IN startare startbp BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[0-9]+~ ~\1-1~
      BUT_ONLY

  END

END

 PRINT ~Thank you for installing: "War Wizard Kit"~

BEGIN Wildnerness_Runner DESIGNATED 13
GROUP @100
REQUIRE_PREDICATE GAME_IS ~bgee bg2ee iwdee~ @25

ADD_KIT ~WILD_RUN~ /* this is the "internal" name of your kit, like BERSERKER or LATHANDER */
  ~WILD_RUN                1           1           1           1           1           1           1           1~ /* this line is appened to CLASWEAP.2DA */
  ~WILD_RUN 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ /* this string is appened column-wise to WEAPPROF.2DA, starting with the third line*/
  ~WILD_RUN                13      13      14      8       14      8~ /* this line is appened to ABCLASRQ.2DA */
  ~WILD_RUN                0       0       1       0       0      -1~ /* this line is appened to ABCLSMOD.2DA */
  ~WILD_RUN                17      17      17      0       17      0~ /* this line is appened to ABDCDSRQ.2DA */
  ~WILD_RUN                15      15      15      0       15      0~ /* this line is appened to ABDCSCRQ.2DA */
  ~WILD_RUN                0       0       0       0       0       0       1       0       0~ /* this line is appened to ALIGNMNT.2DA */
  ~WILD_RUN                0       0       0       0       0       0~ /* this line goes to DUALCLAS.2DA */
  ~Eldritch_Magic/2DA/EMCLABWR.2da~ /* this is the name of your abilities 2DA file, in the style of clabrn02.2da */
  ~K_R_H    K_R_D   K_R_G   K_R_E   K_R_HE   K_R_HL   K_R_HO~ /* These are the 2da files listed in KITTABLE.2DA that you want your kit to be a part of. List as many as you like. */
  ~0x00010000    12~ /* This is the "unusable" value you want for your kit and also the class value. These would normally appear at the end of KITLIST.2DA */
  ~Ra0~ /* This is the High Level Ability Abbreviation (see LUABBR.2DA) Normal values are Fi0, Pa0, etc. */
  ~CHAN09 * HELM07 BAG26 RING06 RING31 * BOOT01 AMUL20 BRAC10 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 HAMM07 SW1H27 STAF08~
  SAY ~wilderness runner~
  SAY ~Wilderness Runner~
  SAY @13

COPY ~Eldritch_Magic/Spells/EMWILD1.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMWILD2.spl~   ~override~

LAF fl#add_kit_ee
   INT_VAR
     biography = ~-1~
     briefdesc = 102499 // Normal briefdesc for fighter/mages
     fallen = 0
     fallen_notice = ~-1~
   STR_VAR
     kit_name = WILD_RUN
     clswpbon = ~1 0 2~
     numwslot = ~3~
     clascolr = ~30 37 86 1 110~ // Ranger colors
     clasiskl = ~0 0 0 0 0 0 0~
     clasthac = ~0~
     thiefscl = ~0 0 0 0 0 0 0 0~
     hpclass  = ~HPWAR~
     clsrcreq = ~0 1 0 0 0 0 0~

END

// Remove XP Cap
COPY  ~Eldritch_Magic/2DA/XPCAP.2DA~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTARE.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTBP.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/SODSTRTA.2DA~   ~override~

ACTION_CLEAR_ARRAY  cd_extend_tables
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN
  lvlmodwm => 0 // wild mage level modulation for wild surges
  monkfist => 0 // monk fist progression
  mxsplbrd => 0 // bard spell table
  mxspldd  => 0 // dragon disciple spell table
  mxspldru => 0 // druid spell table
  mxsplpal => 0 // paladin spell table
  mxsplprs => 0 // priest spell table
  mxsplran => 0 // ranger spell table
  mxsplsrc => 0 // sorcerer spell table
  mxsplwiz => 0 // mage spell table
  raisdead => 0 // raise dead temple prices
  splsrckn => 0 // sorcerer spell table
END

// extend hp tables for ee games
ACTION_IF FILE_EXISTS_IN_GAME hpclass.2da THEN BEGIN

  // add hp tables to list of tables to extend
  COPY_EXISTING ~hpclass.2da~ ~override~
    COUNT_2DA_ROWS ~2~ "rows"
    FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
      SET "exists" = 0
      READ_2DA_ENTRY "%index%" 1 2 "table"
      DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN "%table%" => 0 END
    END

END

// easy replacements for 2das with levels as rows
ACTION_PHP_EACH cd_extend_tables AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~^40\([ %TAB%].*\)~
          ~40\1
41\1
42\1
43\1
44\1
45\1
46\1
47\1
48\1
49\1
50\1~
      END
      UNLESS ~^50[ %TAB%]~
      BUT_ONLY_IF_IT_CHANGES
  END

END

// extend level-based abilities to 50; 2das with a zero column
ACTION_FOR_EACH file IN backstab crippstr layhands savemonk saveprs saverog savewar savewiz sneakatt thac0 xpbonus BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
       REPLACE_TEXTUALLY ~^\(.+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+\)\([ %TAB%]+[0-9]+\)~
        ~\1\2\2\2\2\2\2\2\2\2\2\2~
       REPLACE_TEXTUALLY ~\([ %TAB%]+\)40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40~
        ~\140\141\142\143\144\145\146\147\148\149\150~  
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY_IF_IT_CHANGES
      
  END

END

// extend level-based abilities to 50; wspatck
COPY_EXISTING ~wspatck.2da~ ~override~ // warrior bonus attacks for proficiencies and levels
  // everything else, extend from 41 to 50
  REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40~
    ~\1\240\241\242\243\244\245\246\247\248\249\250~
  REPLACE_TEXTUALLY ~^\([0-5]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+\)\([ %TAB%]+-?[0-9]+\)~
    ~\1\2\2\2\2\2\2\2\2\2\2\2~
  UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
  BUT_ONLY_IF_IT_CHANGES

ACTION_CLEAR_ARRAY  cd_extend_clabs
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN // start with class tables
  clabba01 => 0 // generic bard abilities
  clabdr01 => 0 // generic druid abilities
  clabfi01 => 0 // generic fighter abilities
  clabmo01 => 0 // generic monk abilities
  clabpa01 => 0 // generic paladin abilities
  clabpa05 => 0 // fallen paladin abilities
  clabpr01 => 0 // generic priest abilities
  clabrn01 => 0 // generic ranger abilities
  clabrn05 => 0 // fallen ranger abilities
  clabth01 => 0 // generic thief abilities
END

// add kit tables dynamically by reading kitlist
COPY_EXISTING ~kitlist.2da~ ~override~
  COUNT_2DA_ROWS ~9~ "rows"
  FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
    SET "exists" = 0
    READ_2DA_ENTRY "%index%" 5 9 "clab"
    DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN "%clab%" => 0 END
  END
  BUT_ONLY_IF_IT_CHANGES

// extend clab abilities to 50
ACTION_PHP_EACH cd_extend_clabs AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~[%WNL%%MNL%]+~ ~%LNL%~
        REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40[ %TAB%]*~
          ~\1\240\241\242\243\244\245\246\247\248\249\250~
        REPLACE_TEXTUALLY ~^\(ABILITY[0-9A-Z]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+\)\([ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%%LNL%]+\)[ %TAB%]*$~
          ~\1\2\2~
      END
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY

  END

END

// for EE
ACTION_FOR_EACH file IN startare startbp BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[0-9]+~ ~\1-1~
      BUT_ONLY

  END

END

 PRINT ~Thank you for installing: "Wilderness Runner Kit"~
 
BEGIN Windrider DESIGNATED 14
GROUP @100
REQUIRE_PREDICATE GAME_IS ~bgee bg2ee iwdee~ @25

ADD_KIT ~WIND_RIDER~ /* this is the "internal" name of your kit, like BERSERKER or LATHANDER */
  ~WIND_RIDER                1           1           1           1           1           1           1           1~ /* this line is appened to CLASWEAP.2DA */
  ~WIND_RIDER 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ /* this string is appened column-wise to WEAPPROF.2DA, starting with the third line*/
  ~WIND_RIDER                9       7       6       8       3       8~ /* this line is appened to ABCLASRQ.2DA */
  ~WIND_RIDER                0       0       0       0       0       0~ /* this line is appened to ABCLSMOD.2DA */
  ~WIND_RIDER                17      0       0       0       0       0~ /* this line is appened to ABDCDSRQ.2DA */
  ~WIND_RIDER                15      0       0       0       0       0~ /* this line is appened to ABDCSCRQ.2DA */
  ~WIND_RIDER                1       0       0       1       0       0       1       0       0~ /* this line is appened to ALIGNMNT.2DA */
  ~WIND_RIDER                0       0       0       0       0       0~ /* this line goes to DUALCLAS.2DA */
  ~Eldritch_Magic/2DA/EMCLABWI.2da~ /* this is the name of your abilities 2DA file, in the style of clabrn02.2da */
  ~K_F_H    K_F_D   K_F_G   K_F_E   K_F_HE   K_F_HL   K_F_HO~ /* These are the 2da files listed in KITTABLE.2DA that you want your kit to be a part of. List as many as you like. */
  ~0x00000001    2~ /* This is the "unusable" value you want for your kit and also the class value. These would normally appear at the end of KITLIST.2DA */
  ~Fi0~ /* This is the High Level Ability Abbreviation (see LUABBR.2DA) Normal values are Fi0, Pa0, etc. */
  ~CHAN09 * HELM07 BAG26 RING06 RING31 * BOOT01 AMUL20 BRAC10 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 HAMM07 SW1H27 STAF08~
  SAY ~windrider~
  SAY ~Windrider~
  SAY @14

COPY ~Eldritch_Magic/Spells/EMWIND1.spl~   ~override~
COPY ~Eldritch_Magic/Spells/EMWIND2.spl~   ~override~
 SAY 0x8  @296
 SAY 0x50 @297
COPY ~Eldritch_Magic/Creatures/EMWIND1.cre~   ~override~
COPY ~Eldritch_Magic/Creatures/EMWIND2.cre~   ~override~
COPY ~Eldritch_Magic/Creatures/EMWIND3.cre~   ~override~
COPY ~Eldritch_Magic/Creatures/EMWIND4.cre~   ~override~

LAF fl#add_kit_ee
   INT_VAR
     biography = ~-1~
     briefdesc = 102499 // Normal briefdesc for fighter/mages
     fallen = 0
     fallen_notice = ~-1~
   STR_VAR
     kit_name = WIND_RIDER
     clswpbon = ~1 0 2~
     numwslot = ~4~
     clascolr = ~30 91 93 23 93~ // Fighter colors
     clasiskl = ~0 0 0 0 0 0 0~
     clasthac = ~0~
     thiefscl = ~0 0 0 0 0 0 0 0~
     hpclass  = ~HPWAR~
     clsrcreq = ~0 1 0 0 0 0 0~

END

// Remove XP Cap
COPY  ~Eldritch_Magic/2DA/XPCAP.2DA~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTARE.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTBP.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/SODSTRTA.2DA~   ~override~

ACTION_CLEAR_ARRAY  cd_extend_tables
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN
  lvlmodwm => 0 // wild mage level modulation for wild surges
  monkfist => 0 // monk fist progression
  mxsplbrd => 0 // bard spell table
  mxspldd  => 0 // dragon disciple spell table
  mxspldru => 0 // druid spell table
  mxsplpal => 0 // paladin spell table
  mxsplprs => 0 // priest spell table
  mxsplran => 0 // ranger spell table
  mxsplsrc => 0 // sorcerer spell table
  mxsplwiz => 0 // mage spell table
  raisdead => 0 // raise dead temple prices
  splsrckn => 0 // sorcerer spell table
END

// extend hp tables for ee games
ACTION_IF FILE_EXISTS_IN_GAME hpclass.2da THEN BEGIN

  // add hp tables to list of tables to extend
  COPY_EXISTING ~hpclass.2da~ ~override~
    COUNT_2DA_ROWS ~2~ "rows"
    FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
      SET "exists" = 0
      READ_2DA_ENTRY "%index%" 1 2 "table"
      DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN "%table%" => 0 END
    END

END

// easy replacements for 2das with levels as rows
ACTION_PHP_EACH cd_extend_tables AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~^40\([ %TAB%].*\)~
          ~40\1
41\1
42\1
43\1
44\1
45\1
46\1
47\1
48\1
49\1
50\1~
      END
      UNLESS ~^50[ %TAB%]~
      BUT_ONLY_IF_IT_CHANGES
  END

END

// extend level-based abilities to 50; 2das with a zero column
ACTION_FOR_EACH file IN backstab crippstr layhands savemonk saveprs saverog savewar savewiz sneakatt thac0 xpbonus BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
       REPLACE_TEXTUALLY ~^\(.+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+\)\([ %TAB%]+[0-9]+\)~
        ~\1\2\2\2\2\2\2\2\2\2\2\2~
       REPLACE_TEXTUALLY ~\([ %TAB%]+\)40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40~
        ~\140\141\142\143\144\145\146\147\148\149\150~  
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY_IF_IT_CHANGES
      
  END

END

// extend level-based abilities to 50; wspatck
COPY_EXISTING ~wspatck.2da~ ~override~ // warrior bonus attacks for proficiencies and levels
  // everything else, extend from 41 to 50
  REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40~
    ~\1\240\241\242\243\244\245\246\247\248\249\250~
  REPLACE_TEXTUALLY ~^\([0-5]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+\)\([ %TAB%]+-?[0-9]+\)~
    ~\1\2\2\2\2\2\2\2\2\2\2\2~
  UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
  BUT_ONLY_IF_IT_CHANGES

ACTION_CLEAR_ARRAY  cd_extend_clabs
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN // start with class tables
  clabba01 => 0 // generic bard abilities
  clabdr01 => 0 // generic druid abilities
  clabfi01 => 0 // generic fighter abilities
  clabmo01 => 0 // generic monk abilities
  clabpa01 => 0 // generic paladin abilities
  clabpa05 => 0 // fallen paladin abilities
  clabpr01 => 0 // generic priest abilities
  clabrn01 => 0 // generic ranger abilities
  clabrn05 => 0 // fallen ranger abilities
  clabth01 => 0 // generic thief abilities
END

// add kit tables dynamically by reading kitlist
COPY_EXISTING ~kitlist.2da~ ~override~
  COUNT_2DA_ROWS ~9~ "rows"
  FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
    SET "exists" = 0
    READ_2DA_ENTRY "%index%" 5 9 "clab"
    DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN "%clab%" => 0 END
  END
  BUT_ONLY_IF_IT_CHANGES

// extend clab abilities to 50
ACTION_PHP_EACH cd_extend_clabs AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~[%WNL%%MNL%]+~ ~%LNL%~
        REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40[ %TAB%]*~
          ~\1\240\241\242\243\244\245\246\247\248\249\250~
        REPLACE_TEXTUALLY ~^\(ABILITY[0-9A-Z]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+\)\([ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%%LNL%]+\)[ %TAB%]*$~
          ~\1\2\2~
      END
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY

  END

END

// for EE
ACTION_FOR_EACH file IN startare startbp BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[0-9]+~ ~\1-1~
      BUT_ONLY

  END

END

 PRINT ~Thank you for installing: "Windrider Kit"~

// Adds custom items (BGEE)
/////////////////////////////////////////////////////////
BEGIN ~BGEE: Item Expansion [BETA]~ DESIGNATED 15
REQUIRE_PREDICATE GAME_IS ~bgee~ @25

COPY  ~Eldritch_Magic/Effects/emlaw.eff~   ~override~

COPY ~Eldritch_Magic/ITM/emsw1h05.itm~ ~override~ // Silver Long Sword +2
  SAY NAME1 ~~
  SAY NAME2 @102
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @103
  
COPY ~Eldritch_Magic/ITM/emsw1h06.itm~ ~override~ // Flaming Burst Long Sword +1
  SAY NAME1 ~~
  SAY NAME2 @104
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @105

COPY ~Eldritch_Magic/ITM/emsw1h07.itm~ ~override~ // Frost-Fire Long Sword +2
  SAY NAME1 ~~
  SAY NAME2 @106
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @107

COPY ~Eldritch_Magic/ITM/emsw1h10.itm~ ~override~ // Mithral Long Sword +3
  SAY NAME1 ~~
  SAY NAME2 @108
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @109
  
COPY ~Eldritch_Magic/ITM/emsw1h02.itm~ ~override~ // Adamantine Long Sword of Biting +1
  SAY NAME1 ~~
  SAY NAME2 @110
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @111
  
COPY ~Eldritch_Magic/ITM/emsw1h12.itm~ ~override~ // Vampiric Short Sword +1
  SAY NAME1 ~~
  SAY NAME2 @112
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @113
  
COPY ~Eldritch_Magic/ITM/emsw1h03.itm~ ~override~ // Masterwork Cold Iron Long Sword
  SAY NAME1 ~~
  SAY NAME2 @114
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @115

COPY ~Eldritch_Magic/ITM/emsw1h13.itm~ ~override~ // Elemental Long Sword +1
  SAY NAME1 ~~
  SAY NAME2 @116
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @117

COPY ~Eldritch_Magic/ITM/emsw1h09.itm~ ~override~ // Holy Avenger Long Sword +3
  SAY NAME1 ~~
  SAY NAME2 @118
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @119
  
COPY ~Eldritch_Magic/ITM/embhaal.itm~ ~override~ // Bhaal's Holy Symbol
  SAY NAME1 ~~
  SAY NAME2 @120
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @121
  
COPY ~Eldritch_Magic/ITM/emchanco.itm~ ~override~ // Elven Chain Mail of the Collector
  SAY NAME1 ~~
  SAY NAME2 @140
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @141

// BG2EE- Won't appear in BGEE
COPY  ~Eldritch_Magic/Spells/emcdchan.spl~   ~override~
      SAY 0xfe @219 //You feel a tug from the Pocket Plane as an artifact lost to time materializes among your possessions. Surely such a happening is linked to your powerful heritage.
COPY  ~Eldritch_Magic/Spells/emcdblsr.spl~   ~override~
      SAY 0x15e @213 //You have been acknowledged by the Bladesinger's Guild.
COPY  ~Eldritch_Magic/Spells/emcdsw1h.spl~   ~override~
      SAY 0xfe @214 //You are an exemplary Bladesinger and a hero among elves. The Gods themselves have taken notice of your righteous fury and now the Seldarine have blessed you with the tool to exact it. Be advised not to abuse a divine gift.
COPY  ~Eldritch_Magic/Effects/emundead.eff~   ~override~
COPY  ~Eldritch_Magic/Effects/emdemon.eff~   ~override~
COPY  ~Eldritch_Magic/Effects/emhugh1.eff~   ~override~
COPY  ~Eldritch_Magic/Effects/emhugh2.eff~   ~override~
COPY  ~Eldritch_Magic/Effects/emhugh3.eff~   ~override~
COPY  ~Eldritch_Magic/Effects/em2d6.eff~   ~override~
COPY  ~Eldritch_Magic/Spells/emsare1.spl~   ~override~
      SAY 0xce @94 //Blades
COPY  ~Eldritch_Magic/Spells/emsare2.spl~   ~override~
      SAY 0xce @95 //Spikes
COPY  ~Eldritch_Magic/Dialog/emsw1h01.dlg~   ~override~
      SAY 0x34  @200
      SAY 0x44  @201
      SAY 0x54  @202
      SAY 0x64  @204
      SAY 0x74  @206
      SAY 0x84  @208
      SAY 0x98  @198
      SAY 0xb8  @199
      SAY 0xd8  @203
      SAY 0xf8  @205
      SAY 0x118 @207

COPY_EXISTING ~lunumab.2da~ ~override~
  APPEND ITEMDIAL.2da ~EMSW1H01      5689   EMSW1H01~

COPY_EXISTING ~item_use.2da~ ~override~
  APPEND item_use.2da ~emplat01   SAREVOK    9382       2~
  APPEND item_use.2da ~emsw2h01   SAREVOK    9382       2~
  APPEND item_use.2da ~emsarev   SAREVOK    9382       2~

COPY ~Eldritch_Magic/ITM/emboot01.itm~ ~override~ // Elven Boots of Speed: The Paws of the Lythari
  SAY NAME1 @26
  SAY NAME2 @27
  SAY UNIDENTIFIED_DESC @28
  SAY DESC @29
  SAY 0x15e @96

COPY ~Eldritch_Magic/ITM/emchan01.itm~ ~override~ // Holy Elven Chain +6
  SAY NAME1 @30
  SAY NAME2 @31
  SAY UNIDENTIFIED_DESC @32
  SAY DESC @33
  SAY 0x3fe @96

COPY ~Eldritch_Magic/ITM/emclck01.itm~ ~override~ // Bladesinger's Shroud
  SAY NAME1 @34
  SAY NAME2 @35
  SAY UNIDENTIFIED_DESC @36
  SAY DESC @37
  SAY 0x2b6 @96

COPY ~Eldritch_Magic/ITM/emring01.itm~ ~override~ // Bladesinger's Signet
  SAY NAME1 @38
  SAY NAME2 @39
  SAY UNIDENTIFIED_DESC @40
  SAY DESC @41
  SAY 0x2de @96

COPY ~Eldritch_Magic/BAM/emsw1h01.bam~ ~override~
COPY ~Eldritch_Magic/ITM/emsw1h01.itm~ ~override~// Seldarine's Fury +6: Shame of the Gods
  SAY NAME1 @42
  SAY NAME2 @43
  SAY UNIDENTIFIED_DESC @44
  SAY DESC @45
  SAY 0x586 @96

COPY ~Eldritch_Magic/ITM/emsw1h11.itm~ ~override~ // Angharradh's Song
  SAY NAME1 ~~
  SAY NAME2 @47
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @49
  SAY 0x1f6 @96

COPY ~Eldritch_Magic/ITM/embelt25.itm~ ~override~ // Girdle of Titan Strength
  SAY NAME1 ~~
  SAY NAME2 @58
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @59

COPY ~Eldritch_Magic/ITM/emthay.itm~ ~override~ // Red Robe of Thay
  SAY NAME1 ~~
  SAY NAME2 @60
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @61
  SAY 0x36e @97

COPY ~Eldritch_Magic/ITM/emsw1h04.itm~ ~override~ // Blue Flame Taragarth +3
  SAY NAME1 ~~
  SAY NAME2 @62
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @63

COPY ~Eldritch_Magic/ITM/emdagg01.itm~ ~override~ // Netherese Spellblade
  SAY NAME1 ~~
  SAY NAME2 @64
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @65

COPY ~Eldritch_Magic/ITM/emsw1h08.itm~ ~override~ // Plasma Blade of Kossuth: Igneus Nova
  SAY NAME1 ~~
  SAY NAME2 @66
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @67

COPY ~Eldritch_Magic/BAM/phelm29.bmp~ ~override~
COPY ~Eldritch_Magic/ITM/empsion.itm~ ~override~ // Drow Psionicist's Cowl
  SAY NAME1 ~~
  SAY NAME2 @68
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @69

COPY ~Eldritch_Magic/ITM/emveye.itm~ ~override~ // Eye of Vecna
  SAY NAME1 ~~
  SAY NAME2 @70
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @71

COPY ~Eldritch_Magic/ITM/emvhand.itm~ ~override~ // Hand of Vecna
  SAY NAME1 ~~
  SAY NAME2 @72
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @73

// COPY ~Eldritch_Magic/ITM/emcesp01.itm~ ~override~ // Claw of Kazgaroth
//  SAY NAME1 ~~
//  SAY NAME2 @50
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @51

COPY ~Eldritch_Magic/ITM/emimoen.itm~ ~override~ // Imoen's Belt
  SAY NAME1 ~~
  SAY NAME2 @52
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @53
  SAY 0x2de @98

COPY ~Eldritch_Magic/ITM/emplat01.itm~ ~override~ // Sarevok's Bladed Armor +5
  SAY NAME1 ~~
  SAY NAME2 @54
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @55

COPY ~Eldritch_Magic/ITM/emsw2h01.itm~ ~override~ // Sword of Chaos +5
  SAY NAME1 ~~
  SAY NAME2 @56
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @57

COPY ~Eldritch_Magic/ITM/emsarev.itm~ ~override~ // Sword of Chaos +5 (Ascension)
  SAY NAME1 ~~
  SAY NAME2 @56
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @57

COPY ~Eldritch_Magic/ITM/BGEE/misc72.itm~ ~override~
  SAY 0x226 @224
COPY ~Eldritch_Magic/ITM/BGEE/misc73.itm~ ~override~
  SAY 0xae @224

COPY ~Eldritch_Magic/ITM/emheart.itm~ ~override~ // Black Heart of Kazgaroth
  SAY NAME1 ~~
  SAY NAME2 @220
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @221

COPY ~Eldritch_Magic/ITM/emhugh.itm~ ~override~ // Sword of Cymrych Hugh
  SAY NAME1 @42
  SAY NAME2 @255
  SAY UNIDENTIFIED_DESC @44
  SAY DESC @256
  SAY 0x19e @224
  SAY 0x1ce @224
  SAY 0x1fe @224

COPY ~Eldritch_Magic/ITM/emhide.itm~ ~override~ // Kazgaroth's Hide
  SAY NAME1 @225
  SAY NAME2 @222
  SAY UNIDENTIFIED_DESC @226
  SAY DESC @223
  SAY 0x22e @224
  
COPY ~Eldritch_Magic/ITM/EMAURIL.itm~ ~override~ // Breath of Auril +3
  SAY NAME1 ~~
  SAY NAME2 @257
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @258
COPY ~Eldritch_Magic/BAM/IAURIL.bam~ ~override~

COPY ~Eldritch_Magic/ITM/EMBBLA.itm~ ~override~ // Lore of the Bladesingers
  SAY NAME1 ~~
  SAY NAME2 @259
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @260
  
COPY ~Eldritch_Magic/ITM/EMBLOOD.itm~ ~override~ // Bathed-In-Blood +4
  SAY NAME1 ~~
  SAY NAME2 @261
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @262
COPY ~Eldritch_Magic/BAM/IBLOOD.bam~ ~override~

COPY ~Eldritch_Magic/ITM/EMCLOASC.itm~ ~override~ // Cloak of Scintillating Colors
  SAY NAME1 ~~
  SAY NAME2 @263
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @264
COPY ~Eldritch_Magic/BAM/ICLOAKSC.bam~ ~override~

COPY ~Eldritch_Magic/ITM/EMELFCHA.itm~ ~override~ // Elven Chain Mail of the Hand +3
  SAY NAME1 ~~
  SAY NAME2 @265
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @266
COPY ~Eldritch_Magic/BAM/IELFCHAN.bam~ ~override~
COPY ~Eldritch_Magic/BAM/GCHAN12.bam~ ~override~

COPY ~Eldritch_Magic/ITM/EMGLORY.itm~ ~override~ // The Glory of Suffering +6
  SAY NAME1 ~~
  SAY NAME2 @267
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @268
COPY ~Eldritch_Magic/BAM/IGLORY.bam~ ~override~

COPY ~Eldritch_Magic/ITM/EMJHOSWD.itm~ ~override~ // Singing Blade of Aihonen +5
  SAY NAME1 ~~
  SAY NAME2 @269
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @270
COPY ~Eldritch_Magic/BAM/IJHOSWD3.bam~ ~override~

COPY ~Eldritch_Magic/ITM/EMZZ36DG.itm~ ~override~ // Dead God's Dreaming +4, +6 vs. good
  SAY NAME1 ~~
  SAY NAME2 @271
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @272
COPY ~Eldritch_Magic/BAM/IZZ36DGD.bam~ ~override~
COPY ~Eldritch_Magic/Effects/ZZ36DGDH.eff~ ~override~
COPY ~Eldritch_Magic/Effects/ZZ36DGDD.eff~ ~override~
COPY ~Eldritch_Magic/Spells/EM428.spl~ ~override~
  SAY 0x8 @273
  SAY 0x50 @274
  SAY 0x18e @277
COPY ~Eldritch_Magic/Spells/EM714.spl~ ~override~
  SAY 0x8 @275
  SAY 0x50 @276
  SAY 0x21e @278
COPY ~Eldritch_Magic/BAM/conjuh.bam~ ~override~
COPY ~Eldritch_Magic/BAM/enchah.bam~ ~override~
COPY ~Eldritch_Magic/VVC/conjuh.vvc~ ~override~
COPY ~Eldritch_Magic/VVC/enchah.vvc~ ~override~
COPY ~Eldritch_Magic/BAM/EM428B.bam~ ~override~
COPY ~Eldritch_Magic/BAM/EM428C.bam~ ~override~
COPY ~Eldritch_Magic/BAM/EM714B.bam~ ~override~
COPY ~Eldritch_Magic/BAM/EM714C.bam~ ~override~

// Taerom Fuiruim (Thunderhammer Smithy - Beregost)
COPY_EXISTING ~TAERUM.sto~ ~override~
 ADD_STORE_ITEM ~emsw1h06~ AFTER ~sw1h05~ #0 #0 #0 ~IDENTIFIED~ #1 // Flaming Burst Long Sword +1

// Sorcerous Sundries (Baldur's Gate)
COPY_EXISTING ~STO0703.sto~ ~override~
 ADD_STORE_ITEM ~emsw1h07~ AFTER ~sw1h05~ #0 #0 #0 ~IDENTIFIED~ #1 // Frost-Fire Long Sword +2
 ADD_STORE_ITEM ~emsw1h02~ AFTER ~emsw1h07~ #0 #0 #0 ~IDENTIFIED~ #1 // Adamantite Long Sword of Biting +1
 ADD_STORE_ITEM ~CLCK15~ AFTER ~emsw1h02~ #0 #0 #0 ~IDENTIFIED~ #1 // Robe of the Good Archmagi
 ADD_STORE_ITEM ~CLCK16~ AFTER ~CLCK15~ #0 #0 #0 ~IDENTIFIED~ #1 // Robe of the Neutral Archmagi

// The Friendly Arm Inn
COPY_EXISTING ~FRIEND.sto~ ~override~
 ADD_STORE_ITEM ~embhaal~ AFTER ~shld06~ #1 #0 #0 ~IDENTIFIED~ #1 // Bhaal's Holy Symbol

// The High Hedge
COPY_EXISTING ~HIGHHEDG.sto~ ~override~
 ADD_STORE_ITEM ~emsw1h05~ AFTER ~CLCK16~ #0 #0 #0 ~IDENTIFIED~ #1 // Silver Long Sword +2

// Ulgoth's Beard Store and Inn
COPY_EXISTING ~ULGOTH.sto~ ~override~
 ADD_STORE_ITEM ~emsw1h10~ AFTER ~staf08~ #0 #0 #0 ~IDENTIFIED~ #1 // Mithral Long Sword +3
 
// Nashkel Store
COPY_EXISTING ~STO4803.sto~ ~override~
 ADD_STORE_ITEM ~emsw1h03~ AFTER ~sw1h04~ #0 #0 #0 ~IDENTIFIED~ #1 // Masterwork Cold Iron Long Sword

// Black Lily
COPY_EXISTING ~STOBLACK.sto~ ~override~
 ADD_STORE_ITEM ~emsw1h12~ AFTER ~sw1h07~ #0 #0 #0 ~IDENTIFIED~ #1 // Vampiric Short Sword +1


// Archmage spells: "mainly for... experiments." - Irenicus
///////////////////////////////////////////////////////////

// Fireball-Lightning Bolt
COPY ~Eldritch_Magic/Spells/EMIMPFB.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMIMPLB.spl~ ~override~
COPY ~Eldritch_Magic/ITM/EMFBLB.itm~ ~override~
  SAY NAME1 @1001
  SAY NAME2 @1001
  SAY UNIDENTIFIED_DESC @1002
  SAY DESC @1002
COPY ~Eldritch_Magic/Spells/EMFBLB.spl~ ~override~
  SAY NAME1 @1001
  SAY NAME2 @1001
  SAY UNIDENTIFIED_DESC @1002
  SAY DESC @1002

// Wand of Fire and Lightning
COPY ~Eldritch_Magic/ITM/EMWAND05.itm~ ~override~
  SAY NAME1 @5000
  SAY NAME2 @5001
  SAY UNIDENTIFIED_DESC @5002
  SAY DESC @5003

// Improved Magic Missile
COPY ~Eldritch_Magic/Spells/EMMM0.spl~ ~override~
COPY ~Eldritch_Magic/ITM/EMIMPMM.itm~ ~override~
  SAY NAME1 @1003
  SAY NAME2 @1003
  SAY UNIDENTIFIED_DESC @1004
  SAY DESC @1004
COPY ~Eldritch_Magic/Spells/EMIMPMM.spl~ ~override~
  SAY NAME1 @1003
  SAY NAME2 @1003
  SAY UNIDENTIFIED_DESC @1004
  SAY DESC @1004

// Shadovar Wraithform
COPY ~Eldritch_Magic/ITM/EMWRAITH.itm~ ~override~
COPY ~Eldritch_Magic/ITM/EMIMPWF.itm~ ~override~
  SAY NAME1 @1005
  SAY NAME2 @1005
  SAY UNIDENTIFIED_DESC @1006
  SAY DESC @1006
COPY ~Eldritch_Magic/Spells/EMIMPWF.spl~ ~override~
  SAY NAME1 @1005
  SAY NAME2 @1005
  SAY UNIDENTIFIED_DESC @1006
  SAY DESC @1006

// Greater Animate Dead
COPY ~Eldritch_Magic/Creatures/EMSKELWA.cre~ ~override~
COPY ~Eldritch_Magic/Creatures/EMSKELWB.cre~ ~override~
COPY ~Eldritch_Magic/Creatures/EMSKELWC.cre~ ~override~
COPY ~Eldritch_Magic/Creatures/EMSKELWD.cre~ ~override~
COPY ~Eldritch_Magic/Effects/SPANDL19.eff~ ~override~
COPY ~Eldritch_Magic/Effects/SPANDL23.eff~ ~override~
COPY ~Eldritch_Magic/Effects/SPANDL27.eff~ ~override~
COPY ~Eldritch_Magic/Effects/SPANDL31.eff~ ~override~
COPY ~Eldritch_Magic/ITM/EMSKELWB.itm~ ~override~
COPY ~Eldritch_Magic/ITM/EMSKELWC.itm~ ~override~
COPY ~Eldritch_Magic/ITM/EMSKELWD.itm~ ~override~
COPY ~Eldritch_Magic/ITM/EMIMPAD.itm~ ~override~
  SAY NAME1 @1007
  SAY NAME2 @1007
  SAY UNIDENTIFIED_DESC @1008
  SAY DESC @1008
COPY ~Eldritch_Magic/Spells/EMIMPAD.spl~ ~override~
  SAY NAME1 @1007
  SAY NAME2 @1007
  SAY UNIDENTIFIED_DESC @1008
  SAY DESC @1008

// Shapeshift: Lycanthrope
COPY ~Eldritch_Magic/Spells/EMWW.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMGWW.spl~ ~override~
COPY ~Eldritch_Magic/ITM/EMSSWW.itm~ ~override~
  SAY NAME1 @1009
  SAY NAME2 @1009
  SAY UNIDENTIFIED_DESC @1010
  SAY DESC @1010
COPY ~Eldritch_Magic/Spells/EMSSWW.spl~ ~override~
  SAY NAME1 @1009
  SAY NAME2 @1009
  SAY UNIDENTIFIED_DESC @1010
  SAY DESC @1010
  
// Shapeshift: Demon Lord
COPY ~Eldritch_Magic/Spells/EMDL.spl~ ~override~
COPY ~Eldritch_Magic/Creatures/EMTANAR.cre~ ~override~
COPY ~Eldritch_Magic/ITM/EMTANAR.itm~ ~override~
COPY ~Eldritch_Magic/Spells/EMSSDL.spl~ ~override~
  SAY NAME1 @1011
  SAY NAME2 @1011
  SAY UNIDENTIFIED_DESC @1012
  SAY DESC @1012

// Call Lightning-Flame Strike
COPY ~Eldritch_Magic/Spells/EMIMPCL.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMIMPFS.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMCLFS.spl~ ~override~
  SAY NAME1 @1013
  SAY NAME2 @1013
  SAY UNIDENTIFIED_DESC @1014
  SAY DESC @1014

// Contingency I
COPY ~Eldritch_Magic/Spells/EMARMOR.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMPROEVI.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMPROPET.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMCONT1.spl~ ~override~
  SAY NAME1 @1015
  SAY NAME2 @1015
  SAY UNIDENTIFIED_DESC @1016
  SAY DESC @1016
  
// Contingency II
COPY ~Eldritch_Magic/Spells/EMIMPVOC.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMIMPBLU.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMIMPRF.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMCONT2.spl~ ~override~
  SAY NAME1 @1017
  SAY NAME2 @1017
  SAY UNIDENTIFIED_DESC @1018
  SAY DESC @1018
  
// Contingency III
COPY ~Eldritch_Magic/Spells/EMIMPStS.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMIMPSB.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMIMPSR.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMCONT3.spl~ ~override~
  SAY NAME1 @1019
  SAY NAME2 @1019
  SAY UNIDENTIFIED_DESC @1020
  SAY DESC @1020
  
// Improved Chromatic Orb
COPY ~Eldritch_Magic/Spells/EMIMPCO.spl~ ~override~
  SAY NAME1 @1021
  SAY NAME2 @1021
  SAY UNIDENTIFIED_DESC @1022
  SAY DESC @1022

// Unweave Magic
COPY ~Eldritch_Magic/Spells/EMIMPPS.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMIMPKW.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMIMPSS.spl~ ~override~
  SAY NAME1 @1023
  SAY NAME2 @1023
  SAY UNIDENTIFIED_DESC @1024
  SAY DESC @1024
  
// Call Upon Abyss: Baphomet
COPY ~Eldritch_Magic/Spells/EMIMPSC.spl~ ~override~
  SAY NAME1 @1025
  SAY NAME2 @1025
  SAY UNIDENTIFIED_DESC @1026
  SAY DESC @1026

 PRINT ~He who fights with monsters should look to it that he himself does not become a monster . . . when you gaze long into the abyss the abyss also gazes into you
- Friedrich Nietzsche~

// Adds HLAs (BGEE)
/////////////////////////////////////////////////////////
BEGIN ~BGEE: High Level Abilities [BETA]~ DESIGNATED 16
REQUIRE_PREDICATE GAME_IS ~bgee~ @25

// Remove XP Cap
COPY  ~Eldritch_Magic/2DA/XPCAP.2DA~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTARE.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/STARTBP.2DA.~   ~override~
COPY  ~Eldritch_Magic/2DA/SODSTRTA.2DA~   ~override~

ACTION_CLEAR_ARRAY  cd_extend_tables
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN
  lvlmodwm => 0 // wild mage level modulation for wild surges
  monkfist => 0 // monk fist progression
  mxsplbrd => 0 // bard spell table
  mxspldd  => 0 // dragon disciple spell table
  mxspldru => 0 // druid spell table
  mxsplpal => 0 // paladin spell table
  mxsplprs => 0 // priest spell table
  mxsplran => 0 // ranger spell table
  mxsplsrc => 0 // sorcerer spell table
  mxsplwiz => 0 // mage spell table
  raisdead => 0 // raise dead temple prices
  splsrckn => 0 // sorcerer spell table
END

// extend hp tables for ee games
ACTION_IF FILE_EXISTS_IN_GAME hpclass.2da THEN BEGIN

  // add hp tables to list of tables to extend
  COPY_EXISTING ~hpclass.2da~ ~override~
    COUNT_2DA_ROWS ~2~ "rows"
    FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
      SET "exists" = 0
      READ_2DA_ENTRY "%index%" 1 2 "table"
      DEFINE_ASSOCIATIVE_ARRAY cd_extend_tables BEGIN "%table%" => 0 END
    END

END

// easy replacements for 2das with levels as rows
ACTION_PHP_EACH cd_extend_tables AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~^40\([ %TAB%].*\)~
          ~40\1
41\1
42\1
43\1
44\1
45\1
46\1
47\1
48\1
49\1
50\1~
      END
      UNLESS ~^50[ %TAB%]~
      BUT_ONLY_IF_IT_CHANGES
  END

END

// extend level-based abilities to 50; 2das with a zero column
ACTION_FOR_EACH file IN backstab crippstr layhands savemonk saveprs saverog savewar savewiz sneakatt thac0 xpbonus BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
       REPLACE_TEXTUALLY ~^\(.+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+[ %TAB%]+[0-9]+\)\([ %TAB%]+[0-9]+\)~
        ~\1\2\2\2\2\2\2\2\2\2\2\2~
       REPLACE_TEXTUALLY ~\([ %TAB%]+\)40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40[ %TAB%]+40~
        ~\140\141\142\143\144\145\146\147\148\149\150~  
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY_IF_IT_CHANGES
      
  END

END

// extend level-based abilities to 50; wspatck
COPY_EXISTING ~wspatck.2da~ ~override~ // warrior bonus attacks for proficiencies and levels
  // everything else, extend from 41 to 50
  REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40~
    ~\1\240\241\242\243\244\245\246\247\248\249\250~
  REPLACE_TEXTUALLY ~^\([0-5]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+[ %TAB%]+-?[0-9]+\)\([ %TAB%]+-?[0-9]+\)~
    ~\1\2\2\2\2\2\2\2\2\2\2\2~
  UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
  BUT_ONLY_IF_IT_CHANGES

ACTION_CLEAR_ARRAY  cd_extend_clabs
ACTION_DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN // start with class tables
  clabba01 => 0 // generic bard abilities
  clabdr01 => 0 // generic druid abilities
  clabfi01 => 0 // generic fighter abilities
  clabmo01 => 0 // generic monk abilities
  clabpa01 => 0 // generic paladin abilities
  clabpa05 => 0 // fallen paladin abilities
  clabpr01 => 0 // generic priest abilities
  clabrn01 => 0 // generic ranger abilities
  clabrn05 => 0 // fallen ranger abilities
  clabth01 => 0 // generic thief abilities
END

// add kit tables dynamically by reading kitlist
COPY_EXISTING ~kitlist.2da~ ~override~
  COUNT_2DA_ROWS ~9~ "rows"
  FOR ( index = 1 ; index < rows ; index = index + 1 ) BEGIN
    SET "exists" = 0
    READ_2DA_ENTRY "%index%" 5 9 "clab"
    DEFINE_ASSOCIATIVE_ARRAY cd_extend_clabs BEGIN "%clab%" => 0 END
  END
  BUT_ONLY_IF_IT_CHANGES

// extend clab abilities to 50
ACTION_PHP_EACH cd_extend_clabs AS file => foo BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      PATCH_IF (SOURCE_SIZE > 0) BEGIN
        REPLACE_TEXTUALLY ~[%WNL%%MNL%]+~ ~%LNL%~
        REPLACE_TEXTUALLY ~\(1[ %TAB%]+2[ %TAB%]+3[ %TAB%]+4[ %TAB%]+5[ %TAB%]+6[ %TAB%]+7[ %TAB%]+8[ %TAB%]+9[ %TAB%]+10[ %TAB%]+11[ %TAB%]+12[ %TAB%]+13[ %TAB%]+14[ %TAB%]+15[ %TAB%]+16[ %TAB%]+17[ %TAB%]+18[ %TAB%]+19[ %TAB%]+20[ %TAB%]+21[ %TAB%]+22[ %TAB%]+23[ %TAB%]+24[ %TAB%]+25[ %TAB%]+26[ %TAB%]+27[ %TAB%]+28[ %TAB%]+29[ %TAB%]+30[ %TAB%]+31[ %TAB%]+32[ %TAB%]+33[ %TAB%]+34[ %TAB%]+35[ %TAB%]+36[ %TAB%]+37[ %TAB%]+38[ %TAB%]+39\)\([ %TAB%]+\)40[ %TAB%]*~
          ~\1\240\241\242\243\244\245\246\247\248\249\250~
        REPLACE_TEXTUALLY ~^\(ABILITY[0-9A-Z]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+\)\([ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%]+[ %TAB%]+[^ %TAB%%LNL%]+\)[ %TAB%]*$~
          ~\1\2\2~
      END
      UNLESS ~41[ %TAB%]+42[ %TAB%]+43[ %TAB%]+44[ %TAB%]+45[ %TAB%]+46[ %TAB%]+47[ %TAB%]+48[ %TAB%]+49[ %TAB%]+50~
      BUT_ONLY

  END

END

// for EE
ACTION_FOR_EACH file IN startare startbp BEGIN

  ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ THEN BEGIN

    COPY_EXISTING ~%file%.2da~ ~override~
      REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[0-9]+~ ~\1-1~
      BUT_ONLY

  END

END

// Bard HLAs
COPY ~Eldritch_Magic/2DA/BG2EE/LUBA0.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUBA1.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUBA2.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUBA3.2DA~ ~override~

COPY ~Eldritch_Magic/Spells/BG2EE/SPCL910.spl~ ~override~ // Set Spike Trap
  SAY 0x8  @1043
  SAY 0x50 @1044
COPY ~Eldritch_Magic/Spells/BG2EE/SPCL911.spl~ ~override~ // Set Exploding Trap
  SAY 0x8  @1045
  SAY 0x50 @1046
COPY ~Eldritch_Magic/Spells/BG2EE/SPCL912.spl~ ~override~ // Set Time Trap
  SAY 0x8  @1047
  SAY 0x50 @1048
COPY ~Eldritch_Magic/Spells/BG2EE/SPCL913.spl~ ~override~ // Evasion
  SAY 0x8  @1049
  SAY 0x50 @1050
COPY ~Eldritch_Magic/Spells/BG2EE/SPCL914.spl~ ~override~ // Greater Evasion
  SAY 0x8  @1051
  SAY 0x50 @1052
COPY ~Eldritch_Magic/Spells/BG2EE/SPCL915.spl~ ~override~ // Use Any Item
  SAY 0x8  @1053
  SAY 0x50 @1054
COPY ~Eldritch_Magic/Spells/BG2EE/SPCL916.spl~ ~override~ // Assassination
  SAY 0x8  @1055
  SAY 0x50 @1056
COPY ~Eldritch_Magic/Spells/BG2EE/SPCL917.spl~ ~override~ // Avoid Death
  SAY 0x8  @1057
  SAY 0x50 @1058
COPY ~Eldritch_Magic/Spells/BG2EE/SPCL918.spl~ ~override~ // Alchemy
  SAY 0x8  @1059
  SAY 0x50 @1060
COPY ~Eldritch_Magic/Spells/BG2EE/SPCL919.spl~ ~override~ // Scribe Scrolls
  SAY 0x8  @1061
  SAY 0x50 @1062
COPY ~Eldritch_Magic/Spells/BG2EE/SPCL920.spl~ ~override~ // Enhanced Bard Song
  SAY 0x8  @1063
  SAY 0x50 @1064
COPY ~Eldritch_Magic/Spells/BG2EE/SPCL921.spl~ ~override~ // Magic Flute
  SAY 0x8  @1065
  SAY 0x50 @1066

// Barbarian HLAs
COPY ~Eldritch_Magic/2DA/BG2EE/LUBB0.2DA~ ~override~

COPY ~Eldritch_Magic/Spells/BG2EE/SPCL900.spl~ ~override~ // Whirlwind Attack
  SAY 0x8  @1067
  SAY 0x50 @1068
COPY ~Eldritch_Magic/Spells/BG2EE/SPCL901.spl~ ~override~ // Greater Whirlwind Attack
  SAY 0x8  @1069
  SAY 0x50 @1070
COPY ~Eldritch_Magic/Spells/BG2EE/SPCL902.spl~ ~override~ // Deathblow
  SAY 0x8  @1071
  SAY 0x50 @1072
COPY ~Eldritch_Magic/Spells/BG2EE/SPCL903.spl~ ~override~ // Greater Deathblow
  SAY 0x8  @1073
  SAY 0x50 @1074
COPY ~Eldritch_Magic/Spells/BG2EE/SPCL904.spl~ ~override~ // Resist Magic
  SAY 0x8  @1075
  SAY 0x50 @1076
COPY ~Eldritch_Magic/Spells/BG2EE/SPCL905.spl~ ~override~ // Critical Strike
  SAY 0x8  @1077
  SAY 0x50 @1078
COPY ~Eldritch_Magic/Spells/BG2EE/SPCL906.spl~ ~override~ // Power Attack
  SAY 0x8  @1079
  SAY 0x50 @1080
COPY ~Eldritch_Magic/Spells/BG2EE/SPCL907.spl~ ~override~ // Hardiness
  SAY 0x8  @1081
  SAY 0x50 @1082
COPY ~Eldritch_Magic/Spells/BG2EE/SPCL908.spl~ ~override~ // War Cry
  SAY 0x8  @1083
  SAY 0x50 @1084
COPY ~Eldritch_Magic/Spells/BG2EE/SPCL909.spl~ ~override~ // Smite
  SAY 0x8  @1085
  SAY 0x50 @1086

// Grizzly Bear HLAs (just in case)
COPY ~Eldritch_Magic/2DA/BG2EE/LUBEA.2DA~ ~override~

COPY ~Eldritch_Magic/Spells/BG2EE/SPCL922.spl~ ~override~ // Tracking
  SAY 0x8  @1087
  SAY 0x50 @1088

// Cleric HLAs
COPY ~Eldritch_Magic/2DA/BG2EE/LUCL0.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUCL1.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUCL2.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUCL3.2DA~ ~override~

COPY ~Eldritch_Magic/Spells/BG2EE/SPPR721.spl~ ~override~ // Energy Blades
  SAY 0x8  @1089
  SAY 0x50 @1090
COPY ~Eldritch_Magic/Spells/BG2EE/SPPR722.spl~ ~override~ // Storm of Vengeance
  SAY 0x8  @1091
  SAY 0x50 @1092
COPY ~Eldritch_Magic/Spells/BG2EE/SPPR723.spl~ ~override~ // Elemental Summoning
  SAY 0x8  @1093
  SAY 0x50 @1094
COPY ~Eldritch_Magic/Spells/BG2EE/SPPR724.spl~ ~override~ // Greater Elemental Summoning
  SAY 0x8  @1095
  SAY 0x50 @1096
COPY ~Eldritch_Magic/Spells/BG2EE/SPPR725.spl~ ~override~ // Globe of Blades
  SAY 0x8  @1097
  SAY 0x50 @1098
COPY ~Eldritch_Magic/Spells/BG2EE/SPPR726.spl~ ~override~ // Summon Deva
  SAY 0x8  @1099
  SAY 0x50 @1100
COPY ~Eldritch_Magic/Spells/BG2EE/SPPR727.spl~ ~override~ // Summon Fallen Deva
  SAY 0x8  @1101
  SAY 0x50 @1102
COPY ~Eldritch_Magic/Spells/BG2EE/SPPR728.spl~ ~override~ // Implosion
  SAY 0x8  @1103
  SAY 0x50 @1104
COPY ~Eldritch_Magic/Spells/BG2EE/SPPR729.spl~ ~override~ // Mass Raise Dead
  SAY 0x8  @1105
  SAY 0x50 @1106
COPY ~Eldritch_Magic/Spells/BG2EE/SPPR730.spl~ ~override~ // Aura of Flaming Death
  SAY 0x8  @1107
  SAY 0x50 @1108
  
// Cleric/Mage HLAs
COPY ~Eldritch_Magic/2DA/BG2EE/LUCM0.2DA~ ~override~

// Cleric/Ranger HLAs
COPY ~Eldritch_Magic/2DA/BG2EE/LUCR0.2DA~ ~override~

// Cleric/Thief HLAs
COPY ~Eldritch_Magic/2DA/BG2EE/LUCT0.2DA~ ~override~

// Druid HLAs
COPY ~Eldritch_Magic/2DA/BG2EE/LUDR0.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUDR1.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUDR2.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUDR3.2DA~ ~override~

COPY ~Eldritch_Magic/Spells/BG2EE/SPPR731.spl~ ~override~ // Fire Elemental Transformation
  SAY 0x8  @1109
  SAY 0x50 @1110
COPY ~Eldritch_Magic/Spells/BG2EE/SPPR732.spl~ ~override~ // Earth Elemental Transformation
  SAY 0x8  @1111
  SAY 0x50 @1112

// Fighter/Cleric HLAs
COPY ~Eldritch_Magic/2DA/BG2EE/LUFC0.2DA~ ~override~

// Fighter/Druid HLAs
COPY ~Eldritch_Magic/2DA/BG2EE/LUFD0.2DA~ ~override~

// Fighter HLAs
COPY ~Eldritch_Magic/2DA/BG2EE/LUFI0.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUFI1.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUFI2.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUFI3.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUFI4.2DA~ ~override~

// Fighter/Mage HLAs
COPY ~Eldritch_Magic/2DA/BG2EE/LUFM0.2DA~ ~override~

// Fighter/Mage/Cleric HLAs
COPY ~Eldritch_Magic/2DA/BG2EE/LUFMC.2DA~ ~override~

// Fighter/Mage/Thief HLAs
COPY ~Eldritch_Magic/2DA/BG2EE/LUFMT.2DA~ ~override~

// Fighter/Thief HLAs
COPY ~Eldritch_Magic/2DA/BG2EE/LUFT0.2DA~ ~override~

// Mage HLAs
ACTION_IF (FILE_EXISTS_IN_GAME ~EMIMPFB.spl~) BEGIN
  COPY ~Eldritch_Magic/2DA/BG2EE/LUMA0.2da~ ~override~        // Includes level 10 Archmage spells added in BGEE: Item Expansion
END
ACTION_IF (NOT FILE_EXISTS_IN_GAME ~EMIMPFB.spl~) BEGIN
  COPY ~Eldritch_Magic/2DA/BG2EE/HLAs/LUMA0.2da~ ~override~   // Does not include level 10 Archmage spells added in BGEE: Item Expansion
END
COPY ~Eldritch_Magic/2DA/BG2EE/LUMA1.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUMA2.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUMA3.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUMA4.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUMA5.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUMA6.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUMA7.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUMA8.2DA~ ~override~

COPY ~Eldritch_Magic/Spells/BG2EE/SPCL928.spl~ ~override~ // Extra Level 6 Spell
  SAY 0x8  @1027
  SAY 0x50 @1028
COPY ~Eldritch_Magic/Spells/BG2EE/SPCL929.spl~ ~override~ // Extra Level 7 Spell
  SAY 0x8  @1029
  SAY 0x50 @1030
COPY ~Eldritch_Magic/Spells/BG2EE/SPCL930.spl~ ~override~ // Extra Level 8 Spell
  SAY 0x8  @1031
  SAY 0x50 @1032
COPY ~Eldritch_Magic/Spells/BG2EE/SPWI921.spl~ ~override~ // Improved Alacrity
  SAY 0x8  @1033
  SAY 0x50 @1034
COPY ~Eldritch_Magic/Spells/BG2EE/SPWI922.spl~ ~override~ // Dragon's Breath
  SAY 0x8  @1035
  SAY 0x50 @1036
COPY ~Eldritch_Magic/Spells/BG2EE/SPWI923.spl~ ~override~ // Summon Planetar
  SAY 0x8  @1037
  SAY 0x50 @1038
COPY ~Eldritch_Magic/Spells/BG2EE/SPWI924.spl~ ~override~ // Summon Dark Planetar
  SAY 0x8  @1039
  SAY 0x50 @1040
COPY ~Eldritch_Magic/Spells/BG2EE/SPWI925.spl~ ~override~ // Comet
  SAY 0x8  @1041
  SAY 0x50 @1042

// Monk HLAs
COPY ~Eldritch_Magic/2DA/BG2EE/LUMO0.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUMO1.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUMO2.2DA~ ~override~

// Mage/Thief HLAs
COPY ~Eldritch_Magic/2DA/BG2EE/LUMT0.2DA~ ~override~

// Paladin HLAs
COPY ~Eldritch_Magic/2DA/BG2EE/LUPA0.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUPA1.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUPA2.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUPA3.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUPA4.2DA~ ~override~

// Priest HLAs
COPY ~Eldritch_Magic/2DA/BG2EE/LUPR0.2DA~ ~override~

// Ranger HLAs
COPY ~Eldritch_Magic/2DA/BG2EE/LUSO0.2DA~ ~override~

// Sorcerer HLAs
COPY ~Eldritch_Magic/2DA/BG2EE/LURA0.2DA~ ~override~

// Thief HLAs
COPY ~Eldritch_Magic/2DA/BG2EE/LUTH0.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUTH1.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUTH2.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUTH3.2DA~ ~override~
COPY ~Eldritch_Magic/2DA/BG2EE/LUTH4.2DA~ ~override~

COPY ~Eldritch_Magic/BAM/BG2EE/SPCL900B.bam~ ~override~
// Many more BAMs to add
//
//
//
//
//
//
//

COPY ~Eldritch_Magic/Effects/BG2EE/SPCL902.eff~ ~override~
COPY ~Eldritch_Magic/Effects/BG2EE/SPCL902A.eff~ ~override~
COPY ~Eldritch_Magic/Effects/BG2EE/SPCL903.eff~ ~override~
COPY ~Eldritch_Magic/Effects/BG2EE/SPCL903A.eff~ ~override~
COPY ~Eldritch_Magic/Effects/BG2EE/SPCL906.eff~ ~override~
COPY ~Eldritch_Magic/Effects/BG2EE/SPCL906A.eff~ ~override~
COPY ~Eldritch_Magic/Effects/BG2EE/SPCL906B.eff~ ~override~
COPY ~Eldritch_Magic/Effects/BG2EE/SPCL909A.eff~ ~override~
COPY ~Eldritch_Magic/Effects/BG2EE/SPCL909B.eff~ ~override~
COPY ~Eldritch_Magic/Effects/BG2EE/SPCL909C.eff~ ~override~
COPY ~Eldritch_Magic/Effects/BG2EE/SPCL934E.eff~ ~override~
COPY ~Eldritch_Magic/Effects/BG2EE/SPCL934G.eff~ ~override~
COPY ~Eldritch_Magic/Effects/BG2EE/SPCL934N.eff~ ~override~
COPY ~Eldritch_Magic/Effects/BG2EE/SPPR707.eff~ ~override~

 PRINT ~Fate leads him who follows it, and drags him who resist.
- Plutarch~

// Adds Bladesinger's and other items (BG2EE)
/////////////////////////////////////////////////////////
BEGIN ~Bladesinger's Artifacts~ DESIGNATED 17
SUBCOMPONENT ~BG2EE: Item Expansion [BETA]~
REQUIRE_PREDICATE GAME_IS ~bg2ee~ @25

COPY ~Eldritch_Magic/Creatures/hlrevan.cre~ ~override~

COPY  ~Eldritch_Magic/Spells/emcdchan.spl~   ~override~
      SAY 0xfe @219
COPY  ~Eldritch_Magic/Spells/emcdblsr.spl~   ~override~
      SAY 0x15e @213
COPY  ~Eldritch_Magic/Spells/emcdsw1h.spl~   ~override~
      SAY 0xfe @214
COPY  ~Eldritch_Magic/Effects/emundead.eff~   ~override~
COPY  ~Eldritch_Magic/Effects/emdemon.eff~   ~override~
COPY  ~Eldritch_Magic/Dialog/emsw1h01.dlg~   ~override~
      SAY 0x34  @200
      SAY 0x44  @201
      SAY 0x54  @202
      SAY 0x64  @204
      SAY 0x74  @206
      SAY 0x84  @208
      SAY 0x98  @198
      SAY 0xb8  @199
      SAY 0xd8  @203
      SAY 0xf8  @205
      SAY 0x118 @207

COPY_EXISTING ~lunumab.2da~ ~override~
  APPEND ITEMDIAL.2da ~EMSW1H01      5689   EMSW1H01~

COPY ~Eldritch_Magic/ITM/emboot01.itm~ ~override~
  SAY NAME1 @26
  SAY NAME2 @27
  SAY UNIDENTIFIED_DESC @28
  SAY DESC @29
  SAY 0x15e @96

COPY ~Eldritch_Magic/ITM/emchan01.itm~ ~override~
  SAY NAME1 @30
  SAY NAME2 @31
  SAY UNIDENTIFIED_DESC @32
  SAY DESC @33
  SAY 0x3fe @96

COPY ~Eldritch_Magic/ITM/emclck01.itm~ ~override~
  SAY NAME1 @34
  SAY NAME2 @35
  SAY UNIDENTIFIED_DESC @36
  SAY DESC @37
  SAY 0x2b6 @96

COPY ~Eldritch_Magic/ITM/emring01.itm~ ~override~
  SAY NAME1 @38
  SAY NAME2 @39
  SAY UNIDENTIFIED_DESC @40
  SAY DESC @41
  SAY 0x2de @96

COPY ~Eldritch_Magic/BAM/emsw1h01.bam~ ~override~
COPY ~Eldritch_Magic/ITM/emsw1h01.itm~ ~override~
  SAY NAME1 @42
  SAY NAME2 @43
  SAY UNIDENTIFIED_DESC @44
  SAY DESC @45
  SAY 0x586 @96

COPY ~Eldritch_Magic/ITM/emsw1h11.itm~ ~override~
  SAY NAME1 @46
  SAY NAME2 @47
  SAY UNIDENTIFIED_DESC @48
  SAY DESC @49
  SAY 0x1f6 @96

COPY ~Eldritch_Magic/ITM/EMBBLA.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @259
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @260

COPY ~Eldritch_Magic/ITM/EMELFCHA.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @265
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @266
COPY ~Eldritch_Magic/BAM/IELFCHAN.bam~ ~override~
COPY ~Eldritch_Magic/BAM/GCHAN12.bam~ ~override~

COPY_EXISTING ~WMART2.sto~ ~override~
 ADD_STORE_ITEM ~emsw1h11~ AFTER ~WA2SHIEL~ #0 #0 #0 ~IDENTIFIED~ #1

 PRINT ~He who fights with monsters should look to it that he himself does not become a monster . . . when you gaze long into the abyss the abyss also gazes into you
- Friedrich Nietzsche~
/////////////////////////////////////////////////////////
BEGIN ~Bladesinger's Artifacts and Bhaalspawn Items~ DESIGNATED 18
SUBCOMPONENT ~BG2EE: Item Expansion [BETA]~
REQUIRE_PREDICATE GAME_IS ~bg2ee~ @25

ACTION_IF (NOT FILE_EXISTS_IN_GAME ~finsarev.itm~) BEGIN
  COMPILE ~Eldritch_Magic/BAF/Ascension~
  COMPILE ~Eldritch_Magic/Dialog/Ascension~
  COPY ~Eldritch_Magic/BAF/Ascension/sarev25.bcs~ ~override~
END
COPY ~Eldritch_Magic/ITM/Ascension/finsarev.itm~ ~override~
  SAY NAME2 @3000
  SAY DESC  @3001
COPY ~Eldritch_Magic/Effects/Ascension/reaver.eff~ ~override~
COPY ~Eldritch_Magic/Spells/Ascension/reaver.spl~ ~override~
COPY ~Eldritch_Magic/Spells/Ascension/reavimm.spl~ ~override~

COPY ~Eldritch_Magic/Creatures/hlrevan.cre~ ~override~
COPY ~Eldritch_Magic/Creatures/idemon01.cre~ ~override~
COPY ~Eldritch_Magic/Creatures/idemon02.cre~ ~override~

COPY ~Eldritch_Magic/Creatures/Sar1L.BMP~ ~override/Sar1L.BMP~
COPY ~Eldritch_Magic/Creatures/Sar2L.BMP~ ~override/Sar2L.BMP~
COPY ~Eldritch_Magic/Creatures/Sar1L.BMP~ ~portraits~
COPY ~Eldritch_Magic/Creatures/Sar2L.BMP~ ~portraits~
COPY ~Eldritch_Magic/Creatures/Sar1M.BMP~ ~override/Sar1L.BMP~
COPY ~Eldritch_Magic/Creatures/Sar2M.BMP~ ~override/Sar2L.BMP~
COPY ~Eldritch_Magic/Creatures/Sar1M.BMP~ ~portraits~
COPY ~Eldritch_Magic/Creatures/Sar2M.BMP~ ~portraits~

COPY  ~Eldritch_Magic/Spells/emcdchan.spl~   ~override~
      SAY 0xfe @219
COPY  ~Eldritch_Magic/Spells/emcdblsr.spl~   ~override~
      SAY 0x15e @213
COPY  ~Eldritch_Magic/Spells/emcdsw1h.spl~   ~override~
      SAY 0xfe @214
COPY  ~Eldritch_Magic/Effects/emundead.eff~   ~override~
COPY  ~Eldritch_Magic/Effects/emdemon.eff~   ~override~
COPY  ~Eldritch_Magic/Spells/emsare1.spl~   ~override~
COPY  ~Eldritch_Magic/Spells/emsare2.spl~   ~override~
COPY  ~Eldritch_Magic/Dialog/emsw1h01.dlg~   ~override~
      SAY 0x34  @200
      SAY 0x44  @201
      SAY 0x54  @202
      SAY 0x64  @204
      SAY 0x74  @206
      SAY 0x84  @208
      SAY 0x98  @198
      SAY 0xb8  @199
      SAY 0xd8  @203
      SAY 0xf8  @205
      SAY 0x118 @207

COPY_EXISTING ~lunumab.2da~ ~override~
  APPEND ITEMDIAL.2da ~EMSW1H01      5689   EMSW1H01~
  
COPY_EXISTING ~item_use.2da~ ~override~
  APPEND item_use.2da ~emplat01   SAREVOK    9382       2~
  APPEND item_use.2da ~emsw2h01   SAREVOK    9382       2~
  APPEND item_use.2da ~emsarev   SAREVOK    9382       2~

COPY ~Eldritch_Magic/ITM/emboot01.itm~ ~override~
  SAY NAME1 @26
  SAY NAME2 @27
  SAY UNIDENTIFIED_DESC @28
  SAY DESC @29
  SAY 0x15e @96

COPY ~Eldritch_Magic/ITM/emchan01.itm~ ~override~
  SAY NAME1 @30
  SAY NAME2 @31
  SAY UNIDENTIFIED_DESC @32
  SAY DESC @33
  SAY 0x3fe @96

COPY ~Eldritch_Magic/ITM/emclck01.itm~ ~override~
  SAY NAME1 @34
  SAY NAME2 @35
  SAY UNIDENTIFIED_DESC @36
  SAY DESC @37
  SAY 0x2b6 @96

COPY ~Eldritch_Magic/ITM/emring01.itm~ ~override~
  SAY NAME1 @38
  SAY NAME2 @39
  SAY UNIDENTIFIED_DESC @40
  SAY DESC @41
  SAY 0x2de @96

COPY ~Eldritch_Magic/BAM/emsw1h01.bam~ ~override~
COPY ~Eldritch_Magic/ITM/emsw1h01.itm~ ~override~
  SAY NAME1 @42
  SAY NAME2 @43
  SAY UNIDENTIFIED_DESC @44
  SAY DESC @45
  SAY 0x586 @96

COPY ~Eldritch_Magic/ITM/emsw1h11.itm~ ~override~
  SAY NAME1 @46
  SAY NAME2 @47
  SAY UNIDENTIFIED_DESC @48
  SAY DESC @49
  SAY 0x1f6 @96
  
COPY ~Eldritch_Magic/ITM/EMBBLA.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @259
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @260

COPY ~Eldritch_Magic/ITM/EMELFCHA.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @265
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @266
COPY ~Eldritch_Magic/BAM/IELFCHAN.bam~ ~override~
COPY ~Eldritch_Magic/BAM/GCHAN12.bam~ ~override~

// COPY ~Eldritch_Magic/ITM/emcesp01.itm~ ~override~
//  SAY NAME1 ~~
//  SAY NAME2 @50
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @51

COPY ~Eldritch_Magic/ITM/emimoen.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @52
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @53
  SAY 0x2de @98
  
COPY_EXISTING ~cuimoen.cre~ ~override/cuimoen.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
COPY_EXISTING ~cuimoen2.cre~ ~override/cuimoen2.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
COPY_EXISTING ~cuimoen3.cre~ ~override/cuimoen3.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
COPY_EXISTING ~dpimo01.cre~ ~override/dpimo01.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
COPY_EXISTING ~dream1.cre~ ~override/dream1.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
COPY_EXISTING ~drim01.cre~ ~override/drim01.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
COPY_EXISTING ~drim02.cre~ ~override/drim02.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
COPY_EXISTING ~imoen.cre~ ~override/imoen.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
COPY_EXISTING ~imoen15.cre~ ~override/imoen15.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
COPY_EXISTING ~imoen211.cre~ ~override/imoen211.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
COPY_EXISTING ~imoen213.cre~ ~override/imoen213.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
COPY_EXISTING ~imoendrm.cre~ ~override/imoendrm.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
COPY_EXISTING ~ohb1imoe.cre~ ~override/ohb1imoe.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
  
COPY ~Eldritch_Magic/ITM/emplat01.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @54
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @55

COPY ~Eldritch_Magic/ITM/emsw2h01.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @56
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @57
  
COPY ~Eldritch_Magic/ITM/emsarev.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @56
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @57
  
COPY ~Eldritch_Magic/ITM/emheart.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @220
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @221

COPY ~Eldritch_Magic/ITM/emhugh.itm~ ~override~
  SAY NAME1 @42
  SAY NAME2 @255
  SAY UNIDENTIFIED_DESC @44
  SAY DESC @256
  SAY 0x19e @224
  SAY 0x1ce @224
  SAY 0x1fe @224

COPY ~Eldritch_Magic/ITM/emhide.itm~ ~override~
  SAY NAME1 @225
  SAY NAME2 @222
  SAY UNIDENTIFIED_DESC @226
  SAY DESC @223
  SAY 0x22e @224

COPY_EXISTING ~WMART2.sto~ ~override~
 ADD_STORE_ITEM ~emsw1h11~ AFTER ~WA2SHIEL~ #0 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~25SPELL2.sto~ ~override~
 ADD_STORE_ITEM ~emplat01~ AFTER ~RING02~ #0 #0 #0 ~IDENTIFIED~ #1
// ADD_STORE_ITEM ~emcesp01~ LAST #0 #0 #0 ~IDENTIFIED~ #1
COPY ~Eldritch_Magic/ITM/BGEE/misc72.itm~ ~override~
  SAY 0x226 @224
COPY ~Eldritch_Magic/ITM/BGEE/misc73.itm~ ~override~
  SAY 0xae @224
COPY_EXISTING ~BAG20.sto~ ~override~
 ADD_STORE_ITEM ~SW2H16~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC72~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC73~ LAST #30 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~BAG21.sto~ ~override~
 ADD_STORE_ITEM ~SW2H16~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC72~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC73~ LAST #30 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~BAG22.sto~ ~override~
 ADD_STORE_ITEM ~SW2H16~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC72~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC73~ LAST #30 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~BAG23.sto~ ~override~
 ADD_STORE_ITEM ~SW2H16~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC72~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC73~ LAST #30 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~BAG24.sto~ ~override~
 ADD_STORE_ITEM ~SW2H16~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC72~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC73~ LAST #30 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~BAG25.sto~ ~override~
 ADD_STORE_ITEM ~SW2H16~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC72~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC73~ LAST #30 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~BAG26.sto~ ~override~
 ADD_STORE_ITEM ~SW2H16~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC72~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC73~ LAST #30 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~BAG27.sto~ ~override~
 ADD_STORE_ITEM ~SW2H16~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC72~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC73~ LAST #30 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~BAG28.sto~ ~override~
 ADD_STORE_ITEM ~SW2H16~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC72~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC73~ LAST #30 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~BAG29.sto~ ~override~
 ADD_STORE_ITEM ~SW2H16~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC72~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC73~ LAST #30 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~BAG30.sto~ ~override~
 ADD_STORE_ITEM ~SW2H16~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC72~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC73~ LAST #30 #0 #0 ~IDENTIFIED~ #1

PRINT ~He who fights with monsters should look to it that he himself does not become a monster . . . when you gaze long into the abyss the abyss also gazes into you
- Friedrich Nietzsche~
/////////////////////////////////////////////////////////
BEGIN ~Bladesinger's Artifacts and Ribald, Deidre, and Joluv Mods~ DESIGNATED 19
SUBCOMPONENT ~BG2EE: Item Expansion [BETA]~
REQUIRE_PREDICATE GAME_IS ~bg2ee~ @25

COPY ~Eldritch_Magic/Creatures/hlrevan.cre~ ~override~

COPY  ~Eldritch_Magic/Spells/emcdchan.spl~   ~override~
      SAY 0xfe @219
COPY  ~Eldritch_Magic/Spells/emcdblsr.spl~   ~override~
      SAY 0x15e @213
COPY  ~Eldritch_Magic/Spells/emcdsw1h.spl~   ~override~
      SAY 0xfe @214
COPY  ~Eldritch_Magic/Effects/emundead.eff~   ~override~
COPY  ~Eldritch_Magic/Effects/emdemon.eff~   ~override~
COPY  ~Eldritch_Magic/Effects/emhugh1.eff~   ~override~
COPY  ~Eldritch_Magic/Effects/emhugh2.eff~   ~override~
COPY  ~Eldritch_Magic/Effects/emhugh3.eff~   ~override~
COPY  ~Eldritch_Magic/Effects/em2d6.eff~   ~override~
COPY  ~Eldritch_Magic/Dialog/emsw1h01.dlg~   ~override~
      SAY 0x34  @200
      SAY 0x44  @201
      SAY 0x54  @202
      SAY 0x64  @204
      SAY 0x74  @206
      SAY 0x84  @208
      SAY 0x98  @198
      SAY 0xb8  @199
      SAY 0xd8  @203
      SAY 0xf8  @205
      SAY 0x118 @207

COPY_EXISTING ~lunumab.2da~ ~override~
  APPEND ITEMDIAL.2da ~EMSW1H01      5689   EMSW1H01~

COPY ~Eldritch_Magic/ITM/emboot01.itm~ ~override~
  SAY NAME1 @26
  SAY NAME2 @27
  SAY UNIDENTIFIED_DESC @28
  SAY DESC @29
  SAY 0x15e @96

COPY ~Eldritch_Magic/ITM/emchan01.itm~ ~override~
  SAY NAME1 @30
  SAY NAME2 @31
  SAY UNIDENTIFIED_DESC @32
  SAY DESC @33
  SAY 0x3fe @96

COPY ~Eldritch_Magic/ITM/emclck01.itm~ ~override~
  SAY NAME1 @34
  SAY NAME2 @35
  SAY UNIDENTIFIED_DESC @36
  SAY DESC @37
  SAY 0x2b6 @96

COPY ~Eldritch_Magic/ITM/emring01.itm~ ~override~
  SAY NAME1 @38
  SAY NAME2 @39
  SAY UNIDENTIFIED_DESC @40
  SAY DESC @41
  SAY 0x2de @96

COPY ~Eldritch_Magic/BAM/emsw1h01.bam~ ~override~
COPY ~Eldritch_Magic/ITM/emsw1h01.itm~ ~override~
  SAY NAME1 @42
  SAY NAME2 @43
  SAY UNIDENTIFIED_DESC @44
  SAY DESC @45
  SAY 0x586 @96

COPY ~Eldritch_Magic/ITM/emsw1h11.itm~ ~override~
  SAY NAME1 @46
  SAY NAME2 @47
  SAY UNIDENTIFIED_DESC @48
  SAY DESC @49
  SAY 0x1f6 @96

COPY ~Eldritch_Magic/ITM/embelt25.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @58
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @59

COPY ~Eldritch_Magic/ITM/emthay.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @60
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @61
  SAY 0x36e @97

COPY ~Eldritch_Magic/ITM/emsw1h04.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @62
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @63

COPY ~Eldritch_Magic/ITM/emdagg01.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @64
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @65

COPY ~Eldritch_Magic/ITM/emsw1h08.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @66
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @67

COPY ~Eldritch_Magic/BAM/phelm29.bmp~ ~override~
COPY ~Eldritch_Magic/ITM/empsion.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @68
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @69

COPY ~Eldritch_Magic/ITM/emveye.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @70
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @71

COPY ~Eldritch_Magic/ITM/BGEE/misc72.itm~ ~override~
  SAY 0x226 @224
COPY ~Eldritch_Magic/ITM/BGEE/misc73.itm~ ~override~
  SAY 0xae @224

COPY ~Eldritch_Magic/ITM/emvhand.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @72
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @73
  
COPY ~Eldritch_Magic/ITM/emheart.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @220
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @221

COPY ~Eldritch_Magic/ITM/emhugh.itm~ ~override~
  SAY NAME1 @42
  SAY NAME2 @255
  SAY UNIDENTIFIED_DESC @44
  SAY DESC @256
  SAY 0x19e @224
  SAY 0x1ce @224
  SAY 0x1fe @224

COPY ~Eldritch_Magic/ITM/emhide.itm~ ~override~
  SAY NAME1 @225
  SAY NAME2 @222
  SAY UNIDENTIFIED_DESC @226
  SAY DESC @223
  SAY 0x22e @224

COPY ~Eldritch_Magic/ITM/EMAURIL.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @257
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @258
COPY ~Eldritch_Magic/BAM/IAURIL.bam~ ~override~

COPY ~Eldritch_Magic/ITM/EMBBLA.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @259
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @260
  
COPY ~Eldritch_Magic/ITM/EMBLOOD.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @261
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @262
COPY ~Eldritch_Magic/BAM/IBLOOD.bam~ ~override~

COPY ~Eldritch_Magic/ITM/EMCLOASC.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @263
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @264
COPY ~Eldritch_Magic/BAM/ICLOAKSC.bam~ ~override~

COPY ~Eldritch_Magic/ITM/EMELFCHA.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @265
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @266
COPY ~Eldritch_Magic/BAM/IELFCHAN.bam~ ~override~
COPY ~Eldritch_Magic/BAM/GCHAN12.bam~ ~override~

COPY ~Eldritch_Magic/ITM/EMGLORY.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @267
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @268
COPY ~Eldritch_Magic/BAM/IGLORY.bam~ ~override~

COPY ~Eldritch_Magic/ITM/EMJHOSWD.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @269
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @270
COPY ~Eldritch_Magic/BAM/IJHOSWD3.bam~ ~override~

COPY ~Eldritch_Magic/ITM/EMZZ36DG.itm~ ~override~
  SAY NAME1 ~~
  SAY NAME2 @271
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @272
COPY ~Eldritch_Magic/BAM/IZZ36DGD.bam~ ~override~
COPY ~Eldritch_Magic/Effects/ZZ36DGDH.eff~ ~override~
COPY ~Eldritch_Magic/Effects/ZZ36DGDD.eff~ ~override~
COPY ~Eldritch_Magic/Spells/EM428.spl~ ~override~
  SAY 0x8 @273
  SAY 0x50 @274
  SAY 0x18e @277
COPY ~Eldritch_Magic/Spells/EM714.spl~ ~override~
  SAY 0x8 @275
  SAY 0x50 @276
  SAY 0x21e @278
COPY ~Eldritch_Magic/BAM/conjuh.bam~ ~override~
COPY ~Eldritch_Magic/BAM/enchah.bam~ ~override~
COPY ~Eldritch_Magic/VVC/conjuh.vvc~ ~override~
COPY ~Eldritch_Magic/VVC/enchah.vvc~ ~override~
COPY ~Eldritch_Magic/BAM/EM428B.bam~ ~override~
COPY ~Eldritch_Magic/BAM/EM428C.bam~ ~override~
COPY ~Eldritch_Magic/BAM/EM714B.bam~ ~override~
COPY ~Eldritch_Magic/BAM/EM714C.bam~ ~override~

COPY_EXISTING ~RIBALD3.sto~ ~override~
 ADD_STORE_ITEM ~emdagg01~ AFTER ~DAGG15~ #3 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~EMPSION~ AFTER ~AX1H11~ #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~EMTHAY~ AFTER ~POTN42~ #0 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~WMART1.sto~ ~override~
 ADD_STORE_ITEM ~emsw1h08~ AFTER ~WAAXE~ #1 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~embelt25~ LAST #0 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~WMART2.sto~ ~override~
 ADD_STORE_ITEM ~emvhand~ AFTER ~WA2ROBE~ #3 #1 #1 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~emveye~ BEFORE ~WA2S1H~ #3 #1 #1 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~emsw1h11~ AFTER ~WA2SHIEL~ #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~emsw1h04~ LAST #0 #0 #0 ~IDENTIFIED~ #1

 PRINT ~He who fights with monsters should look to it that he himself does not become a monster . . . when you gaze long into the abyss the abyss also gazes into you
- Friedrich Nietzsche~
/////////////////////////////////////////////////////////
BEGIN ~Bladesinger's Artifacts, Bhaalspawn, and Ribald, Deidre, and Joluv Mods~ DESIGNATED 20
SUBCOMPONENT ~BG2EE: Item Expansion [BETA]~
REQUIRE_PREDICATE GAME_IS ~bg2ee~ @25

ACTION_IF (NOT FILE_EXISTS_IN_GAME ~finsarev.itm~) BEGIN
  COMPILE ~Eldritch_Magic/BAF/Ascension~
  COMPILE ~Eldritch_Magic/Dialog/Ascension~
  COPY ~Eldritch_Magic/BAF/Ascension/sarev25.bcs~ ~override~
END
COPY ~Eldritch_Magic/ITM/Ascension/finsarev.itm~ ~override~
  SAY NAME2 @3000
  SAY DESC  @3001
COPY ~Eldritch_Magic/Effects/Ascension/reaver.eff~ ~override~
COPY ~Eldritch_Magic/Spells/Ascension/reaver.spl~ ~override~
COPY ~Eldritch_Magic/Spells/Ascension/reavimm.spl~ ~override~

COMPILE ~Eldritch_Magic/Dialog~
COPY ~Eldritch_Magic/Creatures/hlrevan.cre~ ~override~
COPY ~Eldritch_Magic/Creatures/idemon01.cre~ ~override~
COPY ~Eldritch_Magic/Creatures/idemon02.cre~ ~override~

COPY ~Eldritch_Magic/Creatures/Sar1L.BMP~ ~override/Sar1L.BMP~
COPY ~Eldritch_Magic/Creatures/Sar2L.BMP~ ~override/Sar2L.BMP~
COPY ~Eldritch_Magic/Creatures/Sar1L.BMP~ ~portraits~
COPY ~Eldritch_Magic/Creatures/Sar2L.BMP~ ~portraits~
COPY ~Eldritch_Magic/Creatures/Sar1M.BMP~ ~override/Sar1L.BMP~
COPY ~Eldritch_Magic/Creatures/Sar2M.BMP~ ~override/Sar2L.BMP~
COPY ~Eldritch_Magic/Creatures/Sar1M.BMP~ ~portraits~
COPY ~Eldritch_Magic/Creatures/Sar2M.BMP~ ~portraits~

COPY  ~Eldritch_Magic/Spells/emcdchan.spl~   ~override~
      SAY 0xfe @219 //You feel a tug from the Pocket Plane as an artifact lost to time materializes among your possessions. Surely such a happening is linked to your powerful heritage.
COPY  ~Eldritch_Magic/Spells/emcdblsr.spl~   ~override~
      SAY 0x15e @213 //You have been acknowledged by the Bladesinger's Guild.
COPY  ~Eldritch_Magic/Spells/emcdsw1h.spl~   ~override~
      SAY 0xfe @214 //You are an exemplary Bladesinger and a hero among elves. The Gods themselves have taken notice of your righteous fury and now the Seldarine have blessed you with the tool to exact it. Be advised not to abuse a divine gift.
COPY  ~Eldritch_Magic/Effects/emundead.eff~   ~override~
COPY  ~Eldritch_Magic/Effects/emdemon.eff~   ~override~
COPY  ~Eldritch_Magic/Effects/emhugh1.eff~   ~override~
COPY  ~Eldritch_Magic/Effects/emhugh2.eff~   ~override~
COPY  ~Eldritch_Magic/Effects/emhugh3.eff~   ~override~
COPY  ~Eldritch_Magic/Effects/em2d6.eff~   ~override~
COPY  ~Eldritch_Magic/Dialog/emsw1h01.dlg~   ~override~
      SAY 0x34  @200 //(The sword flashes for a moment, then permeates your mind with melodic Elven whispers.)
      SAY 0x44  @201 // ...
      SAY 0x54  @202 // "I am as I have always been."
      SAY 0x64  @204 //(The sword emits a shockingly demi-human sigh) "42."
      SAY 0x74  @206 //(The sword is silent a moment.) "That would have to be a hectaoncheire, 'hundredhanded one' - a few Gods fell that day. Pray you never face one, much less two."
      SAY 0x84  @208 // "I may be a holy artifact forged by the Gods, but I'm still a sword. Aren't there any evil Bhaalspawn left?"
      SAY 0x98  @198 // Never mind. Let's just continue on for now.
      SAY 0xb8  @199 // What's your status, sword?
      SAY 0xd8  @203 // What is the answer to life, the universe, and everything?
      SAY 0xf8  @205 // What's the most powerful foe you've vanquished?
      SAY 0x118 @207 // What would you have me do, O Sentient Sword?
COPY  ~Eldritch_Magic/Spells/emsare1.spl~   ~override~
      SAY 0xce @94 //Blades
COPY  ~Eldritch_Magic/Spells/emsare2.spl~   ~override~
      SAY 0xce @95 //Spikes

COPY_EXISTING ~lunumab.2da~ ~override~
  APPEND ITEMDIAL.2da ~EMSW1H01      5689   EMSW1H01~

COPY_EXISTING ~item_use.2da~ ~override~
  APPEND item_use.2da ~emplat01   SAREVOK    9382       2~
  APPEND item_use.2da ~emsw2h01   SAREVOK    9382       2~
  APPEND item_use.2da ~emsarev   SAREVOK    9382       2~

COPY ~Eldritch_Magic/ITM/emboot01.itm~ ~override~ // Elven Boots of Speed: The Paws of the Lythari @96 = Bladesinger
  SAY NAME1 @26
  SAY NAME2 @27
  SAY UNIDENTIFIED_DESC @28
  SAY DESC @29
  SAY 0x15e @96

COPY ~Eldritch_Magic/ITM/emchan01.itm~ ~override~ // Holy Elven Chain +6 @96 = Bladesinger
  SAY NAME1 @30
  SAY NAME2 @31
  SAY UNIDENTIFIED_DESC @32
  SAY DESC @33
  SAY 0x3fe @96

COPY ~Eldritch_Magic/ITM/emclck01.itm~ ~override~ // Bladesinger's Shroud @96 = Bladesinger
  SAY NAME1 @34
  SAY NAME2 @35
  SAY UNIDENTIFIED_DESC @36
  SAY DESC @37
  SAY 0x2b6 @96

COPY ~Eldritch_Magic/ITM/emring01.itm~ ~override~ // Bladesinger's Signet @96 = Bladesinger
  SAY NAME1 @38
  SAY NAME2 @39
  SAY UNIDENTIFIED_DESC @40
  SAY DESC @41
  SAY 0x2de @96

COPY ~Eldritch_Magic/BAM/emsw1h01.bam~ ~override~
COPY ~Eldritch_Magic/ITM/emsw1h01.itm~ ~override~// Seldarine's Fury +6: Shame of the Gods @96 = Bladesinger
  SAY NAME1 @42
  SAY NAME2 @43
  SAY UNIDENTIFIED_DESC @44
  SAY DESC @45
  SAY 0x586 @96

COPY ~Eldritch_Magic/ITM/emsw1h11.itm~ ~override~ // Angharradh's Song @96 = Bladesinger
  SAY NAME1 ~~
  SAY NAME2 @47
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @49
  SAY 0x1f6 @96

COPY ~Eldritch_Magic/ITM/embelt25.itm~ ~override~ // Girdle of Titan Strength
  SAY NAME1 ~~
  SAY NAME2 @58
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @59

COPY ~Eldritch_Magic/ITM/emthay.itm~ ~override~ // Red Robe of Thay @97 = Red Wizard of Thay
  SAY NAME1 ~~
  SAY NAME2 @60
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @61
  SAY 0x36e @97

COPY ~Eldritch_Magic/ITM/emsw1h04.itm~ ~override~ // Blue Flame Taragarth +3
  SAY NAME1 ~~
  SAY NAME2 @62
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @63

COPY ~Eldritch_Magic/ITM/emdagg01.itm~ ~override~ // Netherese Spellblade
  SAY NAME1 ~~
  SAY NAME2 @64
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @65

COPY ~Eldritch_Magic/ITM/emsw1h08.itm~ ~override~ // Plasma Blade of Kossuth: Igneus Nova
  SAY NAME1 ~~
  SAY NAME2 @66
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @67

COPY ~Eldritch_Magic/BAM/phelm29.bmp~ ~override~
COPY ~Eldritch_Magic/ITM/empsion.itm~ ~override~ // Drow Psionicist's Cowl
  SAY NAME1 ~~
  SAY NAME2 @68
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @69

COPY ~Eldritch_Magic/ITM/emveye.itm~ ~override~ // Eye of Vecna
  SAY NAME1 ~~
  SAY NAME2 @70
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @71

COPY ~Eldritch_Magic/ITM/emvhand.itm~ ~override~ // Hand of Vecna
  SAY NAME1 ~~
  SAY NAME2 @72
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @73

// COPY ~Eldritch_Magic/ITM/emcesp01.itm~ ~override~ // Claw of Kazgaroth
//  SAY NAME1 ~~
//  SAY NAME2 @50
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @51

COPY ~Eldritch_Magic/ITM/emimoen.itm~ ~override~ // Imoen's Belt @98 = IMOEN
  SAY NAME1 ~~
  SAY NAME2 @52
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @53
  SAY 0x2de @98

COPY_EXISTING ~cuimoen.cre~ ~override/cuimoen.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
COPY_EXISTING ~cuimoen2.cre~ ~override/cuimoen2.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
COPY_EXISTING ~cuimoen3.cre~ ~override/cuimoen3.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
COPY_EXISTING ~dpimo01.cre~ ~override/dpimo01.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
COPY_EXISTING ~dream1.cre~ ~override/dream1.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
COPY_EXISTING ~drim01.cre~ ~override/drim01.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
COPY_EXISTING ~drim02.cre~ ~override/drim02.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
COPY_EXISTING ~imoen.cre~ ~override/imoen.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
COPY_EXISTING ~imoen15.cre~ ~override/imoen15.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
COPY_EXISTING ~imoen211.cre~ ~override/imoen211.cre~ // ***
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
COPY_EXISTING ~imoen213.cre~ ~override/imoen213.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
COPY_EXISTING ~imoendrm.cre~ ~override/imoendrm.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~
COPY_EXISTING ~ohb1imoe.cre~ ~override/ohb1imoe.cre~
  ADD_CRE_ITEM ~EMIMOEN~ #0 #0 #0 ~IDENTIFIED~ ~BELT~

COPY ~Eldritch_Magic/ITM/emplat01.itm~ ~override~ // Sarevok's Bladed Armor +5
  SAY NAME1 ~~
  SAY NAME2 @54
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @55

COPY ~Eldritch_Magic/ITM/emsw2h01.itm~ ~override~ // Sword of Chaos +5
  SAY NAME1 ~~
  SAY NAME2 @56
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @57
  
COPY ~Eldritch_Magic/ITM/emsarev.itm~ ~override~ // Sword of Chaos +5 (Ascension)
  SAY NAME1 ~~
  SAY NAME2 @56
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @57

COPY ~Eldritch_Magic/ITM/emheart.itm~ ~override~ // Black Heart of Kazgaroth
  SAY NAME1 ~~
  SAY NAME2 @220
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @221

COPY ~Eldritch_Magic/ITM/emhugh.itm~ ~override~ // Sword of Cymrych Hugh
  SAY NAME1 @42
  SAY NAME2 @255
  SAY UNIDENTIFIED_DESC @44
  SAY DESC @256
  SAY 0x19e @224
  SAY 0x1ce @224
  SAY 0x1fe @224

COPY ~Eldritch_Magic/ITM/emhide.itm~ ~override~ // Kazgaroth's Hide
  SAY NAME1 @225
  SAY NAME2 @222
  SAY UNIDENTIFIED_DESC @226
  SAY DESC @223
  SAY 0x22e @224

COPY ~Eldritch_Magic/ITM/EMAURIL.itm~ ~override~ // Breath of Auril +3
  SAY NAME1 ~~
  SAY NAME2 @257
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @258
COPY ~Eldritch_Magic/BAM/IAURIL.bam~ ~override~

COPY ~Eldritch_Magic/ITM/EMBBLA.itm~ ~override~ // Lore of the Bladesingers
  SAY NAME1 ~~
  SAY NAME2 @259
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @260
  
COPY ~Eldritch_Magic/ITM/EMBLOOD.itm~ ~override~ // Bathed-In-Blood +4
  SAY NAME1 ~~
  SAY NAME2 @261
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @262
COPY ~Eldritch_Magic/BAM/IBLOOD.bam~ ~override~

COPY ~Eldritch_Magic/ITM/EMCLOASC.itm~ ~override~ // Cloak of Scintillating Colors
  SAY NAME1 ~~
  SAY NAME2 @263
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @264
COPY ~Eldritch_Magic/BAM/ICLOAKSC.bam~ ~override~

COPY ~Eldritch_Magic/ITM/EMELFCHA.itm~ ~override~ // Elven Chain Mail of the Hand +3
  SAY NAME1 ~~
  SAY NAME2 @265
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @266
COPY ~Eldritch_Magic/BAM/IELFCHAN.bam~ ~override~
COPY ~Eldritch_Magic/BAM/GCHAN12.bam~ ~override~

COPY ~Eldritch_Magic/ITM/EMGLORY.itm~ ~override~ // The Glory of Suffering +6
  SAY NAME1 ~~
  SAY NAME2 @267
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @268
COPY ~Eldritch_Magic/BAM/IGLORY.bam~ ~override~

COPY ~Eldritch_Magic/ITM/EMJHOSWD.itm~ ~override~ // Singing Blade of Aihonen +5
  SAY NAME1 ~~
  SAY NAME2 @269
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @270
COPY ~Eldritch_Magic/BAM/IJHOSWD3.bam~ ~override~

COPY ~Eldritch_Magic/ITM/EMZZ36DG.itm~ ~override~ // Dead God's Dreaming +4, +6 vs. good
  SAY NAME1 ~~
  SAY NAME2 @271
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @272
COPY ~Eldritch_Magic/BAM/IZZ36DGD.bam~ ~override~
COPY ~Eldritch_Magic/Effects/ZZ36DGDH.eff~ ~override~
COPY ~Eldritch_Magic/Effects/ZZ36DGDD.eff~ ~override~
COPY ~Eldritch_Magic/Spells/EM428.spl~ ~override~
  SAY 0x8 @273
  SAY 0x50 @274
  SAY 0x18e @277
COPY ~Eldritch_Magic/Spells/EM714.spl~ ~override~
  SAY 0x8 @275
  SAY 0x50 @276
  SAY 0x21e @278
COPY ~Eldritch_Magic/BAM/conjuh.bam~ ~override~
COPY ~Eldritch_Magic/BAM/enchah.bam~ ~override~
COPY ~Eldritch_Magic/VVC/conjuh.vvc~ ~override~
COPY ~Eldritch_Magic/VVC/enchah.vvc~ ~override~
COPY ~Eldritch_Magic/BAM/EM428B.bam~ ~override~
COPY ~Eldritch_Magic/BAM/EM428C.bam~ ~override~
COPY ~Eldritch_Magic/BAM/EM714B.bam~ ~override~
COPY ~Eldritch_Magic/BAM/EM714C.bam~ ~override~

COPY_EXISTING ~RIBALD3.sto~ ~override~
 ADD_STORE_ITEM ~emdagg01~ AFTER ~DAGG15~ #3 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~EMPSION~ AFTER ~AX1H11~ #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~emthay~ AFTER ~POTN42~ #0 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~WMART1.sto~ ~override~
 ADD_STORE_ITEM ~emsw1h08~ AFTER ~WAAXE~ #1 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~embelt25~ LAST #0 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~WMART2.sto~ ~override~
 ADD_STORE_ITEM ~emvhand~ AFTER ~WA2ROBE~ #3 #1 #1 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~emveye~ BEFORE ~WA2S1H~ #3 #1 #1 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~emsw1h11~ AFTER ~WA2SHIEL~ #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~emsw1h04~ LAST #0 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~25SPELL2.sto~ ~override~
 ADD_STORE_ITEM ~emplat01~ AFTER ~RING02~ #0 #0 #0 ~IDENTIFIED~ #1
// ADD_STORE_ITEM ~emcesp01~ LAST #0 #0 #0 ~IDENTIFIED~ #1
COPY ~Eldritch_Magic/ITM/BGEE/misc72.itm~ ~override~ // The Claw of Kazgaroth
  SAY 0x226 @224 // It seems that even death and dismemberment has not eased Kazgaroth's hatred for the Sword of Cymrych Hugh.
COPY ~Eldritch_Magic/ITM/BGEE/misc73.itm~ ~override~ // The Horn of Kazgaroth
  SAY 0xae @224 // It seems that even death and dismemberment has not eased Kazgaroth's hatred for the Sword of Cymrych Hugh.
COPY_EXISTING ~BAG20.sto~ ~override~
 ADD_STORE_ITEM ~SW2H16~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC72~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC73~ LAST #30 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~BAG21.sto~ ~override~
 ADD_STORE_ITEM ~SW2H16~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC72~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC73~ LAST #30 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~BAG22.sto~ ~override~
 ADD_STORE_ITEM ~SW2H16~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC72~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC73~ LAST #30 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~BAG23.sto~ ~override~
 ADD_STORE_ITEM ~SW2H16~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC72~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC73~ LAST #30 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~BAG24.sto~ ~override~
 ADD_STORE_ITEM ~SW2H16~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC72~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC73~ LAST #30 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~BAG25.sto~ ~override~
 ADD_STORE_ITEM ~SW2H16~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC72~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC73~ LAST #30 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~BAG26.sto~ ~override~
 ADD_STORE_ITEM ~SW2H16~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC72~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC73~ LAST #30 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~BAG27.sto~ ~override~
 ADD_STORE_ITEM ~SW2H16~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC72~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC73~ LAST #30 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~BAG28.sto~ ~override~
 ADD_STORE_ITEM ~SW2H16~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC72~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC73~ LAST #30 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~BAG29.sto~ ~override~
 ADD_STORE_ITEM ~SW2H16~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC72~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC73~ LAST #30 #0 #0 ~IDENTIFIED~ #1
COPY_EXISTING ~BAG30.sto~ ~override~
 ADD_STORE_ITEM ~SW2H16~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC72~ LAST #0 #0 #0 ~IDENTIFIED~ #1
 ADD_STORE_ITEM ~MISC73~ LAST #30 #0 #0 ~IDENTIFIED~ #1

// BGEE- Won't appear in BG2EE
COPY  ~Eldritch_Magic/Effects/emlaw.eff~   ~override~

COPY ~Eldritch_Magic/ITM/emsw1h05.itm~ ~override~ // Silver Long Sword +2
  SAY NAME1 ~~
  SAY NAME2 @102
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @103
  
COPY ~Eldritch_Magic/ITM/emsw1h06.itm~ ~override~ // Flaming Burst Long Sword +1
  SAY NAME1 ~~
  SAY NAME2 @104
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @105

COPY ~Eldritch_Magic/ITM/emsw1h07.itm~ ~override~ // Frost-Fire Long Sword +2
  SAY NAME1 ~~
  SAY NAME2 @106
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @107

COPY ~Eldritch_Magic/ITM/emsw1h10.itm~ ~override~ // Mithral Long Sword +3
  SAY NAME1 ~~
  SAY NAME2 @108
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @109
  
COPY ~Eldritch_Magic/ITM/emsw1h02.itm~ ~override~ // Adamantine Long Sword of Biting +1
  SAY NAME1 ~~
  SAY NAME2 @110
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @111
  
COPY ~Eldritch_Magic/ITM/emsw1h12.itm~ ~override~ // Vampiric Short Sword +1
  SAY NAME1 ~~
  SAY NAME2 @112
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @113
  
COPY ~Eldritch_Magic/ITM/emsw1h03.itm~ ~override~ // Masterwork Cold Iron Long Sword
  SAY NAME1 ~~
  SAY NAME2 @114
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @115

COPY ~Eldritch_Magic/ITM/emsw1h13.itm~ ~override~ // Elemental Long Sword +1
  SAY NAME1 ~~
  SAY NAME2 @116
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @117

COPY ~Eldritch_Magic/ITM/emsw1h09.itm~ ~override~ // Holy Avenger Long Sword +3
  SAY NAME1 ~~
  SAY NAME2 @118
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @119
  
COPY ~Eldritch_Magic/ITM/embhaal.itm~ ~override~ // Bhaal's Holy Symbol
  SAY NAME1 ~~
  SAY NAME2 @120
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @121
  
COPY ~Eldritch_Magic/ITM/emchanco.itm~ ~override~ // Elven Chain Mail of the Collector
  SAY NAME1 ~~
  SAY NAME2 @140
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @141

// Fireball-Lightning Bolt
COPY ~Eldritch_Magic/Spells/EMIMPFB.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMIMPLB.spl~ ~override~
COPY ~Eldritch_Magic/ITM/EMFBLB.itm~ ~override~
  SAY NAME1 @1001
  SAY NAME2 @1001
  SAY UNIDENTIFIED_DESC @1002
  SAY DESC @1002
COPY ~Eldritch_Magic/Spells/EMFBLB.spl~ ~override~
  SAY NAME1 @1001
  SAY NAME2 @1001
  SAY UNIDENTIFIED_DESC @1002
  SAY DESC @1002

// Wand of Fire and Lightning
COPY ~Eldritch_Magic/ITM/EMWAND05.itm~ ~override~
  SAY NAME1 @2001
  SAY NAME2 @2002
  SAY UNIDENTIFIED_DESC @2003
  SAY DESC @2004

// Improved Magic Missile
COPY ~Eldritch_Magic/Spells/EMMM0.spl~ ~override~
COPY ~Eldritch_Magic/ITM/EMIMPMM.itm~ ~override~
  SAY NAME1 @1003
  SAY NAME2 @1003
  SAY UNIDENTIFIED_DESC @1004
  SAY DESC @1004
COPY ~Eldritch_Magic/Spells/EMIMPMM.spl~ ~override~
  SAY NAME1 @1003
  SAY NAME2 @1003
  SAY UNIDENTIFIED_DESC @1004
  SAY DESC @1004

// Shadovar Wraithform
COPY ~Eldritch_Magic/ITM/EMWRAITH.itm~ ~override~
COPY ~Eldritch_Magic/ITM/EMIMPWF.itm~ ~override~
  SAY NAME1 @1005
  SAY NAME2 @1005
  SAY UNIDENTIFIED_DESC @1006
  SAY DESC @1006
COPY ~Eldritch_Magic/Spells/EMIMPWF.spl~ ~override~
  SAY NAME1 @1005
  SAY NAME2 @1005
  SAY UNIDENTIFIED_DESC @1006
  SAY DESC @1006

// Greater Animate Dead
COPY ~Eldritch_Magic/Creatures/EMSKELWA.cre~ ~override~
COPY ~Eldritch_Magic/Creatures/EMSKELWB.cre~ ~override~
COPY ~Eldritch_Magic/Creatures/EMSKELWC.cre~ ~override~
COPY ~Eldritch_Magic/Creatures/EMSKELWD.cre~ ~override~
COPY ~Eldritch_Magic/Effects/SPANDL19.eff~ ~override~
COPY ~Eldritch_Magic/Effects/SPANDL23.eff~ ~override~
COPY ~Eldritch_Magic/Effects/SPANDL27.eff~ ~override~
COPY ~Eldritch_Magic/Effects/SPANDL31.eff~ ~override~
COPY ~Eldritch_Magic/ITM/EMSKELWB.itm~ ~override~
COPY ~Eldritch_Magic/ITM/EMSKELWC.itm~ ~override~
COPY ~Eldritch_Magic/ITM/EMSKELWD.itm~ ~override~
COPY ~Eldritch_Magic/ITM/EMIMPAD.itm~ ~override~
  SAY NAME1 @1007
  SAY NAME2 @1007
  SAY UNIDENTIFIED_DESC @1008
  SAY DESC @1008
COPY ~Eldritch_Magic/Spells/EMIMPAD.spl~ ~override~
  SAY NAME1 @1007
  SAY NAME2 @1007
  SAY UNIDENTIFIED_DESC @1008
  SAY DESC @1008

// Shapeshift: Lycanthrope
COPY ~Eldritch_Magic/Spells/EMWW.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMGWW.spl~ ~override~
COPY ~Eldritch_Magic/ITM/EMSSWW.itm~ ~override~
  SAY NAME1 @1009
  SAY NAME2 @1009
  SAY UNIDENTIFIED_DESC @1010
  SAY DESC @1010
COPY ~Eldritch_Magic/Spells/EMSSWW.spl~ ~override~
  SAY NAME1 @1009
  SAY NAME2 @1009
  SAY UNIDENTIFIED_DESC @1010
  SAY DESC @1010
  
// Shapeshift: Demon Lord
COPY ~Eldritch_Magic/Spells/EMDL.spl~ ~override~
COPY ~Eldritch_Magic/Creatures/EMTANAR.cre~ ~override~
COPY ~Eldritch_Magic/ITM/EMTANAR.itm~ ~override~
COPY ~Eldritch_Magic/Spells/EMSSDL.spl~ ~override~
  SAY NAME1 @1011
  SAY NAME2 @1011
  SAY UNIDENTIFIED_DESC @1012
  SAY DESC @1012

// Call Lightning-Flame Strike
COPY ~Eldritch_Magic/Spells/EMIMPCL.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMIMPFS.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMCLFS.spl~ ~override~
  SAY NAME1 @1013
  SAY NAME2 @1013
  SAY UNIDENTIFIED_DESC @1014
  SAY DESC @1014

// Contingency I
COPY ~Eldritch_Magic/Spells/EMARMOR.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMPROEVI.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMPROPET.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMCONT1.spl~ ~override~
  SAY NAME1 @1015
  SAY NAME2 @1015
  SAY UNIDENTIFIED_DESC @1016
  SAY DESC @1016
  
// Contingency II
COPY ~Eldritch_Magic/Spells/EMIMPVOC.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMIMPBLU.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMIMPRF.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMCONT2.spl~ ~override~
  SAY NAME1 @1017
  SAY NAME2 @1017
  SAY UNIDENTIFIED_DESC @1018
  SAY DESC @1018
  
// Contingency III
COPY ~Eldritch_Magic/Spells/EMIMPStS.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMIMPSB.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMIMPSR.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMCONT3.spl~ ~override~
  SAY NAME1 @1019
  SAY NAME2 @1019
  SAY UNIDENTIFIED_DESC @1020
  SAY DESC @1020
  
// Improved Chromatic Orb
COPY ~Eldritch_Magic/Spells/EMIMPCO.spl~ ~override~
  SAY NAME1 @1021
  SAY NAME2 @1021
  SAY UNIDENTIFIED_DESC @1022
  SAY DESC @1022

// Unweave Magic
COPY ~Eldritch_Magic/Spells/EMIMPPS.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMIMPKW.spl~ ~override~
COPY ~Eldritch_Magic/Spells/EMIMPSS.spl~ ~override~
  SAY NAME1 @1023
  SAY NAME2 @1023
  SAY UNIDENTIFIED_DESC @1024
  SAY DESC @1024
  
// Call Upon Abyss: Baphomet
COPY ~Eldritch_Magic/Spells/EMIMPSC.spl~ ~override~
  SAY NAME1 @1025
  SAY NAME2 @1025
  SAY UNIDENTIFIED_DESC @1026
  SAY DESC @1026

 PRINT ~He who fights with monsters should look to it that he himself does not become a monster . . . when you gaze long into the abyss the abyss also gazes into you
- Friedrich Nietzsche~

BEGIN ~IWDEE: Item Expansion [BETA]~ DESIGNATED 21
REQUIRE_PREDICATE GAME_IS ~iwdee~ @25

// BGEE
COPY  ~Eldritch_Magic/Effects/emlaw.eff~   ~override~

COPY ~Eldritch_Magic/ITM/emsw1h05.itm~ ~override~ // Silver Long Sword +2
  SAY NAME1 ~~
  SAY NAME2 @102
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @103
  
COPY ~Eldritch_Magic/ITM/emsw1h06.itm~ ~override~ // Flaming Burst Long Sword +1
  SAY NAME1 ~~
  SAY NAME2 @104
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @105

COPY ~Eldritch_Magic/ITM/emsw1h07.itm~ ~override~ // Frost-Fire Long Sword +2
  SAY NAME1 ~~
  SAY NAME2 @106
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @107

COPY ~Eldritch_Magic/ITM/emsw1h10.itm~ ~override~ // Mithral Long Sword +3
  SAY NAME1 ~~
  SAY NAME2 @108
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @109
  
COPY ~Eldritch_Magic/ITM/emsw1h02.itm~ ~override~ // Adamantine Long Sword of Biting +1
  SAY NAME1 ~~
  SAY NAME2 @110
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @111
  
COPY ~Eldritch_Magic/ITM/emsw1h12.itm~ ~override~ // Vampiric Short Sword +1
  SAY NAME1 ~~
  SAY NAME2 @112
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @113
  
COPY ~Eldritch_Magic/ITM/emsw1h03.itm~ ~override~ // Masterwork Cold Iron Long Sword
  SAY NAME1 ~~
  SAY NAME2 @114
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @115

COPY ~Eldritch_Magic/ITM/emsw1h13.itm~ ~override~ // Elemental Long Sword +1
  SAY NAME1 ~~
  SAY NAME2 @116
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @117

COPY ~Eldritch_Magic/ITM/emsw1h09.itm~ ~override~ // Holy Avenger Long Sword +3
  SAY NAME1 ~~
  SAY NAME2 @118
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @119
  
COPY ~Eldritch_Magic/ITM/embhaal.itm~ ~override~ // Bhaal's Holy Symbol
  SAY NAME1 ~~
  SAY NAME2 @120
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @121
  
COPY ~Eldritch_Magic/ITM/emchanco.itm~ ~override~ // Elven Chain Mail of the Collector
  SAY NAME1 ~~
  SAY NAME2 @140
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @141
  
// BG2EE
COPY ~Eldritch_Magic/Creatures/Sar1L.BMP~ ~override/Sar1L.BMP~
COPY ~Eldritch_Magic/Creatures/Sar2L.BMP~ ~override/Sar2L.BMP~
COPY ~Eldritch_Magic/Creatures/Sar1L.BMP~ ~portraits~
COPY ~Eldritch_Magic/Creatures/Sar2L.BMP~ ~portraits~
COPY ~Eldritch_Magic/Creatures/Sar1M.BMP~ ~override/Sar1L.BMP~
COPY ~Eldritch_Magic/Creatures/Sar2M.BMP~ ~override/Sar2L.BMP~
COPY ~Eldritch_Magic/Creatures/Sar1M.BMP~ ~portraits~
COPY ~Eldritch_Magic/Creatures/Sar2M.BMP~ ~portraits~

COPY  ~Eldritch_Magic/Spells/emcdchan.spl~   ~override~
      SAY 0xfe @219 //You feel a tug from the Pocket Plane as an artifact lost to time materializes among your possessions. Surely such a happening is linked to your powerful heritage.
COPY  ~Eldritch_Magic/Spells/emcdblsr.spl~   ~override~
      SAY 0x15e @213 //You have been acknowledged by the Bladesinger's Guild.
COPY  ~Eldritch_Magic/Spells/emcdsw1h.spl~   ~override~
      SAY 0xfe @214 //You are an exemplary Bladesinger and a hero among elves. The Gods themselves have taken notice of your righteous fury and now the Seldarine have blessed you with the tool to exact it. Be advised not to abuse a divine gift.
COPY  ~Eldritch_Magic/Effects/emundead.eff~   ~override~
COPY  ~Eldritch_Magic/Effects/emdemon.eff~   ~override~
COPY  ~Eldritch_Magic/Effects/emhugh1.eff~   ~override~
COPY  ~Eldritch_Magic/Effects/emhugh2.eff~   ~override~
COPY  ~Eldritch_Magic/Effects/emhugh3.eff~   ~override~
COPY  ~Eldritch_Magic/Effects/em2d6.eff~   ~override~
COPY  ~Eldritch_Magic/Dialog/emsw1h01.dlg~   ~override~
      SAY 0x34  @200 //(The sword flashes for a moment, then permeates your mind with melodic Elven whispers.)
      SAY 0x44  @201 // ...
      SAY 0x54  @202 // "I am as I have always been."
      SAY 0x64  @204 //(The sword emits a shockingly demi-human sigh) "42."
      SAY 0x74  @206 //(The sword is silent a moment.) "That would have to be a hectaoncheire, 'hundredhanded one' - a few Gods fell that day. Pray you never face one, much less two."
      SAY 0x84  @208 // "I may be a holy artifact forged by the Gods, but I'm still a sword. Aren't there any evil Bhaalspawn left?"
      SAY 0x98  @198 // Never mind. Let's just continue on for now.
      SAY 0xb8  @199 // What's your status, sword?
      SAY 0xd8  @203 // What is the answer to life, the universe, and everything?
      SAY 0xf8  @205 // What's the most powerful foe you've vanquished?
      SAY 0x118 @207 // What would you have me do, O Sentient Sword?
COPY  ~Eldritch_Magic/Spells/emsare1.spl~   ~override~
      SAY 0xce @94 //Blades
COPY  ~Eldritch_Magic/Spells/emsare2.spl~   ~override~
      SAY 0xce @95 //Spikes

COPY_EXISTING ~lunumab.2da~ ~override~
  APPEND ITEMDIAL.2da ~EMSW1H01      5689   EMSW1H01~

COPY_EXISTING ~item_use.2da~ ~override~
  APPEND item_use.2da ~emplat01   SAREVOK    9382       2~
  APPEND item_use.2da ~emsw2h01   SAREVOK    9382       2~
  APPEND item_use.2da ~emsarev   SAREVOK    9382       2~

COPY ~Eldritch_Magic/ITM/emboot01.itm~ ~override~ // Elven Boots of Speed: The Paws of the Lythari @96 = Bladesinger
  SAY NAME1 @26
  SAY NAME2 @27
  SAY UNIDENTIFIED_DESC @28
  SAY DESC @29
  SAY 0x15e @96

COPY ~Eldritch_Magic/ITM/emchan01.itm~ ~override~ // Holy Elven Chain +6 @96 = Bladesinger
  SAY NAME1 @30
  SAY NAME2 @31
  SAY UNIDENTIFIED_DESC @32
  SAY DESC @33
  SAY 0x3fe @96

COPY ~Eldritch_Magic/ITM/emclck01.itm~ ~override~ // Bladesinger's Shroud @96 = Bladesinger
  SAY NAME1 @34
  SAY NAME2 @35
  SAY UNIDENTIFIED_DESC @36
  SAY DESC @37
  SAY 0x2b6 @96

COPY ~Eldritch_Magic/ITM/emring01.itm~ ~override~ // Bladesinger's Signet @96 = Bladesinger
  SAY NAME1 @38
  SAY NAME2 @39
  SAY UNIDENTIFIED_DESC @40
  SAY DESC @41
  SAY 0x2de @96

COPY ~Eldritch_Magic/BAM/emsw1h01.bam~ ~override~
COPY ~Eldritch_Magic/ITM/emsw1h01.itm~ ~override~// Seldarine's Fury +6: Shame of the Gods @96 = Bladesinger
  SAY NAME1 @42
  SAY NAME2 @43
  SAY UNIDENTIFIED_DESC @44
  SAY DESC @45
  SAY 0x586 @96

COPY ~Eldritch_Magic/ITM/emsw1h11.itm~ ~override~ // Angharradh's Song @96 = Bladesinger
  SAY NAME1 ~~
  SAY NAME2 @47
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @49
  SAY 0x1f6 @96

COPY ~Eldritch_Magic/ITM/embelt25.itm~ ~override~ // Girdle of Titan Strength
  SAY NAME1 ~~
  SAY NAME2 @58
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @59

COPY ~Eldritch_Magic/ITM/emthay.itm~ ~override~ // Red Robe of Thay @97 = Red Wizard of Thay
  SAY NAME1 ~~
  SAY NAME2 @60
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @61
  SAY 0x36e @97

COPY ~Eldritch_Magic/ITM/emsw1h04.itm~ ~override~ // Blue Flame Taragarth +3
  SAY NAME1 ~~
  SAY NAME2 @62
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @63

COPY ~Eldritch_Magic/ITM/emdagg01.itm~ ~override~ // Netherese Spellblade
  SAY NAME1 ~~
  SAY NAME2 @64
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @65

COPY ~Eldritch_Magic/ITM/emsw1h08.itm~ ~override~ // Plasma Blade of Kossuth: Igneus Nova
  SAY NAME1 ~~
  SAY NAME2 @66
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @67

COPY ~Eldritch_Magic/BAM/phelm29.bmp~ ~override~
COPY ~Eldritch_Magic/ITM/empsion.itm~ ~override~ // Drow Psionicist's Cowl
  SAY NAME1 ~~
  SAY NAME2 @68
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @69

COPY ~Eldritch_Magic/ITM/emveye.itm~ ~override~ // Eye of Vecna
  SAY NAME1 ~~
  SAY NAME2 @70
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @71

COPY ~Eldritch_Magic/ITM/emvhand.itm~ ~override~ // Hand of Vecna
  SAY NAME1 ~~
  SAY NAME2 @72
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @73

COPY ~Eldritch_Magic/ITM/emimoen.itm~ ~override~ // Imoen's Belt @98 = IMOEN
  SAY NAME1 ~~
  SAY NAME2 @52
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @53
  SAY 0x2de @98

COPY ~Eldritch_Magic/ITM/emplat01.itm~ ~override~ // Sarevok's Bladed Armor +5
  SAY NAME1 ~~
  SAY NAME2 @54
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @55

COPY ~Eldritch_Magic/ITM/emsw2h01.itm~ ~override~ // Sword of Chaos +5
  SAY NAME1 ~~
  SAY NAME2 @56
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @57
  
COPY ~Eldritch_Magic/ITM/emsarev.itm~ ~override~ // Sword of Chaos +5 (Ascension)
  SAY NAME1 ~~
  SAY NAME2 @56
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @57

COPY ~Eldritch_Magic/ITM/emheart.itm~ ~override~ // Black Heart of Kazgaroth
  SAY NAME1 ~~
  SAY NAME2 @220
  SAY UNIDENTIFIED_DESC ~~
  SAY DESC @221

COPY ~Eldritch_Magic/ITM/emhugh.itm~ ~override~ // Sword of Cymrych Hugh
  SAY NAME1 @42
  SAY NAME2 @255
  SAY UNIDENTIFIED_DESC @44
  SAY DESC @256
  SAY 0x19e @224
  SAY 0x1ce @224
  SAY 0x1fe @224

COPY ~Eldritch_Magic/ITM/emhide.itm~ ~override~ // Kazgaroth's Hide
  SAY NAME1 @225
  SAY NAME2 @222
  SAY UNIDENTIFIED_DESC @226
  SAY DESC @223
  SAY 0x22e @224
  
 PRINT ~He who fights with monsters should look to it that he himself does not become a monster . . . when you gaze long into the abyss the abyss also gazes into you
- Friedrich Nietzsche~

BEGIN ~Congenio's Pebble Collection~ DESIGNATED 22
REQUIRE_PREDICATE GAME_IS ~bgee bg2ee iwdee~ @25

COPY ~Eldritch_Magic/ITM/Ioun/bdioun01.itm~ ~override~ // Trollblood Ioun Stone
  SAY NAME1 @74
  SAY NAME2 @76
  SAY UNIDENTIFIED_DESC @75
  SAY DESC @77
COPY ~Eldritch_Magic/ITM/Ioun/bdioun02.itm~ ~override~ // Blood Red Ioun Stone
  SAY NAME1 @74
  SAY NAME2 @78
  SAY UNIDENTIFIED_DESC @75
  SAY DESC @79
COPY ~Eldritch_Magic/ITM/Ioun/helm18.itm~ ~override~ // Pearly White Ioun Stone
  SAY NAME1 @74
  SAY NAME2 @80
  SAY UNIDENTIFIED_DESC @75
  SAY DESC @81
COPY ~Eldritch_Magic/ITM/Ioun/helm19.itm~ ~override~ // Dusty Rose Ioun Stone
  SAY NAME1 @74
  SAY NAME2 @82
  SAY UNIDENTIFIED_DESC @75
  SAY DESC @83
COPY ~Eldritch_Magic/ITM/Ioun/helm20.itm~ ~override~ // Pale Green Ioun Stone
  SAY NAME1 @74
  SAY NAME2 @84
  SAY UNIDENTIFIED_DESC @75
  SAY DESC @85
COPY ~Eldritch_Magic/ITM/Ioun/helm23.itm~ ~override~ // Golden Ioun Stone
  SAY NAME1 @74
  SAY NAME2 @86
  SAY UNIDENTIFIED_DESC @75
  SAY DESC @87
COPY ~Eldritch_Magic/ITM/Ioun/helm24.itm~ ~override~ // Obsidian Ioun Stone
  SAY NAME1 @74
  SAY NAME2 @88
  SAY UNIDENTIFIED_DESC @75
  SAY DESC @89
COPY ~Eldritch_Magic/ITM/Ioun/helm25.itm~ ~override~ // Silver Ioun Stone
  SAY NAME1 @74
  SAY NAME2 @90
  SAY UNIDENTIFIED_DESC @75
  SAY DESC @91
COPY ~Eldritch_Magic/ITM/Ioun/helm26.itm~ ~override~ // Lavender Ioun Stone
  SAY NAME1 @74
  SAY NAME2 @92
  SAY UNIDENTIFIED_DESC @75
  SAY DESC @93
COPY ~Eldritch_Magic/ITM/Ioun/helm27.itm~ ~override~ // Bronze Ioun Stone
  SAY NAME1 @74
  SAY NAME2 @142
  SAY UNIDENTIFIED_DESC @75
  SAY DESC @143
COPY ~Eldritch_Magic/ITM/Ioun/helm34.itm~ ~override~ // Wong Fei's Ioun Stone
  SAY NAME1 @74
  SAY NAME2 @144
  SAY UNIDENTIFIED_DESC @75
  SAY DESC @145
COPY ~Eldritch_Magic/ITM/Ioun/amsoul01.itm~ ~override~ // Malla's Soul Stone
  SAY NAME1 @148
  SAY NAME2 @146
  SAY UNIDENTIFIED_DESC @75
  SAY DESC @149
COPY ~Eldritch_Magic/ITM/Ioun/ohioun01.itm~ ~override~ // Deep Red Ioun Stone
  SAY NAME1 @74
  SAY NAME2 @150
  SAY UNIDENTIFIED_DESC @75
  SAY DESC @151
COPY ~Eldritch_Magic/ITM/Ioun/ohioun02.itm~ ~override~ // Scarlet/Blue Ioun Stone
  SAY NAME1 @74
  SAY NAME2 @152
  SAY UNIDENTIFIED_DESC @75
  SAY DESC @153
COPY ~Eldritch_Magic/ITM/Ioun/ohioun03.itm~ ~override~ // Clear Ioun Stone
  SAY NAME1 @74
  SAY NAME2 @154
  SAY UNIDENTIFIED_DESC @75
  SAY DESC @155
COPY ~Eldritch_Magic/ITM/Ioun/bdioun01.spl~ ~override~
  SAY 0x8  @76
  SAY 0x50 @77
COPY ~Eldritch_Magic/ITM/Ioun/bdioun02.spl~ ~override~
  SAY 0x8  @78
  SAY 0x50 @79
COPY ~Eldritch_Magic/ITM/Ioun/helm18.spl~ ~override~
  SAY 0x8  @80
  SAY 0x50 @81
COPY ~Eldritch_Magic/ITM/Ioun/helm19.spl~ ~override~
  SAY 0x8  @82
  SAY 0x50 @83
COPY ~Eldritch_Magic/ITM/Ioun/helm20.spl~ ~override~
  SAY 0x8  @84
  SAY 0x50 @85
COPY ~Eldritch_Magic/ITM/Ioun/helm23.spl~ ~override~
  SAY 0x8  @86
  SAY 0x50 @87
COPY ~Eldritch_Magic/ITM/Ioun/helm24.spl~ ~override~
  SAY 0x8  @88
  SAY 0x50 @89
COPY ~Eldritch_Magic/ITM/Ioun/helm25.spl~ ~override~
  SAY 0x8  @90
  SAY 0x50 @91
COPY ~Eldritch_Magic/ITM/Ioun/helm26.spl~ ~override~
  SAY 0x8  @92
  SAY 0x50 @93
COPY ~Eldritch_Magic/ITM/Ioun/helm27.spl~ ~override~
  SAY 0x8  @142
  SAY 0x50 @143
COPY ~Eldritch_Magic/ITM/Ioun/helm34.spl~ ~override~
  SAY 0x8  @144
  SAY 0x50 @145
COPY ~Eldritch_Magic/ITM/Ioun/amsoul01.spl~ ~override~
  SAY 0x8  @146
  SAY 0x50 @147
COPY ~Eldritch_Magic/ITM/Ioun/ohioun1.spl~ ~override~
  SAY 0x8  @150
  SAY 0x50 @151
COPY ~Eldritch_Magic/ITM/Ioun/ohioun2.spl~ ~override~
  SAY 0x8  @152
  SAY 0x50 @153
COPY ~Eldritch_Magic/ITM/Ioun/ohioun3.spl~ ~override~
  SAY 0x8  @154
  SAY 0x50 @155
COPY ~Eldritch_Magic/ITM/Ioun/ioun01.spl~ ~override~
  SAY 0x8  @76
  SAY 0x50 @77
COPY ~Eldritch_Magic/ITM/Ioun/ioun02.spl~ ~override~
  SAY 0x8  @78
  SAY 0x50 @79
COPY ~Eldritch_Magic/ITM/Ioun/ioun03.spl~ ~override~
  SAY 0x8  @80
  SAY 0x50 @81
COPY ~Eldritch_Magic/ITM/Ioun/ioun04.spl~ ~override~
  SAY 0x8  @82
  SAY 0x50 @83
COPY ~Eldritch_Magic/ITM/Ioun/ioun05.spl~ ~override~
  SAY 0x8  @84
  SAY 0x50 @85
COPY ~Eldritch_Magic/ITM/Ioun/ioun06.spl~ ~override~
  SAY 0x8  @86
  SAY 0x50 @87
COPY ~Eldritch_Magic/ITM/Ioun/ioun07.spl~ ~override~
  SAY 0x8  @88
  SAY 0x50 @89
COPY ~Eldritch_Magic/ITM/Ioun/ioun08.spl~ ~override~
  SAY 0x8  @90
  SAY 0x50 @91
COPY ~Eldritch_Magic/ITM/Ioun/ioun09.spl~ ~override~
  SAY 0x8  @92
  SAY 0x50 @93
COPY ~Eldritch_Magic/ITM/Ioun/ioun10.spl~ ~override~
  SAY 0x8  @142
  SAY 0x50 @143
COPY ~Eldritch_Magic/ITM/Ioun/ioun11.spl~ ~override~
  SAY 0x8  @144
  SAY 0x50 @145
COPY ~Eldritch_Magic/ITM/Ioun/ioun12.spl~ ~override~
  SAY 0x8  @146
  SAY 0x50 @147
COPY ~Eldritch_Magic/ITM/Ioun/ioun13.spl~ ~override~
  SAY 0x8  @150
  SAY 0x50 @151
COPY ~Eldritch_Magic/ITM/Ioun/ioun14.spl~ ~override~
  SAY 0x8  @152
  SAY 0x50 @153
COPY ~Eldritch_Magic/ITM/Ioun/ioun15.spl~ ~override~
  SAY 0x8  @154
  SAY 0x50 @155
COPY ~Eldritch_Magic/ITM/Ioun/ohioun01.bam~ ~override~
COPY ~Eldritch_Magic/ITM/Ioun/ohioun02.bam~ ~override~
COPY ~Eldritch_Magic/ITM/Ioun/ohioun03.bam~ ~override~
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                 Non-Enhanced Edition Mods [ALPHA] USE AT YOUR OWN RISK                                                            //
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//BEGIN ~IWD2: Item Expansion [ALPHA]~ DESIGNATED 23
//REQUIRE_PREDICATE GAME_IS ~iwd2~ @25
// BGEE
COPY  ~Eldritch_Magic/Effects/emlaw.eff~   ~override~
//COPY ~Eldritch_Magic/ITM/emsw1h05.itm~ ~override~ // Silver Long Sword +2
//  SAY NAME1 ~~
//  SAY NAME2 @102
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @103
//COPY ~Eldritch_Magic/ITM/emsw1h06.itm~ ~override~ // Flaming Burst Long Sword +1
//  SAY NAME1 ~~
//  SAY NAME2 @104
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @105
//COPY ~Eldritch_Magic/ITM/emsw1h07.itm~ ~override~ // Frost-Fire Long Sword +2
//  SAY NAME1 ~~
//  SAY NAME2 @106
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @107
//COPY ~Eldritch_Magic/ITM/emsw1h10.itm~ ~override~ // Mithral Long Sword +3
//  SAY NAME1 ~~
//  SAY NAME2 @108
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @109
//COPY ~Eldritch_Magic/ITM/emsw1h02.itm~ ~override~ // Adamantine Long Sword of Biting +1
//  SAY NAME1 ~~
//  SAY NAME2 @110
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @111
//COPY ~Eldritch_Magic/ITM/emsw1h12.itm~ ~override~ // Vampiric Short Sword +1
//  SAY NAME1 ~~
//  SAY NAME2 @112
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @113
//COPY ~Eldritch_Magic/ITM/emsw1h03.itm~ ~override~ // Masterwork Cold Iron Long Sword
//  SAY NAME1 ~~
//  SAY NAME2 @114
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @115
//COPY ~Eldritch_Magic/ITM/emsw1h13.itm~ ~override~ // Elemental Long Sword +1
//  SAY NAME1 ~~
//  SAY NAME2 @116
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @117
//COPY ~Eldritch_Magic/ITM/emsw1h09.itm~ ~override~ // Holy Avenger Long Sword +3
//  SAY NAME1 ~~
//  SAY NAME2 @118
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @119
//COPY ~Eldritch_Magic/ITM/embhaal.itm~ ~override~ // Bhaal's Holy Symbol
//  SAY NAME1 ~~
//  SAY NAME2 @120
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @121
//COPY ~Eldritch_Magic/ITM/emchanco.itm~ ~override~ // Elven Chain Mail of the Collector
//  SAY NAME1 ~~
//  SAY NAME2 @140
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @141
// BG2EE
//COPY ~Eldritch_Magic/Creatures/Sar1L.BMP~ ~override/Sar1L.BMP~
//COPY ~Eldritch_Magic/Creatures/Sar2L.BMP~ ~override/Sar2L.BMP~
//COPY ~Eldritch_Magic/Creatures/Sar1L.BMP~ ~portraits~
//COPY ~Eldritch_Magic/Creatures/Sar2L.BMP~ ~portraits~
//COPY ~Eldritch_Magic/Creatures/Sar1M.BMP~ ~override/Sar1L.BMP~
//COPY ~Eldritch_Magic/Creatures/Sar2M.BMP~ ~override/Sar2L.BMP~
//COPY ~Eldritch_Magic/Creatures/Sar1M.BMP~ ~portraits~
//COPY ~Eldritch_Magic/Creatures/Sar2M.BMP~ ~portraits~
//COPY  ~Eldritch_Magic/Spells/emcdchan.spl~   ~override~
//      SAY 0xfe @219 //You feel a tug from the Pocket Plane as an artifact lost to time materializes among your possessions. Surely such a happening is linked to your powerful heritage.
//COPY  ~Eldritch_Magic/Spells/emcdblsr.spl~   ~override~
//      SAY 0x15e @213 //You have been acknowledged by the Bladesinger's Guild.
//COPY  ~Eldritch_Magic/Spells/emcdsw1h.spl~   ~override~
//      SAY 0xfe @214 //You are an exemplary Bladesinger and a hero among elves. The Gods themselves have taken notice of your righteous fury and now the Seldarine have blessed you with the tool to exact it. Be advised not to abuse a divine gift.
//COPY  ~Eldritch_Magic/Effects/emundead.eff~   ~override~
//COPY  ~Eldritch_Magic/Effects/emdemon.eff~   ~override~
//COPY  ~Eldritch_Magic/Effects/emhugh1.eff~   ~override~
//COPY  ~Eldritch_Magic/Effects/emhugh2.eff~   ~override~
//COPY  ~Eldritch_Magic/Effects/emhugh3.eff~   ~override~
//COPY  ~Eldritch_Magic/Effects/em2d6.eff~   ~override~
//COPY  ~Eldritch_Magic/Dialog/emsw1h01.dlg~   ~override~
//      SAY 0x34  @200 //(The sword flashes for a moment, then permeates your mind with melodic Elven whispers.)
//      SAY 0x44  @201 // ...
//      SAY 0x54  @202 // "I am as I have always been."
//      SAY 0x64  @204 //(The sword emits a shockingly demi-human sigh) "42."
//      SAY 0x74  @206 //(The sword is silent a moment.) "That would have to be a hectaoncheire, 'hundredhanded one' - a few Gods fell that day. Pray you never face one, much less two."
//      SAY 0x84  @208 // "I may be a holy artifact forged by the Gods, but I'm still a sword. Aren't there any evil Bhaalspawn left?"
//      SAY 0x98  @198 // Never mind. Let's just continue on for now.
//      SAY 0xb8  @199 // What's your status, sword?
//      SAY 0xd8  @203 // What is the answer to life, the universe, and everything?
//      SAY 0xf8  @205 // What's the most powerful foe you've vanquished?
//      SAY 0x118 @207 // What would you have me do, O Sentient Sword?
//COPY  ~Eldritch_Magic/Spells/emsare1.spl~   ~override~
//      SAY 0xce @94 //Blades
//COPY  ~Eldritch_Magic/Spells/emsare2.spl~   ~override~
//      SAY 0xce @95 //Spikes
//COPY_EXISTING ~lunumab.2da~ ~override~
//  APPEND ITEMDIAL.2da ~EMSW1H01      5689   EMSW1H01~
//COPY_EXISTING ~item_use.2da~ ~override~
//  APPEND item_use.2da ~emplat01   SAREVOK    9382       2~
//  APPEND item_use.2da ~emsw2h01   SAREVOK    9382       2~
//  APPEND item_use.2da ~emsarev   SAREVOK    9382       2~
//COPY ~Eldritch_Magic/ITM/emboot01.itm~ ~override~ // Elven Boots of Speed: The Paws of the Lythari @96 = Bladesinger
//  SAY NAME1 @26
//  SAY NAME2 @27
//  SAY UNIDENTIFIED_DESC @28
//  SAY DESC @29
//  SAY 0x15e @96
//COPY ~Eldritch_Magic/ITM/emchan01.itm~ ~override~ // Holy Elven Chain +6 @96 = Bladesinger
//  SAY NAME1 @30
//  SAY NAME2 @31
//  SAY UNIDENTIFIED_DESC @32
//  SAY DESC @33
//  SAY 0x3fe @96
//COPY ~Eldritch_Magic/ITM/emclck01.itm~ ~override~ // Bladesinger's Shroud @96 = Bladesinger
//  SAY NAME1 @34
//  SAY NAME2 @35
//  SAY UNIDENTIFIED_DESC @36
//  SAY DESC @37
//  SAY 0x2b6 @96
//COPY ~Eldritch_Magic/ITM/emring01.itm~ ~override~ // Bladesinger's Signet @96 = Bladesinger
//  SAY NAME1 @38
//  SAY NAME2 @39
//  SAY UNIDENTIFIED_DESC @40
//  SAY DESC @41
//  SAY 0x2de @96
//COPY ~Eldritch_Magic/BAM/emsw1h01.bam~ ~override~
//COPY ~Eldritch_Magic/ITM/emsw1h01.itm~ ~override~// Seldarine's Fury +6: Shame of the Gods @96 = Bladesinger
//  SAY NAME1 @42
//  SAY NAME2 @43
//  SAY UNIDENTIFIED_DESC @44
//  SAY DESC @45
//  SAY 0x586 @96
//COPY ~Eldritch_Magic/ITM/emsw1h11.itm~ ~override~ // Angharradh's Song @96 = Bladesinger
//  SAY NAME1 ~~
//  SAY NAME2 @47
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @49
//  SAY 0x1f6 @96
//COPY ~Eldritch_Magic/ITM/embelt25.itm~ ~override~ // Girdle of Titan Strength
//  SAY NAME1 ~~
//  SAY NAME2 @58
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @59
//COPY ~Eldritch_Magic/ITM/emthay.itm~ ~override~ // Red Robe of Thay @97 = Red Wizard of Thay
//  SAY NAME1 ~~
//  SAY NAME2 @60
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @61
//  SAY 0x36e @97
//COPY ~Eldritch_Magic/ITM/emsw1h04.itm~ ~override~ // Blue Flame Taragarth +3
//  SAY NAME1 ~~
//  SAY NAME2 @62
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @63
//COPY ~Eldritch_Magic/ITM/emdagg01.itm~ ~override~ // Netherese Spellblade
//  SAY NAME1 ~~
//  SAY NAME2 @64
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @65
//COPY ~Eldritch_Magic/ITM/emsw1h08.itm~ ~override~ // Plasma Blade of Kossuth: Igneus Nova
//  SAY NAME1 ~~
//  SAY NAME2 @66
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @67
//COPY ~Eldritch_Magic/BAM/phelm29.bmp~ ~override~
//COPY ~Eldritch_Magic/ITM/empsion.itm~ ~override~ // Drow Psionicist's Cowl
//  SAY NAME1 ~~
//  SAY NAME2 @68
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @69
//COPY ~Eldritch_Magic/ITM/emveye.itm~ ~override~ // Eye of Vecna
//  SAY NAME1 ~~
//  SAY NAME2 @70
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @71
//COPY ~Eldritch_Magic/ITM/emvhand.itm~ ~override~ // Hand of Vecna
//  SAY NAME1 ~~
//  SAY NAME2 @72
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @73
//COPY ~Eldritch_Magic/ITM/emimoen.itm~ ~override~ // Imoen's Belt @98 = IMOEN
//  SAY NAME1 ~~
//  SAY NAME2 @52
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @53
//  SAY 0x2de @98
//COPY ~Eldritch_Magic/ITM/emplat01.itm~ ~override~ // Sarevok's Bladed Armor +5
//  SAY NAME1 ~~
//  SAY NAME2 @54
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @55
//COPY ~Eldritch_Magic/ITM/emsw2h01.itm~ ~override~ // Sword of Chaos +5
//  SAY NAME1 ~~
//  SAY NAME2 @56
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @57
//COPY ~Eldritch_Magic/ITM/emsarev.itm~ ~override~ // Sword of Chaos +5 (Ascension)
//  SAY NAME1 ~~
//  SAY NAME2 @56
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @57
//COPY ~Eldritch_Magic/ITM/emheart.itm~ ~override~ // Black Heart of Kazgaroth
//  SAY NAME1 ~~
//  SAY NAME2 @220
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @221
//COPY ~Eldritch_Magic/ITM/emhugh.itm~ ~override~ // Sword of Cymrych Hugh
//  SAY NAME1 @42
//  SAY NAME2 @255
//  SAY UNIDENTIFIED_DESC @44
//  SAY DESC @256
//  SAY 0x19e @224
//  SAY 0x1ce @224
//  SAY 0x1fe @224
//COPY ~Eldritch_Magic/ITM/emhide.itm~ ~override~ // Kazgaroth's Hide
//  SAY NAME1 @225
//  SAY NAME2 @222
//  SAY UNIDENTIFIED_DESC @226
//  SAY DESC @223
//  SAY 0x22e @224
// IWDEE
//COPY ~Eldritch_Magic/ITM/EMAURIL.itm~ ~override~ // Breath of Auril +3
//  SAY NAME1 ~~
//  SAY NAME2 @257
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @258
//COPY ~Eldritch_Magic/BAM/IAURIL.bam~ ~override~
//COPY ~Eldritch_Magic/ITM/EMBBLA.itm~ ~override~ // Lore of the Bladesingers
//  SAY NAME1 ~~
//  SAY NAME2 @259
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @260
//COPY ~Eldritch_Magic/ITM/EMBLOOD.itm~ ~override~ // Bathed-In-Blood +4
//  SAY NAME1 ~~
//  SAY NAME2 @261
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @262
//COPY ~Eldritch_Magic/BAM/IBLOOD.bam~ ~override~
//COPY ~Eldritch_Magic/ITM/EMCLOASC.itm~ ~override~ // Cloak of Scintillating Colors
//  SAY NAME1 ~~
//  SAY NAME2 @263
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @264
//COPY ~Eldritch_Magic/BAM/ICLOAKSC.bam~ ~override~
//COPY ~Eldritch_Magic/ITM/EMELFCHA.itm~ ~override~ // Elven Chain Mail of the Hand +3
//  SAY NAME1 ~~
//  SAY NAME2 @265
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @266
//COPY ~Eldritch_Magic/BAM/IELFCHAN.bam~ ~override~
//COPY ~Eldritch_Magic/BAM/GCHAN12.bam~ ~override~
//COPY ~Eldritch_Magic/ITM/EMGLORY.itm~ ~override~ // The Glory of Suffering +6
//  SAY NAME1 ~~
//  SAY NAME2 @267
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @268
//COPY ~Eldritch_Magic/BAM/IGLORY.bam~ ~override~
//COPY ~Eldritch_Magic/ITM/EMJHOSWD.itm~ ~override~ // Singing Blade of Aihonen +5
//  SAY NAME1 ~~
//  SAY NAME2 @269
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @270
//COPY ~Eldritch_Magic/BAM/IJHOSWD3.bam~ ~override~
//COPY ~Eldritch_Magic/ITM/EMZZ36DG.itm~ ~override~ // Dead God's Dreaming +4, +6 vs. good
//  SAY NAME1 ~~
//  SAY NAME2 @271
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @272
//COPY ~Eldritch_Magic/BAM/IZZ36DGD.bam~ ~override~
//COPY ~Eldritch_Magic/Effects/ZZ36DGDH.eff~ ~override~
//COPY ~Eldritch_Magic/Effects/ZZ36DGDD.eff~ ~override~
//COPY ~Eldritch_Magic/Spells/EM428.spl~ ~override~
//  SAY 0x8 @273
//  SAY 0x50 @274
//  SAY 0x18e @277
//COPY ~Eldritch_Magic/Spells/EM714.spl~ ~override~
//  SAY 0x8 @275
//  SAY 0x50 @276
//  SAY 0x21e @278
//COPY ~Eldritch_Magic/BAM/conjuh.bam~ ~override~
//COPY ~Eldritch_Magic/BAM/enchah.bam~ ~override~
//COPY ~Eldritch_Magic/VVC/conjuh.vvc~ ~override~
//COPY ~Eldritch_Magic/VVC/enchah.vvc~ ~override~
//COPY ~Eldritch_Magic/BAM/EM428B.bam~ ~override~
//COPY ~Eldritch_Magic/BAM/EM428C.bam~ ~override~
//COPY ~Eldritch_Magic/BAM/EM714B.bam~ ~override~
//COPY ~Eldritch_Magic/BAM/EM714C.bam~ ~override~
// PRINT ~He who fights with monsters should look to it that he himself does not become a monster . . . when you gaze long into the abyss the abyss also gazes into you
//- Friedrich Nietzsche~
//BEGIN ~PST: Item Expansion [ALPHA]~ DESIGNATED 24
//REQUIRE_PREDICATE GAME_IS ~pst~ @25
//COPY ~Eldritch_Magic/BAM/IMISCA8.BAM~ ~override~ // *Needs to be installed before Widescreen Mod*
//COPY ~Eldritch_Magic/ITM/embehldr.itm~ ~override~ // Eye of the Beholder
//  SAY NAME1 ~~
//  SAY NAME2 @279
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @280
//COPY ~Eldritch_Magic/ITM/emgrumsh.itm~ ~override~ // Eye of Gruumsh
//  SAY NAME1 ~~
//  SAY NAME2 @281
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @282
//COPY ~Eldritch_Magic/ITM/emttmage.itm~ ~override~ // Tattoo of the Archmagi
//  SAY NAME1 ~~
//  SAY NAME2 @283
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @284
//COPY ~Eldritch_Magic/ITM/emveye.itm~ ~override~ // Eye of Vecna (TEST - this already exists in PST)
//  SAY NAME1 ~~
//  SAY NAME2 @70
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @71
//COPY ~Eldritch_Magic/ITM/emvhand.itm~ ~override~ // Hand of Vecna
//  SAY NAME1 ~~
//  SAY NAME2 @72
//  SAY UNIDENTIFIED_DESC ~~
//  SAY DESC @73
// PRINT ~He who fights with monsters should look to it that he himself does not become a monster . . . when you gaze long into the abyss the abyss also gazes into you
//- Friedrich Nietzsche~